<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Tridash Tutorials</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /></head><body><div xml:lang="en" class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="idm315191660880"></a>Tridash Tutorials</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Alexander</span> <span class="surname">Gutev</span></h3><code class="email">&lt;<a class="email" href="mailto:alex.gutev@gmail.com">alex.gutev@gmail.com</a>&gt;</code></div></div></div><hr /></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#tutorial1">1. Hello Node</a></span></dt><dd><dl><dt><span class="section"><a href="#_nodes">1.1. Nodes</a></span></dt><dt><span class="section"><a href="#_first_application">1.2. First Application</a></span></dt><dt><span class="section"><a href="#_inline_node_declarations">1.3. Inline Node Declarations</a></span></dt><dt><span class="section"><a href="#_two_way_bindings">1.4. Two-Way Bindings</a></span></dt></dl></dd><dt><span class="section"><a href="#_functional_bindings">2. Functional Bindings</a></span></dt><dd><dl><dt><span class="section"><a href="#_example_application_adding_numbers">2.1. Example Application: Adding Numbers</a></span></dt><dt><span class="section"><a href="#_binding_to_functor_nodes">2.2. Binding to Functor Nodes</a></span></dt></dl></dd><dt><span class="section"><a href="#_conditional_bindings">3. Conditional Bindings</a></span></dt><dd><dl><dt><span class="section"><a href="#_case_operator">3.1. Case Operator</a></span></dt><dt><span class="section"><a href="#_example_1_maximum_of_two_numbers">3.2. Example 1: Maximum of Two Numbers</a></span></dt><dt><span class="section"><a href="#_example_2_sum_limit">3.3. Example 2: Sum Limit</a></span></dt><dt><span class="section"><a href="#_improvements">3.4. Improvements</a></span></dt></dl></dd><dt><span class="section"><a href="#functions">4. Writing your own Functions</a></span></dt><dd><dl><dt><span class="section"><a href="#_definition_operator">4.1. Definition Operator</a></span></dt><dt><span class="section"><a href="#_node_literal_self_literal">4.2. Node <code class="literal">self</code></a></span></dt><dt><span class="section"><a href="#_optional_arguments">4.3. Optional Arguments</a></span></dt><dt><span class="section"><a href="#_recursive_meta_nodes">4.4. Recursive Meta-Nodes</a></span></dt><dt><span class="section"><a href="#_nested_meta_nodes">4.5. Nested Meta-Nodes</a></span></dt><dt><span class="section"><a href="#_local_nodes">4.6. Local Nodes</a></span></dt><dt><span class="section"><a href="#_referencing_outer_nodes">4.7. Referencing Outer Nodes</a></span></dt><dt><span class="section"><a href="#_fun_example_simple_meter">4.8. Fun Example: Simple Meter</a></span></dt></dl></dd><dt><span class="section"><a href="#_subnodes">5. Subnodes</a></span></dt><dd><dl><dt><span class="section"><a href="#_example_color_object">5.1. Example: Color Object</a></span></dt></dl></dd><dt><span class="section"><a href="#_error_handling_with_failure_values">6. Error Handling with Failure Values</a></span></dt><dd><dl><dt><span class="section"><a href="#_invalid_input">6.1. Invalid Input</a></span></dt><dt><span class="section"><a href="#_failure_values">6.2. Failure Values</a></span></dt><dt><span class="section"><a href="#_handling_failures">6.3. Handling Failures</a></span></dt><dt><span class="section"><a href="#_initial_values">6.4. Initial Values</a></span></dt><dt><span class="section"><a href="#_exercise">6.5. Exercise</a></span></dt></dl></dd><dt><span class="section"><a href="#_failure_types">7. Failure Types</a></span></dt><dd><dl><dt><span class="section"><a href="#_identifying_the_cause_of_failures">7.1. Identifying the cause of Failures</a></span></dt><dt><span class="section"><a href="#_example_checking_failure_type_in_emphasis_adding_numbers_emphasis_application">7.2. Example: Checking Failure type in <span class="emphasis"><em>Adding Numbers</em></span> Application</a></span></dt><dt><span class="section"><a href="#_creating_failure_values">7.3. Creating Failure Values</a></span></dt><dt><span class="section"><a href="#_proper_failure_types">7.4. Proper Failure Types</a></span></dt></dl></dd><dt><span class="section"><a href="#_target_node_transforms">8. Target Node Transforms</a></span></dt><dd><dl><dt><span class="section"><a href="#_node_attributes">8.1. Node Attributes</a></span></dt><dt><span class="section"><a href="#_attribute_literal_target_node_literal">8.2. Attribute <code class="literal">target-node</code></a></span></dt><dt><span class="section"><a href="#target-node-own-meta-nodes">8.3. Target-Node for own Meta-Nodes</a></span></dt></dl></dd><dt><span class="section"><a href="#contexts">9. Contexts</a></span></dt><dd><dl><dt><span class="section"><a href="#_explicit_contexts">9.1. Explicit Contexts</a></span></dt><dt><span class="section"><a href="#_handling_failures_with_explicit_contexts">9.2. Handling Failures with Explicit Contexts</a></span></dt><dt><span class="section"><a href="#adding-numbers-improved-error-handling">9.3. Improved Error Handling in <span class="emphasis"><em>Adding Numbers</em></span></a></span></dt><dt><span class="section"><a href="#_concise_syntax">9.4. Concise Syntax</a></span></dt></dl></dd><dt><span class="section"><a href="#_node_states">10. Node States</a></span></dt><dd><dl><dt><span class="section"><a href="#_stateful_bindings">10.1. Stateful Bindings</a></span></dt><dt><span class="section"><a href="#_interfacing_with_javascript">10.2. Interfacing with JavaScript</a></span></dt><dt><span class="section"><a href="#example-counter-app">10.3. Example: Counter Application</a></span></dt><dt><span class="section"><a href="#_state_transitions">10.4. State Transitions</a></span></dt><dt><span class="section"><a href="#_example_alternating_increment_button">10.5. Example: Alternating Increment Button</a></span></dt><dt><span class="section"><a href="#_exercises">10.6. Exercises</a></span></dt></dl></dd><dt><span class="section"><a href="#_list_processing">11. List Processing</a></span></dt><dd><dl><dt><span class="section"><a href="#_creating_lists">11.1. Creating Lists</a></span></dt><dt><span class="section"><a href="#_higher_order_meta_nodes">11.2. Higher-Order Meta-Nodes</a></span></dt><dt><span class="section"><a href="#_example_message_list">11.3. Example: Message List</a></span></dt></dl></dd><dt><span class="section"><a href="#_modules_and_organization">12. Modules And Organization</a></span></dt><dd><dl><dt><span class="section"><a href="#_multiple_source_files">12.1. Multiple Source Files</a></span></dt><dt><span class="section"><a href="#_modules_in_depth">12.2. Modules In Depth</a></span></dt><dt><span class="section"><a href="#_adding_modularity_to_emphasis_adding_numbers_emphasis">12.3. Adding Modularity to <span class="emphasis"><em>Adding Numbers</em></span></a></span></dt><dt><span class="section"><a href="#_infix_operators">12.4. Infix Operators</a></span></dt></dl></dd><dt><span class="section"><a href="#_what_8217_s_next">13. What’s Next?</a></span></dt></dl></div><p>This set of tutorials covers the basics of the Tridash programming
language.</p><p>Prior programming experience is not strictly necessary however is
helpful.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The full source code for these tutorials is available in the
tutorials directory of the Tridash source:
<a class="ulink" href="https://github.com/alex-gutev/tridash/tree/master/tutorials" target="_top">https://github.com/alex-gutev/tridash/tree/master/tutorials</a>.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="tutorial1"></a>1. Hello Node</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_nodes"></a>1.1. Nodes</h3></div></div></div><p>A Tridash program is made up of a number of components called nodes,
which are loosely analogous to variables in other languages. Each node
holds a particular value, referred to as the node’s state, at a given
moment in time.</p><p>Nodes are created the first time they are referenced, by their
identifiers. Node identifiers can consist of any sequence of
Unicode characters excluding whitespace, parenthesis <code class="literal">(</code>, <code class="literal">)</code>, braces
<code class="literal">{</code>, <code class="literal">}</code>, double quotes <code class="literal">"</code> and the following special characters: <code class="literal">;</code>,
<code class="literal">,</code>, <code class="literal">.</code>, <code class="literal">#</code>. A node identifier must consist of at least one
non-digit character otherwise it is interpreted as a number.</p><p>The following are examples of valid node identifiers:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">name</code>
</li><li class="listitem">
<code class="literal">full-name</code>
</li><li class="listitem">
<code class="literal">node1</code>
</li><li class="listitem">
<code class="literal">1node</code>
</li></ul></div><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>There are few restrictions on the characters allowed in node
identifiers, meaning node identifiers may even contain symbols such as
<code class="literal">-</code>, <code class="literal">+</code>, <code class="literal">=</code>, <code class="literal">&gt;</code>, <code class="literal">?</code>, etc.</p></td></tr></table></div><p>A node can be bound to another node in which case its value is
automatically updated when the value of the node, to which it is
bound, changes.</p><p>The <code class="literal">-&gt;</code> operator establishes a binding between the node on the left
hand side, referred to as the <span class="emphasis"><em>source</em></span>, and the node on the right hand
side, referred to as the <span class="emphasis"><em>target</em></span>.</p><p><strong>Example. </strong>
</p><pre class="screen">a -&gt; b</pre><p>
</p><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The spaces between the node identifiers and the bind <code class="literal">-&gt;</code>
operator are mandatory since <code class="literal">a-&gt;b</code> is a valid node identifier and is
thus interpreted as a single node.</p></td></tr></table></div><p>In this example a binding is established between node <code class="literal">a</code> and node
<code class="literal">b</code>. The result is that when the value of <code class="literal">a</code> changes, the value of
<code class="literal">b</code> is automatically updated to match the value of <code class="literal">a</code>. This kind of
binding is known as a simple binding since a node is simply set to the
value of another node. Node <code class="literal">a</code> is referred to as a <span class="emphasis"><em>dependency</em></span> node
of <code class="literal">b</code>, since <code class="literal">b</code>'s value depends on the value of <code class="literal">a</code>, and <code class="literal">b</code> is
referred to as an <span class="emphasis"><em>observer</em></span> node of <code class="literal">a</code> since it actively observes
its value.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_first_application"></a>1.2. First Application</h3></div></div></div><p>We’ll use bindings to develop a simple application which asks for the
user’s name and displays a greeting.</p><p>This tutorial targets the JavaScript backend and makes use of HTML for
the user interface.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Some knowledge of the basics of HTML, i.e. what tags, elements
and attributes are, is necessary to complete this tutorial.</p></td></tr></table></div><p>We’ll start off by creating an HTML file, called <code class="literal">hello-ui.html</code>, with
the following contents:</p><p><strong>hello-ui.html. </strong>
</p><pre class="programlisting">&lt;?
 self.input-name.value -&gt; name
 name -&gt; self.span-name.textContent
?&gt;

&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Hello Node&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Tutorial 1: Hello Node&lt;/h1&gt;
        &lt;label&gt;Enter your name: &lt;input id="input-name"/&gt;&lt;/label&gt;
        &lt;p&gt;Hello &lt;span id="span-name"&gt;&lt;/span&gt;&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><p>Most of the file is HTML boilerplate, the interesting part is within
the <code class="literal">&lt;? ... ?&gt;</code> tag. The content of this tag is interpreted as Tridash
code. Tridash code tags can be placed almost anywhere in the file,
we’ve just chosen to place it at the top.</p><p>The Tridash code consists of two explicit binding
declarations. Declarations are separated by a line break or a
semicolon <code class="literal">;</code>.</p><p><strong>Tridash Code. </strong>
</p><pre class="screen">self.input-name.value -&gt; name
name -&gt; self.span-name.textContent</pre><p>
</p><p>The declaration in the first line binds the <code class="literal">self.input-name.value</code>
node to the <code class="literal">name</code> node.</p><p>The node <code class="literal">self.input-name</code> is a special node that references the
<code class="literal">input</code> element, with id <code class="literal">input-name</code>, in the HTML file. HTML elements
can be referenced from within Tridash code, in the same HTML file,
using the expression <code class="literal">self.&lt;id&gt;</code> where <code class="literal">&lt;id&gt;</code> is substituted with the
id of the element.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">.</code> operator is a special operator for referencing subnodes of
nodes, these will be explained in detail later. The subnode identifier
is the identifier which appears to the right of the operator. When a
subnode of a node, that references an HTML element, is referenced, the
HTML attribute, of the element, with the same name as the subnode
identifier is referenced. Referencing attributes of HTML elements,
from Tridash, allows the values of attributes to be bound to Tridash
nodes.</p></td></tr></table></div><p>The node <code class="literal">self.input-name.value</code>, which references the <code class="literal">value</code>
attribute of the HTML element with ID <code class="literal">input-name</code>, is bound to the
node <code class="literal">name</code>. Thus whenever the value of <code class="literal">input-name.value</code> changes,
the value of <code class="literal">name</code> is set to it. In other words, whenever text is
entered in the input element, the value of <code class="literal">name</code> is automatically set
to the text entered.</p><p>In the second declaration, the <code class="literal">name</code> node is bound to the
<code class="literal">self.span-name.textContent</code> node. <code class="literal">self.span-name</code> references the
HTML <code class="literal">span</code> element with ID <code class="literal">span-name</code>, with the node
<code class="literal">self.span-name.textContent</code> referencing the <code class="literal">textContent</code> attribute,
i.e. the content, of the element. The result of this binding is that
whenever the value of the <code class="literal">name</code> node changes, its value is displayed
in the <code class="literal">span</code> element. As mentioned earlier, the value of the <code class="literal">name</code>
node is automatically set to the text entered in the <code class="literal">input</code> element,
thus the value entered in the <code class="literal">input</code> element is displayed in the
<code class="literal">span</code> element.</p><p>The application we’ve just written, simply prompts the user for
his/her name and displays “Hello” followed by the user’s name
directly below the prompt. Let’s try it out to see if it works.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_building"></a>Building</h4></div></div></div><p>Run the following command to build the application:</p><pre class="screen">tridashc hello-ui.html : node-name=ui -o hello.html -p type=html -p main-ui=ui</pre><p>That looks complicated, let’s simplify it a bit.</p><p>The <code class="literal">tridashc</code> executable compiles one or more Tridash source files,
generating an output file. The source files, in this case
<code class="literal">hello.html</code>, are listed after <code class="literal">tridashc</code>. The name of the output file
is given by the <code class="literal">-o</code> or <code class="literal">--output-file</code> option, in this case
<code class="literal">hello.html</code>.</p><p>The snippet <code class="literal">: node-name=ui</code> sets the <code class="literal">node-name</code> option, for
processing the source file <code class="literal">hello-ui.html</code>, to <code class="literal">ui</code>. This creates a
node <code class="literal">ui</code> with which the contents of the HTML file can be referenced.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">self</code> node, when occurring within an HTML file is simply an
alias for the node name, given by the <code class="literal">node-name</code> option, which
references the contents of the HTML file.</p></td></tr></table></div><p>The <code class="literal">-p option=value</code> command-line options sets various options
related to the compilation output. The first option <code class="literal">type</code> is set to
<code class="literal">html</code> which indicates that the output should be an HTML file with the
generated JavaScript code embedded in it. The <code class="literal">main-ui</code> option is set
to <code class="literal">ui</code>, which is the name of the node referencing the contents of the
<code class="literal">hello-ui.html</code> file. It is the contents of this file that are used to
generate the output HTML file.</p><p>If all went well a <code class="literal">hello.html</code> file should have been created in the
same directory, after running the command.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_running_the_application"></a>Running The Application</h4></div></div></div><p>Open the <code class="literal">hello.html</code> file in a web-browser with JavaScript
enabled. You should see something similar to the following:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial1/snap1.png" align="middle" alt="Enter your name: __, Hello" /></div></div><p>Try entering some text in the text field, and press enter afterwards:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial1/snap2.png" align="middle" alt="Enter your name: John, Hello John" /></div></div><p>Notice that the text entered appears next to the “Hello” message
underneath the text field. This is due to the binding of the text
field to the <code class="literal">name</code> node and the binding of the <code class="literal">name</code> node to the
contents of the <code class="literal">span</code> element placed adjacent to the “Hello” text.</p><p>Now try changing the text entered in the text field:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial1/snap3.png" align="middle" alt="Enter your name: John Doe, Hello John Doe" /></div></div><p>The text changes to match the contents of the text field. This
demonstrates the automatic updating of a node’s state when the state
of its dependency nodes changes.</p><p>When the state (the value) of the text field changes:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
The state of the <code class="literal">name</code> node is updated to the text entered in the
field.
</li><li class="listitem">
The content of the <code class="literal">span</code> element is updated to match the state of
the <code class="literal">name</code> node.
</li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_inline_node_declarations"></a>1.3. Inline Node Declarations</h3></div></div></div><p>The previous application can be implemented much more succinctly using
implicit bindings and inline node declarations.</p><p><strong>hello-ui.html. </strong>
</p><pre class="programlisting">&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Hello Node&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Tutorial 1: Hello Node&lt;/h1&gt;
        &lt;label&gt;Enter your name: &lt;input value="&lt;?@ name ?&gt;"/&gt;&lt;/label&gt;
        &lt;p&gt;Hello &lt;?@ name @&gt;&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><p>Implicit bindings between an HTML node and a Tridash node can be
established using the <code class="literal">&lt;?@ declaration ?&gt;</code> tag. This is similar to the
Tridash code tag, seen earlier, however an implicit binding is
established between the nodes appearing in the tag and the HTML node
in which the tag appears.</p><p>If the tag is placed within an attribute of an element, an implicit
two-way binding is established between the element’s attribute and the
node, appearing in the tag. If the tag appears outside an attribute,
an HTML element is created in its place, and a binding is established
between the node appearing in the tag, and the content of the element
(referenced as <code class="literal">textContent</code> from Tridash).</p><p>With inline declarations it is not necessary to give the HTML elements
unique ID’s unless they will be referenced from within Tridash
code. In this example they have been omitted.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_two_way_bindings"></a>1.4. Two-Way Bindings</h3></div></div></div><p>The bindings we’ve seen so far are one-way bindings, as data only
flows in one direction, from the dependency node to the observer node.</p><p><strong>Example: One-Way Binding. </strong>
</p><pre class="screen">a -&gt; b</pre><p>
</p><p>This is a one-way binding since the value of <code class="literal">b</code> is updated to the
value of <code class="literal">a</code> when it changes, however, <code class="literal">a</code> is not updated when the
value of <code class="literal">b</code> changes.</p><p>If a binding in the reverse direction is also established:</p><pre class="screen">b -&gt; a</pre><p>the binding becomes a two-way binding since the value of each node is
updated when the value of the other node changes.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_example_application"></a>Example Application</h4></div></div></div><p>The following simple application demonstrates two-way bindings:</p><p><strong><code class="literal">ui.html</code>. </strong>
</p><pre class="programlisting">&lt;?
 a -&gt; b
 b -&gt; a
?&gt;

&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Two-Way Bindings&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Two-Way Bindings&lt;/h1&gt;
    &lt;div&gt;&lt;label&gt;A: &lt;input value="&lt;?@ a ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
    &lt;div&gt;&lt;label&gt;B: &lt;input value="&lt;?@ b ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><p>The applications consists of two text input fields with the first
field bound to node <code class="literal">a</code> and the second field bound to <code class="literal">b</code>, using
inline node declarations.</p><p>In the Tridash code tag, a two-way binding between <code class="literal">a</code> and <code class="literal">b</code> is
established since a binding is declared in both directions:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">a -&gt; b</code>
</li><li class="listitem">
<code class="literal">b -&gt; a</code>
</li></ul></div><p>Build the application using the following command, which is identical
to the previous build command with only the source and output file
names changed.</p><pre class="screen">tridashc ui.html : node-name=ui -o app.html -p type=html -p main-ui=ui</pre><p>Open the resulting <code class="literal">app.html</code> file in a web-browser, and enter a value
in the first text field:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial1/snap4.png" align="middle" alt="A: 1, B: 1" /></div></div><p>Notice that the content of the second text field is automatically
updated to match the content of the first field.</p><p>Now change the value in the second field:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial1/snap5.png" align="middle" alt="A: 3, B: 3" /></div></div><p>The value of the first field is updated to the value entered in the
second field.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_functional_bindings"></a>2. Functional Bindings</h2></div></div></div><p>The bindings in the previous tutorial were pretty boring and
limited. Whatever was entered in the text field was simply displayed
below it, verbatim. In-fact, this functionality is already offered by
many web frameworks and GUI toolkits. The real power of the Tridash
language comes from the ability to specify arbitrary functions in
bindings which are dependent on the values of more than a single
node. Moreover these bindings can be established in Tridash itself
without having to implement "transformer" or "converter"
interfaces/subclasses in a lower-level language.</p><p>A functor node is a node which is bound to a function of the values of
one or more nodes. It consists of an expression comprising an operator
applied to one or more arguments.</p><p><strong>Functor Node Syntax. </strong>
</p><pre class="screen">operator(argument1, argument2, ...)</pre><p>
</p><p>A binding is established between the argument nodes and the functor
node. Whenever the value of one of the argument nodes changes, the
expression is reevaluated and the value of the functor node is
updated.</p><p><strong>Example: Functor of one argument. </strong>
</p><pre class="screen">to-int(a)</pre><p>
</p><p>The functor node is <code class="literal">to-int(a)</code> consisting of the function <code class="literal">to-int</code>,
which converts its argument to an integer, applied to the value of
node <code class="literal">a</code>. When the value of <code class="literal">a</code> changes, the value of <code class="literal">to-int(a)</code> is
updated to <code class="literal">a</code>'s value converted to an integer.</p><p><strong>Example: Functor of two arguments. </strong>
</p><pre class="screen">a + b</pre><p>
</p><p>This is a functor node of the function <code class="literal">+</code> which computes, you guessed
it, the sum of its arguments, in this case <code class="literal">a</code> and <code class="literal">b</code>. Whenever the value
of either <code class="literal">a</code> or <code class="literal">b</code> changes, the value of <code class="literal">a + b</code> is updated to the
sum of <code class="literal">a</code> and <code class="literal">b</code>.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">+</code> operator is registered as an infix operator, meaning it
can be placed between its two arguments (infix notation), instead of
being placed before its arguments (prefix notation). <code class="literal">a + b</code> is
transformed to prefix notation <code class="literal">+(a, b)</code>, when parsed. Both notations
are equivalent and either notation can be written in source code.</p></td></tr></table></div><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The spaces between an infix operator and its arguments are
mandatory since <code class="literal">a+b</code> is a valid node identifier and is thus
interpreted as a single node with identifier <code class="literal">a+b</code>, rather than a
functor node of the <code class="literal">+</code> operator.</p></td></tr></table></div><p>Functor nodes can be bound to other nodes using the same <code class="literal">-&gt;</code> operator.</p><p><strong>Example: Binding functors to other nodes. </strong>
</p><pre class="screen">a + b -&gt; sum</pre><p>
</p><p>In this example node <code class="literal">sum</code> is bound to <code class="literal">a + b</code> which is bound to the
sum of <code class="literal">a</code> and <code class="literal">b</code>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_example_application_adding_numbers"></a>2.1. Example Application: Adding Numbers</h3></div></div></div><p>We’ll build an application which computes the sum of two numbers,
entered by the user, and displays the result.</p><p>Let’s focus on building the interface for now. Begin with the
following <code class="literal">ui.html</code> file:</p><p><strong>ui.html. </strong>
</p><pre class="programlisting">&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Adding Numbers&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Adding Numbers&lt;/h1&gt;
      &lt;div&gt;&lt;label&gt;A: &lt;input value="&lt;?@ a ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;div&gt;&lt;label&gt;B: &lt;input value="&lt;?@ b ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;hr/&gt;
      &lt;div&gt;&lt;strong&gt;A + B = &lt;?@ sum ?&gt;&lt;/strong&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><p>An interface consisting of two text input fields is created. The first
field is bound to node <code class="literal">a</code> and the second to node <code class="literal">b</code>. Underneath the
fields the node <code class="literal">sum</code> is bound to an unnamed HTML element located next
to “A + B =”.</p><p>Nodes <code class="literal">a</code> and <code class="literal">b</code> are bound to the values of the two numbers. Node
<code class="literal">sum</code> is to be bound to the sum of <code class="literal">a</code> and <code class="literal">b</code>.</p><p>Before we begin writing the binding declarations we need to import the
nodes from the <code class="literal">core</code> module, <span class="emphasis"><em>you’ll learn more about modules in a
later tutorial</em></span>, which we’ll be making use of in this application. The
following imports all nodes from the <code class="literal">core</code> module:</p><p><strong>Import all nodes from module <code class="literal">core</code>. </strong>
</p><pre class="screen">/import(core)</pre><p>
</p><p>Nodes <code class="literal">a</code> and <code class="literal">b</code> are bound to the contents of the text fields,
however the contents of the text fields are strings. We need to
convert <code class="literal">a</code> and <code class="literal">b</code> to integers in order to compute the sum. This is
achieved using the <code class="literal">to-int</code> operator.</p><p>The sum of the integer values of <code class="literal">a</code> and <code class="literal">b</code> is computed using the <code class="literal">+</code>
operator applied on the arguments <code class="literal">to-int(a)</code> and
<code class="literal">to-int(b)</code>.</p><p><strong>Computing Sum of <code class="literal">a</code> and <code class="literal">b</code>. </strong>
</p><pre class="screen">to-int(a) + to-int(b)</pre><p>
</p><p>Finally, we need to bind the sum to the node <code class="literal">sum</code> in order for it to
be displayed below the fields.</p><pre class="screen">to-int(a) + to-int(b) -&gt; sum</pre><p>Adding the declarations, we’ve written so far, to a Tridash code tag
(somewhere in the file such as at the beginning), completes the
application.</p><p><strong>Tridash Code Tag. </strong>
</p><pre class="screen">&lt;?
 /import(core)

 to-int(a) + to-int(b) -&gt; sum
?&gt;</pre><p>
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_build_configuration_file"></a>Build Configuration File</h4></div></div></div><p>To simplify the build command, the build options are specified in a
build configuration file.</p><p>The build configuration file contains the list of sources, along with
the source-specific options, and the output options in YAML syntax
<span class="emphasis"><em>(see <a class="ulink" href="https://yaml.org" target="_top">https://yaml.org</a> for details)</em></span>.</p><p>Create the following <code class="literal">build.yml</code> file:</p><p><strong>build.yml. </strong>
</p><pre class="screen">sources:
  - path: ui.html
    node-name: ui

output:
  path: app.html
  type: html
  main-ui: ui</pre><p>
</p><p>The outer structure of the file is a dictionary with two entries
<code class="literal">sources</code> and <code class="literal">output</code>.</p><p>The <code class="literal">sources</code> entry contains the list of source files either as a path
or as a dictionary with the path in the <code class="literal">path</code> entry and the
processing options in the remaining entries. In this application there
is one source file <code class="literal">ui.html</code> with one source processing option
<code class="literal">node-name</code> set to <code class="literal">ui</code>.</p><p>The <code class="literal">output</code> entry is a dictionary containing the path to the output
file in the path entry, in this case <code class="literal">app.html</code>, and the output
options in the remaining entries, in this case <code class="literal">type = html</code> and
<code class="literal">main-ui = ui</code> which are the same options as in the previous
tutorials.</p><p>To build from a build configuration file run the following command:</p><pre class="screen">tridashc -b build.yml</pre><p>The <code class="literal">-b</code> option specifies the path to the build configuration file
containing the build options. All other command line options are
ignored when this option is specified.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_running_the_application_2"></a>Running the Application</h4></div></div></div><p>Open the <code class="literal">app.html</code> file in a web browser, and enter some
numbers in the text fields:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial2/snap1.png" align="middle" alt="A: 2:, B: 3, A + B = 5" /></div></div><p>Notice that the sum of the numbers is automatically computed and
displayed below the fields.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The sum will only be displayed once you have entered a valid
number in each field.</p></td></tr></table></div><p>Now try changing the numbers (<span class="emphasis"><em>remember to press enter afterwards</em></span>):</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial2/snap2.png" align="middle" alt="A: 2, B: 8, A + B = 10" /></div></div><p>Notice that the sum is automatically recomputed and the new sum is
displayed.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_binding_to_functor_nodes"></a>2.2. Binding to Functor Nodes</h3></div></div></div><p>The <code class="literal">to-int</code> operator is special in that a two-way binding is
established between its argument and the functor node. Thus the
declaration <code class="literal">to-int(a)</code> also establishes the binding <code class="literal">to-int(a) -&gt; a</code>.
The binding in the reverse direction, from functor to argument, has
the same function as the binding from the argument to the
functor. Thus in <code class="literal">to-int(a) -&gt; a</code>, <code class="literal">a</code> is bound to the value of
<code class="literal">to-int(a)</code> converted to an integer.</p><p>This allows a binding to be established with a <code class="literal">to-int</code> functor node
as the observer.</p><p><strong>Example: Binding with <code class="literal">to-int</code> as observer. </strong>
</p><pre class="screen">x -&gt; to-int(a)</pre><p>
</p><p>In this example, <code class="literal">to-int(a)</code> is bound to <code class="literal">x</code>. Whenever the value of
<code class="literal">x</code> changes, the value of <code class="literal">to-int(a)</code> is set to it, and the value of
<code class="literal">a</code> is set to the value of <code class="literal">to-int(a)</code> converted to an integer.</p><p>With this functionality, the application in this tutorial can be
implemented more succinctly by moving the integer conversion from the
Tridash code tag to the inline node declarations.</p><p>Replace the declaration:</p><pre class="screen">to-int(a) + to-int(b) -&gt; sum</pre><p>with:</p><pre class="screen">a + b -&gt; sum</pre><p>Replace <code class="literal">&lt;?@ a ?&gt;</code> and <code class="literal">&lt;?@ b ?&gt;</code> with <code class="literal">&lt;?@ to-int(a) ?&gt;</code> and <code class="literal">&lt;?@
to-int(b) ?&gt;</code> respectively.</p><p>The benefit of this is that the value conversion logic is moved closer
to the point where the values are obtained, rather than being littered
throughout the core application logic. Nodes <code class="literal">a</code> and <code class="literal">b</code> can now be
used directly, without having to be converted first, since it is known
that they contain integer values.</p><p>To simplify the application further, the <code class="literal">sum</code> node can be omitted
entirely and <code class="literal">&lt;?@ sum ?&gt;</code> can be replaced with <code class="literal">&lt;?@ a + b ?&gt;</code>.</p><p><strong>Improved Application. </strong>
</p><pre class="programlisting">&lt;?
 /import(core)
?&gt;
&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Adding Numbers&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Adding Numbers&lt;/h1&gt;
      &lt;div&gt;&lt;label&gt;A: &lt;input value="&lt;?@ to-int(a) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;div&gt;&lt;label&gt;B: &lt;input value="&lt;?@ to-int(b) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;hr/&gt;
      &lt;div&gt;&lt;strong&gt;A + B = &lt;?@ a + b ?&gt;&lt;/strong&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">/import</code> declaration in the Tridash code tag has to be
retained as it is responsible for importing the nodes <code class="literal">to-int</code> and <code class="literal">+</code>
from the <code class="literal">core</code> module.</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_conditional_bindings"></a>3. Conditional Bindings</h2></div></div></div><p>This tutorial introduces functionality for conditionally selecting the
value of a node.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_case_operator"></a>3.1. Case Operator</h3></div></div></div><p>The special <code class="literal">case</code> operator selects the value of the first node for
which the value of the corresponding condition node is true. The
<code class="literal">case</code> operator is special in that it has a special syntax to make it
more readable.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">case</code> operator is actually a macro-node, implemented in
Tridash, which expands to a series of nested <code class="literal">if</code> functor
expressions. You can views its source in the <code class="literal">modules/core/macros.trd</code>
file of your Tridash installation.</p></td></tr></table></div><p><strong>Syntax. </strong>
</p><pre class="screen">case(
  condition-1 : value-1,
  condition-2 : value-2,
  ....
  default-value
)</pre><p>
</p><p>Each argument is of the form <code class="literal">condition : value</code> where <code class="literal">condition</code> is
the condition node and <code class="literal">value</code> is the corresponding value node. The
last argument may also be of the form <code class="literal">value</code>, that is there is no
condition node, in which case it becomes the <span class="emphasis"><em>default</em></span> or <span class="emphasis"><em>else</em></span> value.</p><p>The <code class="literal">case</code> functor node evaluates to the value of the value node
corresponding to the first condition node which has a <span class="emphasis"><em>true</em></span> value
(equal to the value of the builtin node <code class="literal">True</code>), or the value of the
default node, if any, when all condition nodes have a <span class="emphasis"><em>false</em></span> (equal
to the value of the builtin node <code class="literal">False</code>) value.</p><p><strong>Example. </strong>
</p><pre class="screen">case(
  a &gt; b : a - b
  b &gt; a : b - a
  0
)</pre><p>
</p><p>If the node <code class="literal">a &gt; b</code> evaluates to true, the <code class="literal">case</code> node evaluates to
the value of <code class="literal">a - b</code>, otherwise if <code class="literal">b &gt; a</code> evaluates to true, the
<code class="literal">case</code> node evaluates to the value of <code class="literal">b - a</code>. If neither <code class="literal">a &gt; b</code> nor
<code class="literal">b &gt; a</code> evaluate to true, the <code class="literal">case</code> node evaluates to <code class="literal">0</code>.</p><p>If the default value node is omitted and no condition node evaluates
to true, the <code class="literal">case</code> node evaluates to a failure value (<span class="emphasis"><em>you will learn
about failure values in a later tutorial which introduces error
handling</em></span>).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_example_1_maximum_of_two_numbers"></a>3.2. Example 1: Maximum of Two Numbers</h3></div></div></div><p>Let’s write a simple <code class="literal">case</code> expression which returns the maximum of
two numbers, <code class="literal">a</code> and <code class="literal">b</code>, and returns the string “neither” when
neither number is greater than the other.</p><p>The <code class="literal">case</code> expression should evaluate to:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
<code class="literal">a</code> if <code class="literal">a &gt; b</code>
</li><li class="listitem">
<code class="literal">b</code> if <code class="literal">b &gt; a</code>
</li><li class="listitem">
The string “neither” otherwise
</li></ol></div><p>These conditions are implemented by the following <code class="literal">case</code> expression:</p><pre class="screen">case(
    a &gt; b : a,
    b &gt; a : b,
    "neither"    <a id="CO1-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span>
)</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
This is the literal string “neither”.
</p></td></tr></table></div><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>String constants are written in double quotes <code class="literal">"..."</code>.</p></td></tr></table></div><p>Notice that the last argument does not have an associated
condition. The <code class="literal">case</code> node evaluates to this argument if none of the
conditions, of the previous arguments, evaluate to true.</p><p>We can incorporate this in a simple application, which displays the
maximum of two numbers entered by the user, using the following HTML
interface:</p><p><strong><code class="literal">ui.html</code>. </strong>
</p><pre class="programlisting">&lt;?
 /import(core)

 maximum &lt;-
     case (
         a &gt; b : a,
         b &gt; a : b,
         "neither"
     )
?&gt;
&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Maximum&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Maximum&lt;/h1&gt;
      &lt;div&gt;&lt;label&gt;A: &lt;input value="&lt;?@ to-int(a) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;div&gt;&lt;label&gt;B: &lt;input value="&lt;?@ to-int(b) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;hr/&gt;
      &lt;div&gt;&lt;strong&gt;The maximum of &lt;?@ a ?&gt; and &lt;?@ b ?&gt; is &lt;?@ maximum ?&gt;.&lt;/strong&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">&lt;-</code> operator is the same as the <code class="literal">-&gt;</code> operator however with
the arguments reversed, that is <code class="literal">b &lt;- a</code> is equivalent to <code class="literal">a -&gt; b</code>.</p></td></tr></table></div><p>The interface consists of two text fields, the contents of which are
bound to nodes <code class="literal">a</code> and <code class="literal">b</code>. The <code class="literal">to-int</code> operator is used to convert
the string values to integers as in the previous tutorial.</p><p>The node <code class="literal">maximum</code> is bound to the value of the <code class="literal">case</code> functor, and
its value is displayed in an unnamed HTML element below the input
fields.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The values of <code class="literal">a</code> and <code class="literal">b</code> are also displayed below the input
fields. This is to demonstrate that there is no limit to how many
nodes can be bound to a particular node.</p></td></tr></table></div><p>Build and run the application, using the same build configuration file
and command from the previous tutorials.</p><p>Enter some numbers in the text fields:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial3/snap1.png" align="middle" alt="A: 10, B: 15, The maximum of 10 and 15 is 15" /></div></div><p>Notice that the maximum, 15 in this case, is displayed below the text
fields. Also notice that the values entered in the text fields are
displayed as part of the message.</p><p>Now change the number, which is the maximum, to a different value
which is still greater than the other number:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial3/snap2.png" align="middle" alt="A: 10, B: 17, The maximum of 10 and 17 is 17" /></div></div><p>The new maximum is displayed. This demonstrates that if the values of
the value nodes, of the <code class="literal">case</code> expression change, the value of the
<code class="literal">case</code> expression is updated.</p><p>Change the maximum number such that it is smaller than the other
number:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial3/snap3.png" align="middle" alt="A: 10, B: 6, The maximum of 10 and 6 is 10" /></div></div><p>This shows that the value of the <code class="literal">case</code> expression is also updated if
the values of the condition nodes change.</p><p>Now finally change the numbers such that they are both equal:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial3/snap4.png" align="middle" alt="A: 10, B: 10, The maximum of 10 and 10 is neither" /></div></div><p>The displayed maximum is “neither” which is the default value of the
case expression.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_example_2_sum_limit"></a>3.3. Example 2: Sum Limit</h3></div></div></div><p>Let’s extend the application developed during the previous tutorial by
adding the functionality for specifying a limit to the sum of the two
numbers. The application should inform the user of whether the limit
was exceeded.</p><p>Start with the following slightly modified code from the previous
tutorial.</p><pre class="screen">&lt;?
 /import(core)

 a + b -&gt; sum
?&gt;
&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Sum Limit&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Sum Limit&lt;/h1&gt;
      &lt;div&gt;&lt;label&gt;Limit: &lt;input value="&lt;?@ to-int(limit) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;hr/&gt;
      &lt;div&gt;&lt;label&gt;A: &lt;input value="&lt;?@ to-int(a) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;div&gt;&lt;label&gt;B: &lt;input value="&lt;?@ to-int(b) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;hr/&gt;
      &lt;div&gt;&lt;strong&gt;A + B = &lt;?@ sum ?&gt;&lt;/strong&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>A new text input field for the limit has been added, with its value
bound to the node <code class="literal">limit</code>.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The sum <code class="literal">a + b</code> is bound to the node <code class="literal">sum</code> in order to
facilitate the implementation of the new features.</p></td></tr></table></div><p>The message “Within limit.” should be displayed if the sum is less
than the limit (<code class="literal">sum &lt; limit</code>), and “Limit Exceeded!”
otherwise. This can be implemented using the following <code class="literal">case</code>
expression, which is bound directly to an unnamed element.</p><p>Add the following below the element where the sum is displayed.</p><pre class="programlisting">&lt;div&gt;
  &lt;?@
    case(
        sum &lt; limit : "Within Limit.",
        "Limit Exceeded!"
    )
  ?&gt;
&lt;/div&gt;</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>There is no difference in efficiency between using the <code class="literal">sum</code>
node or <code class="literal">a + b</code> directly. The value of a node is only computed once,
whenever one of its arguments changes, even if it is referenced in
more than one location. Moreover the value of a node is not computed
if it is not used anywhere.</p></td></tr></table></div><p>Build and run the application, and enter some initial values for the
limit, <code class="literal">a</code> and <code class="literal">b</code>.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial3/snap5.png" align="middle" alt="Limit: 10, A: 8, B: 3, A + B = 11, Limit Exceeded!" /></div></div><p>“Limit Exceeded!” is displayed since the sum of 11 did indeed exceed
the limit of 10, with the numbers in the snapshot above.</p><p>Now try increasing the limit:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial3/snap6.png" align="middle" alt="Limit: 20, A: 8, B: 3, A + B = 11, Within Limit." /></div></div><p>The message changes to “Within Limit.”.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_improvements"></a>3.4. Improvements</h3></div></div></div><p>Whilst the application we’ve implemented so far demonstrates the power
of functional bindings, it is rather lacking in that whether the limit
has been exceeded or not is only indicated by text. The text has to be
read in full to determine whether the limit was exceeded, and changes
from <span class="emphasis"><em>Within Limit</em></span> to <span class="emphasis"><em>Limit Exceeded</em></span>, and vice versa, are hard to
notice. Some visual indications, such as a change in the color of the
sum, when the limit is exceeded, would be helpful.</p><p>As an improvement, we would like the text color of the the sum, and
the status message, to be <span class="red">red</span> when the sum exceeds the limit,
and to be <span class="green">green</span> when it is within the limit.</p><p>Let’s start off by giving an ID to the elements in which the sum and
status message are displayed, so that they can be referenced from
Tridash code. Surround <code class="literal">&lt;?@ sum ?&gt;</code> in a <code class="literal">span</code> element with ID <code class="literal">sum</code>
and assign the <code class="literal">div</code> element, containing the status message, the ID
<code class="literal">status</code>.</p><pre class="screen">&lt;div&gt;&lt;strong&gt;A + B = &lt;span id="sum"&gt;&lt;?@ sum ?&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/div&gt;
&lt;div id="status"&gt;
  &lt;?@
    case(
        sum &lt; limit : "Within Limit.",
        "Limit Exceeded!"
    )
  ?&gt;
&lt;/div&gt;</pre><p>Let’s create a node <code class="literal">color</code> which will be bound to the text color in
which the sum and status message should be displayed. It should have
the value <code class="literal">"green"</code> when the sum is within the limit and the value
<code class="literal">"red"</code> when the sum exceeds the limit. This can be achieved by
binding to a <code class="literal">case</code> functor node.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The values <code class="literal">"green"</code> and <code class="literal">"red"</code> are strings, representing CSS
color names.</p></td></tr></table></div><p>Add the following to the Tridash code tag.</p><pre class="screen">case(
  sum &lt; limit : "green",
  "red"
) -&gt; color</pre><p>The value of the <code class="literal">case</code> functor node is <code class="literal">"green"</code> if <code class="literal">sum</code> is less
than <code class="literal">limit</code> and <code class="literal">"red"</code> otherwise. The case functor node is bound to
the <code class="literal">color</code> node.</p><p>The <code class="literal">color</code> node somehow has to be bound to the text color of the
<code class="literal">sum</code> and <code class="literal">status</code> elements. Text color is a style attribute of an
element. All style attributes are grouped under a single subnode
<code class="literal">style</code> of the HTML element node. The text color is controlled by the
<code class="literal">color</code> attribute, referenced using <code class="literal">style.color</code>.</p><p>The <code class="literal">color</code> node is bound to the style attributes of the elements with
the following (add to the Tridash code tag):</p><pre class="screen">color -&gt; self.sum.style.color
color -&gt; self.status.style.color</pre><p>Full <code class="literal">ui.html</code> code:</p><p><strong>ui.html. </strong>
</p><pre class="programlisting">&lt;?
 /import(core)

 a + b -&gt; sum

 case (
     sum &lt; limit : "green",
     "red"
 ) -&gt; color

 color -&gt; self.sum.style.color
 color -&gt; self.status.style.color
?&gt;
&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Sum Limit&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Sum Limit&lt;/h1&gt;
      &lt;div&gt;&lt;label&gt;Limit: &lt;input value="&lt;?@ to-int(limit) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;hr/&gt;
      &lt;div&gt;&lt;label&gt;A: &lt;input value="&lt;?@ to-int(a) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;div&gt;&lt;label&gt;B: &lt;input value="&lt;?@ to-int(b) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;hr/&gt;
      &lt;div&gt;&lt;strong&gt;A + B = &lt;span id="sum"&gt;&lt;?@ sum ?&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/div&gt;
      &lt;div id="status"&gt;
        &lt;?@
          case(
              sum &lt; limit : "Within Limit.",
              "Limit Exceeded!"
          )
        ?&gt;
      &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><p>Build and run the application. Enter some values for <code class="literal">a</code>, <code class="literal">b</code> and the
limit such that the sum exceeds the limit.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial3/snap7.png" align="middle" alt="Limit: 10, A: 2, B: 9, A + B = 11 (red), Limit Exceeded! (red)" /></div></div><p>The status message and sum are now shown in red which provides an
immediate visual indication that the limit has been exceeded.</p><p>Now increase the limit, or decrease the values of <code class="literal">a</code> and <code class="literal">b</code>:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial3/snap8.png" align="middle" alt="Limit: 20, A: 2, B: 9, A + B = 11 (green), Within Limit. (green)" /></div></div><p>The color of the status message and sum is immediately changed to
green, which provides a noticeable indication that the limit has no
longer been exceeded.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="functions"></a>4. Writing your own Functions</h2></div></div></div><p>In this tutorial you’ll learn how to create your own functions, which
can be used in functional bindings. Another feature which distinguishes
Tridash from frameworks/toolkits, which offer bindings, is that new
functions can be written in the same language, as the language in
which the bindings are declared, rather than having to be implemented
in a lower-level language.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Only some of the example applications will be
demonstrated. Visit the source code for the tutorials to try out the
remaining applications.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_definition_operator"></a>4.1. Definition Operator</h3></div></div></div><p>New functions, referred to as meta-nodes, are defined using the
special <code class="literal">:</code> operator, which has the following syntax:</p><pre class="screen">function(arg1, arg2, ...) : {
   declarations...
}</pre><p>The left-hand side contains the function name (<code class="literal">function</code>) followed by
the argument list in brackets, where each item (<code class="literal">arg1</code>, <code class="literal">arg2</code>, …)
is the name of the local node to which the argument at that position
is bound.</p><p>The right-hand side, of the <code class="literal">:</code> operator, contains the declarations
making up the body of the function, which may consist of any Tridash
node declaration. The value of the last node in the <code class="literal">declarations</code>
list is returned by the function.</p><p>The meta-node can then be used as the operator of functor nodes, which
are referred to as instances of the meta-node, declared after its
definition.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The curly braces <code class="literal">{</code> and <code class="literal">}</code> are optional if the meta-node body
consists of a single declaration.</p></td></tr></table></div><p><strong>Example Adding Two Numbers. </strong>
</p><pre class="screen"># Add two numbers    <a id="CO2-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span>

add(x, y) : x + y</pre><p>
</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
This is a comment. Comments begin with a <code class="literal">#</code> character and extend
till the end of the line. All text within a comment is discarded.
</p></td></tr></table></div><p>In this example, an <code class="literal">add</code> meta-node is defined which takes two
arguments, <code class="literal">x</code> and <code class="literal">y</code>, and returns their sum.</p><p>Our sum application can thus be rewritten as follows:</p><pre class="screen">&lt;?
 /import(core)

 # Add two numbers

 add(x, y) : x + y
?&gt;

...

&lt;div&gt;&lt;label&gt;A: &lt;input value="&lt;?@ to-int(a) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
&lt;div&gt;&lt;label&gt;B: &lt;input value="&lt;?@ to-int(b) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;

A + B is &lt;?@ add(a, b) ?&gt;
...</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_node_literal_self_literal"></a>4.2. Node <code class="literal">self</code></h3></div></div></div><p>When an explicit binding to the <code class="literal">self</code> node is established inside a
meta-node, the value of the <code class="literal">self</code> node is returned rather than the
value of the last node in the meta-node’s body.</p><p>The following is an alternative implementation of the <code class="literal">add</code> meta-node.</p><pre class="screen">add(x, y) : {
    x + y -&gt; self
}</pre><p>This is particularly useful when binding to subnodes of the <code class="literal">self</code>
node, which you’ll learn about later.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_optional_arguments"></a>4.3. Optional Arguments</h3></div></div></div><p>Meta-node arguments can be designated as optional by giving the
argument a default value. An optional argument is of the form <code class="literal">arg :
value</code>, where <code class="literal">arg</code> is the argument node identifier and <code class="literal">value</code> is the
default value, to which it is bound, if it is not provided.</p><p><strong>Example. </strong>
</p><pre class="screen">increment(n, delta : 1) : n + delta</pre><p>
</p><p>In this example, the argument <code class="literal">delta</code> is optional and is given the
default value 1 if it is not provided.</p><p><strong>Examples. </strong>
</p><pre class="screen">increment(n)    # delta defaults to 1
increment(n, 2) # delta = 2</pre><p>
</p><p>Default values don’t have to be constants, in-fact any node expression
can be used as a default value. In the case that the default value is
a node, then that node will be implicitly bound to all instances of
the meta-node, for which the argument is not provided.</p><p><strong>Example: Node Default Values. </strong>
</p><pre class="screen"># Increment `n` by `d`

increment(n, d : delta) : n + d</pre><p>
</p><p>In this example the default value for the delta <code class="literal">d</code> is the value of
the global node <code class="literal">delta</code>. A binding between <code class="literal">delta</code> and each instance
of <code class="literal">increment</code>, for which a value for <code class="literal">d</code> is not provided, will be
established.</p><p>The effect of this is demonstrated in the following example
application:</p><p><strong><code class="literal">ui.html</code>. </strong>
</p><pre class="programlisting">&lt;?
 /import(core)

 # Increment `n` by `d`

 increment(n, d : delta) : n + d
?&gt;
&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Optional Argument Default Value&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Optional Argument Default Value&lt;/h1&gt;
      &lt;div&gt;&lt;label&gt;N: &lt;br/&gt;&lt;input value="&lt;?@ to-int(n) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;div&gt;&lt;label&gt;Delta: &lt;br/&gt;&lt;input value="&lt;?@ to-int(delta) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;hr/&gt;
      &lt;div&gt;&lt;strong&gt;Increment(N): &lt;?@ increment(n) ?&gt;&lt;/strong&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><p>Enter an initial value for <span class="emphasis"><em>N</em></span> and <span class="emphasis"><em>Delta</em></span>:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial4/snap1.png" align="middle" alt="N: 5, Delta: 1, Increment(N): 6" /></div></div><p>The value given to the delta (<code class="literal">d</code>) argument of <code class="literal">increment</code> is the
initial value given for <span class="emphasis"><em>Delta</em></span>, which is <code class="literal">1</code>.</p><p>Now try changing <span class="emphasis"><em>Delta</em></span>:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial4/snap2.png" align="middle" alt="N: 5, Delta: 2, Increment(N): 7" /></div></div><p>The value of the <code class="literal">increment(n)</code> node is updated, with the new value of
<span class="emphasis"><em>Delta</em></span> given as the delta argument. This shows that a binding is
established rather than simply taking the value of the <code class="literal">delta</code> node.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_recursive_meta_nodes"></a>4.4. Recursive Meta-Nodes</h3></div></div></div><p>A recursive meta-node contains an instance of itself in its
definition.</p><p>The following are the classic examples of recursion:</p><p><strong>Example: Factorial. </strong>
</p><pre class="screen">factorial(n) :
    case(
        n &lt; 1 : 1,  # Ignoring the case: n &lt; 0
        n * factorial(n - 1)
    )</pre><p>
</p><p><strong>Example: Fibonacci Numbers. </strong>
</p><pre class="screen">fib(n) :
    case(
        n &lt;= 1 : 1,
        fib(n - 1) + fib(n - 2)
    )</pre><p>
</p><p>Recursion is the means by which Tridash provides iteration. The
definition of <code class="literal">factorial</code>, above, will result in the stack space being
exhausted for large values of <code class="literal">n</code>. This is due to the fact that each
invocation of the meta-node consumes a certain amount of stack
space. Since the recursive call to <code class="literal">factorial</code> has to be evaluated
before the return value of the current call can be computed, the
meta-node consumes an amount of stack space proportional to the value
of <code class="literal">n</code>.</p><p>If the definition is rewritten such that it is tail recursive, that is
the return value of <code class="literal">factorial</code> is the return value of the recursive
call, a constant amount of stack space is consumed.</p><p><strong>Example: Tail-Recursive Factorial. </strong>
</p><pre class="screen">factorial(n, acc : 1) :
    case(
        n &lt; 1 : acc,  # Ignoring the case: n &lt; 0
        factorial(n - 1, n * acc)
    )</pre><p>
</p><p>This definition of <code class="literal">factorial</code> is tail recursive since the recursive
call appears directly as the default value of the <code class="literal">case</code> expression,
which is simply returned without any further operations performed on
it.</p><p>In the previous implementation, the multiplication was performed on
the result of the recursive call to <code class="literal">factorial</code>. In this
implementation, the multiplication is performed on an accumulator
argument, <code class="literal">acc</code> which is passed on to the recursive call and
eventually returned when <code class="literal">factorial</code> is called with <code class="literal">n &lt; 1</code>.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Tridash supports general <span class="emphasis"><em>tail call optimization</em></span> for mutually
recursive meta-nodes.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_nested_meta_nodes"></a>4.5. Nested Meta-Nodes</h3></div></div></div><p>A meta-node may contain other meta-nodes inside its definition. These
meta-nodes may only be used within the body of the meta-node and
shadow meta-nodes, declared in the enclosing scope, with the same
identifiers.</p><p>With nested meta-nodes we can rewrite our previous tail-recursive
<code class="literal">factorial</code> meta-node without having to expose the accumulator
argument <code class="literal">acc</code>, which is an implementation detail.</p><p><strong>Example: Factorial with nested <code class="literal">iter</code> meta-node. </strong>
</p><pre class="screen">factorial(n) : {
    iter(n, acc) : {
        case(
            n &lt; 1 : acc,  # Ignoring the case: n &lt; 0
            iter(n - 1, n * acc)
        )
    }

    iter(n, 1)
}</pre><p>
</p><p>The computation of the factorial is implemented in the nested
tail-recursive meta-node <code class="literal">iter</code>. The <code class="literal">factorial</code> meta-node simply
calls this meta-node with the initial value for the accumulator.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_local_nodes"></a>4.6. Local Nodes</h3></div></div></div><p>Nodes which appear as the <span class="emphasis"><em>target</em></span> (observer) of a binding, declared
within the body of a meta-node, are local to the meta-node’s body and
may only be referenced within it. These may be used to store
intermediate results or to break up complex expression into multiple
nodes.</p><p><strong>Example: Average. </strong>
</p><pre class="screen">average(a, b) : {
    sum &lt;- a + b    <a id="CO3-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span>
    sum / 2
}</pre><p>
</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Node <code class="literal">sum</code> is the binding <span class="emphasis"><em>target</em></span> in this declaration.
</p></td></tr></table></div><p>In this example a local node <code class="literal">sum</code> is created, since it is bound (as
the <span class="emphasis"><em>target</em></span>) to the value of <code class="literal">a + b</code>. The value returned by <code class="literal">average</code>
is the value of <code class="literal">sum</code> divided by 2.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_referencing_outer_nodes"></a>4.7. Referencing Outer Nodes</h3></div></div></div><p>A meta-node may reference nodes declared in the global scope or the
enclosing scope(s) containing the meta-node definition. This creates a
binding between the referenced node and each instance of the
meta-node. The net result is that whenever the value of the referenced
node changes, the value of the instance is recomputed. In essence a
reference to an outer node can be thought of as an additional hidden
argument.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>An outer node with the same identifier as a local node can be
referenced with the <code class="literal">..</code> operator, e.g. <code class="literal">..(x)</code>.</p></td></tr></table></div><p>Outer node references can be demonstrated by changing the definition
of <code class="literal">increment</code>, in the <span class="emphasis"><em>Increment</em></span> Application developed earlier in
this tutorial, to the following:</p><p><strong>Increment with reference to <code class="literal">delta</code>. </strong>
</p><pre class="screen">increment(n) : n + delta</pre><p>
</p><p>The <code class="literal">d</code> argument has been removed and replaced with <code class="literal">delta</code> in the
body.</p><p>Repeat the same experiment, changing the delta. You should observe the
same results.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_fun_example_simple_meter"></a>4.8. Fun Example: Simple Meter</h3></div></div></div><p>In this example we’ll be developing an application which displays a
simple meter, representing a quantity, which changes color as the
quantity approaches the maximum.</p><p>Let’s start off with the following HTML interface:</p><p><strong>ui.html. </strong>
</p><pre class="programlisting">&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
      &lt;title&gt;Simple Meter&lt;/title&gt;
      &lt;style&gt;
        .meter-box {
            margin-top: 5px;
            width: 200px;
            height: 1em;
            border: 1px solid black;
        }
        .meter-bar {
            height: 100%;
        }
      &lt;/style&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Simple Meter&lt;/h1&gt;
      &lt;div&gt;&lt;label&gt;Maximum: &lt;input value="&lt;?@ to-real(maximum) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;div&gt;&lt;label&gt;Quantity: &lt;input value="&lt;?@ to-real(quantity) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;div class="meter-box"&gt;
        &lt;div id="meter" class="meter-bar"&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The file contains a few CSS class definitions for styling the
elements which display the meter, located at the bottom of the file.</p></td></tr></table></div><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">to-real</code> meta-node is similar to <code class="literal">to-int</code> except that it
converts its argument to a <span class="emphasis"><em>real</em></span> number rather than an integer.</p></td></tr></table></div><p>The interface consists of two input fields for entering the values for
the <span class="emphasis"><em>Maximum</em></span> and <span class="emphasis"><em>Quantity</em></span>, which are bound to the nodes <code class="literal">maximum</code>
and <code class="literal">quantity</code>, respectively.</p><p>We’d like the meter to be displayed in a color which is in between
<span class="green">green</span> (empty) and <span class="red">red</span> (full) depending on where the
value of the quantity lies between 0 and the maximum.</p><p>First we’ll write a utility meta-node <code class="literal">lerp</code> for linearly
interpolating between two values:</p><p><strong>Meta-Node <code class="literal">lerp</code>. </strong>
</p><pre class="screen">lerp(a, b, alpha) : a + alpha * (b - a)</pre><p>
</p><p>The value returned by <code class="literal">lerp</code> is the value between <code class="literal">a</code> and <code class="literal">b</code>
proportional to where <code class="literal">alpha</code> lies between <code class="literal">0</code> and <code class="literal">1</code>.</p><p>This meta-node will be used to interpolate between green and red
depending on where the quantity lies between 0 and the maximum.</p><p>We can compute the value for <code class="literal">alpha</code> by dividing the value for the
quantity by the maximum.</p><pre class="screen">scale &lt;- quantity / maximum</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>This assumes that <code class="literal">maximum</code> is not 0.</p></td></tr></table></div><p>Before we perform the interpolation, we need to make sure that <code class="literal">scale</code>
is a value between 0 and 1. Let’s write another utility meta-node
<code class="literal">clamp</code> which clamps a value to a given range.</p><p><strong>Meta-Node <code class="literal">clamp</code>. </strong>
</p><pre class="screen">clamp(x, min, max) :
    case (
        x &lt; min : min,
        x &gt; max : max,
        x
    )</pre><p>
</p><p>This meta-node returns the value of its first argument <code class="literal">x</code> if it is
between <code class="literal">min</code> and <code class="literal">max</code>, otherwise returns <code class="literal">min</code> if <code class="literal">x</code> is less than
<code class="literal">min</code>, or <code class="literal">max</code> if <code class="literal">x</code> is greater than <code class="literal">max</code>.</p><p>We can amend the computation of <code class="literal">scale</code> such that it does not exceed
<code class="literal">0</code> and <code class="literal">1</code>, by using the <code class="literal">clamp</code> meta-node.</p><pre class="screen">scale &lt;- clamp(quantity / maximum, 0, 1)</pre><p>Finally we can interpolate between the two colours. We’ll be using the
HSL (Hue Saturation Luminance) colorspace, and interpolating in the
<span class="emphasis"><em>Hue</em></span> component.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The HSL, rather than the RGB, colorspace was used as it provides
better interpolation results.</p></td></tr></table></div><pre class="screen">hue &lt;- lerp(120, 0, scale)</pre><p><code class="literal">hue</code> is bound to a value interpolated between green (Hue 120) and red
(Hue 0) with the value of <code class="literal">scale</code> as the interpolation coefficient.</p><p>Before we bind the interpolated color to the color of the meter, let’s
write another utility meta-node which takes values for the hue,
saturation and luminance components and produces a CSS HSL color
string.</p><p><strong>Meta-Node <code class="literal">make-hsl</code>. </strong>
</p><pre class="screen">make-hsl(h, s, l) :
    format("hsl(%s,%s%%,%s%%)", h, s, l)</pre><p>
</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">format</code> meta-node produces a string in which <code class="literal">%s</code> placeholders in
the format string (the first argument) are replaced with the values of
the corresponding arguments (following the format string). <code class="literal">%%</code>
placeholders are replaced with literal <code class="literal">%</code> characters.</p><p><code class="literal">format("Hello %s %s.", "John", "Smith")</code> produces the string “Hello
John Smith.”, as the first <code class="literal">%s</code> is replaced with <code class="literal">"John"</code> and the
second <code class="literal">%s</code> is replaced with <code class="literal">"Smith"</code>.</p></td></tr></table></div><p>We can now generate a valid CSS color string using <code class="literal">make-hsl</code> that
we’ll bind to the color of the meter element, which is the element
with ID <code class="literal">meter</code>.</p><pre class="screen">self.meter.style.backgroundColor &lt;-
    make-hsl(hue, 90, 45)</pre><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">backgroundColor</code> style attribute references the background
color of an element.</p></td></tr></table></div><p>The constant values <code class="literal">90</code> and <code class="literal">45</code> have been chosen for the saturation
and luminance components.</p><p>The last thing we need to do is adjust the width of the meter
depending on the quantity value. We’ll simply multiply the value of
<code class="literal">scale</code> by 100, to convert it to a percentage (indicating it should
occupy that percentage of the width of its parent element), and bind
it to the meter element’s width attribute.</p><pre class="screen">format("%s%%", scale * 100) -&gt; self.meter.style.width</pre><p>Our application is complete. Add the following Tridash code tag to the
top of the <code class="literal">ui.html</code> file.</p><pre class="screen">&lt;?
 /import(core)

 # Utilities

 lerp(a, b, alpha) : a + alpha * (b - a)

 clamp(x, min, max) :
     case (
         x &lt; min : min,
         x &gt; max : max,
         x
     )

 make-hsl(h, s, l) :
     format("hsl(%s,%s%%,%s%%)", h, s, l)


 # Application Logic

 scale &lt;- clamp(quantity / maximum, 0, 1)

 hue &lt;- lerp(120, 0, scale)

 self.meter.style.backgroundColor &lt;-
     make-hsl(hue, 90, 45)

 format("%s%%", scale * 100) -&gt; self.meter.style.width
?&gt;</pre><p>Build and run the application, and enter some values for the quantity
and maximum, such that the quantity is less than half the maximum.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial4/snap3.png" align="middle" alt="Maximum: 100, Quantity: 20, [Almost empty bright green meter]" /></div></div><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial4/snap4.png" align="middle" alt="Maximum: 100, Quantity: 40, [Almost empty dull green meter]" /></div></div><p>The meter is mostly empty and displayed in a green color.</p><p>Now increase the quantity such that it is greater than half the maximum.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial4/snap5.png" align="middle" alt="Maximum: 100, Quantity: 60, [Half full yellow meter]" /></div></div><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial4/snap6.png" align="middle" alt="Maximum: 100, Quantity: 90, [Almost full red meter]" /></div></div><p>The meter is more than half full and its color approaches red as the
quantity approaches the maximum.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_subnodes"></a>5. Subnodes</h2></div></div></div><p>You’ve already made use of subnodes in the previous tutorials, when
binding to attributes of HTML elements. Now we’ll explores subnodes in
depth.</p><p>A subnode is a node which references a value out of a dictionary of
values stored in a parent node.</p><p><strong>Subnode Syntax. </strong>
</p><pre class="screen">parent.key</pre><p>
</p><p>The left hand side of the subnode <code class="literal">.</code> operator is the parent node
expression and the right hand side is the key identifying the
dictionary entry.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="literal">key</code> is interpreted as a literal symbol rather than a node
identifier.</p></td></tr></table></div><p>A dictionary can be created in a node by binding to a subnode of the
node.</p><p><strong>Example. </strong>
</p><pre class="screen">"John" -&gt; person.name
"Smith" -&gt; person.surname</pre><p>
</p><p>In this example, the value of the node <code class="literal">person</code> is a dictionary with
two entries</p><div class="horizontal"><table class="horizontal" cellpadding="4px" style="border: none;"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td style="" valign="top">
<p>
<code class="literal">name</code>
</p>
</td><td style="" valign="top">
<p>
Bound to the string constant “John”.
</p>
</td></tr><tr><td style="" valign="top">
<p>
<code class="literal">surname</code>
</p>
</td><td style="" valign="top">
<p>
Bound to the string constant “Smith”.
</p>
</td></tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_example_color_object"></a>5.1. Example: Color Object</h3></div></div></div><p>The meter application developed during the previous tutorial was a bit
of mess with the various color components scattered through the code.</p><p>To change the colors you’d first have to change the hue components, in
the following code:</p><pre class="screen">hue &lt;- lerp(120, 0, scale)</pre><p>It isn’t clear what the numbers <code class="literal">120</code> and <code class="literal">0</code> are supposed to be or
which number corresponds to the hue component of which color.</p><p>To change the luminance and saturation components, you’d have to
modify the following:</p><pre class="screen">self.meter.style.backgroundColor &lt;-
    make-hsl(hue, 90, 45)</pre><p>There is also no interpolation of the saturation or luminance
components.</p><p>The code can be made significantly more readable and maintainable by
making use of a dedicated <span class="emphasis"><em>color object</em></span>.</p><p>We’ll create a meta-node <code class="literal">Color</code> which takes the three color
components as arguments and returns a dictionary storing the
components under the entries: <code class="literal">hue</code>, <code class="literal">saturation</code> and <code class="literal">luminance</code>.</p><p>How are we going to return a dictionary from a meta-node? We can
create a dedicated local node, in which the dictionary is created,
such as the following:</p><pre class="screen">Color(hue, saturation, luminance) : {
    hue -&gt; color.hue
    saturation -&gt; color.saturation
    luminance -&gt; color.luminance

    color
}</pre><p>Or we can simply bind to subnodes of the <code class="literal">self</code> node.</p><p><strong>Meta-Node <code class="literal">Color</code>. </strong>
</p><pre class="screen">Color(hue, saturation, luminance) : {
    hue -&gt; self.hue
    saturation -&gt; self.saturation
    luminance -&gt; self.luminance
}</pre><p>
</p><p>The dictionary returned by <code class="literal">Color</code> is how colors will be represented
in our application. Let’s create color objects for the two colors and
bind them to nodes:</p><pre class="screen">color-empty &lt;- Color(120, 90, 45)
color-full  &lt;- Color(0, 90, 45)</pre><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="literal">color-empty</code> and <code class="literal">color-full</code> are examples of constant nodes as
their values are not dependent on other nodes and are thus effectively
constant.</p></td></tr></table></div><p>Rather than interpolating between the components of <code class="literal">color-empty</code> and
<code class="literal">color-full</code> in the global scope, we can create a meta-node that takes
two colors and the alpha coefficient, and returns the interpolated
color.</p><p><strong>Meta-Node <code class="literal">lerp-color</code>. </strong>
</p><pre class="screen">lerp-color(c1, c2, alpha) :
    Color(
        lerp(c1.hue, c2.hue, alpha),
        lerp(c1.saturation, c2.saturation, alpha),
        lerp(c1.luminance, c2.luminance, alpha)
    )</pre><p>
</p><p>The <code class="literal">lerp-color</code> meta-node simply creates a new color, using the
<code class="literal">Color</code> meta-node, with each component interpolated between the two
colors, using <code class="literal">lerp</code>.</p><p>We can use this to easily interpolate between the colors:</p><pre class="screen">color &lt;- lerp-color(color-empty, color-full, scale)</pre><p>To convert the Color object to a CSS color string we have to pass each
component to <code class="literal">make-hsl</code> as an individual argument like so:</p><pre class="screen">make-hsl(color.hue, color.saturation, color.luminance)</pre><p>However, the internal representational details of the color are
leaking into the application logic. All it takes is to accidentally
pass a single component twice or pass the components in the wrong
order and there is a bug.</p><p>To rectify this we can rewrite <code class="literal">make-hsl</code> to take a Color object or we
can bind a subnode of the Color object to the CSS color string.</p><p>Modify <code class="literal">Color</code> to the following:</p><pre class="screen">Color(hue, saturation, luminance) : {
    hue -&gt; self.hue
    saturation -&gt; self.saturation
    luminance -&gt; self.luminance

    make-hsl(hue, saturation, luminance) -&gt; self.hsl-string
}</pre><p>We’ve added a new declaration to <code class="literal">Color</code> which binds the <code class="literal">hsl-string</code>
subnode of <code class="literal">self</code> to the CSS HSL color string, created using
<code class="literal">make-hsl</code>. Since the values of nodes are only evaluated if they are
used, and subnodes are no different, the value of the subnode
<code class="literal">hsl-string</code> will only be computed for the final <code class="literal">color</code> object, not
the <code class="literal">color-empty</code> and <code class="literal">color-full</code> objects.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>If you’d like to make the code even neater you can move the
definition of the <code class="literal">make-hsl</code> meta-node inside the <code class="literal">Color</code> meta-node.</p></td></tr></table></div><p>The interpolated color can be bound to the meter’s background color
with the following:</p><pre class="screen"> color.hsl-string -&gt; self.meter.style.backgroundColor</pre><p>We now have a new more readable and maintainable version of the meter
application. Replace the Tridash code tag with the following:</p><pre class="screen">&lt;?
 /import(core)

 # Utilities

 lerp(a, b, alpha) : a + alpha * (b - a)

 clamp(x, min, max) :
     case (
         x &lt; min : min,
         x &gt; max : max,
         x
     )

 make-hsl(h, s, l) :
     format("hsl(%s,%s%%,%s%%)", h, s, l)

 Color(hue, saturation, luminance) : {
     hue -&gt; self.hue
     saturation -&gt; self.saturation
     luminance -&gt; self.luminance

     make-hsl(hue, saturation, luminance) -&gt; self.hsl-string
 }

 lerp-color(c1, c2, alpha) :
     Color(
         lerp(c1.hue, c2.hue, alpha),
         lerp(c1.saturation, c2.saturation, alpha),
         lerp(c1.luminance, c2.luminance, alpha)
     )


 # Application Logic

 color-empty &lt;- Color(120, 90, 45)
 color-full  &lt;- Color(0, 90, 45)

 scale &lt;- clamp(quantity / maximum, 0, 1)

 color &lt;- lerp-color(color-empty, color-full, scale)


 color.hsl-string -&gt; self.meter.style.backgroundColor

 format("%s%%", scale * 100) -&gt; self.meter.style.width
?&gt;</pre><p>Compared to the previous version, this version has a number of benefits:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
It is clearly visible where the two colors are defined, and thus can
be changed easily.
</li><li class="listitem">
The color components are kept in a single place rather than being
scattered throughout the code.
</li><li class="listitem">
All color components are interpolated.
</li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_error_handling_with_failure_values"></a>6. Error Handling with Failure Values</h2></div></div></div><p>Up till this point we have completely ignored the issue of what
happens if the user provides invalid input. In this tutorial, failure
values and their use in handling errors will be introduced.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_invalid_input"></a>6.1. Invalid Input</h3></div></div></div><p>First let’s investigate more closely what happens when an invalid
value is entered by the user. Let’s try it out with the sum
application we wrote in <a class="xref" href="#_functional_bindings" title="2. Functional Bindings">Section 2, “Functional Bindings”</a>.</p><p>You may have noticed that nothing happens if a number is only entered
in one of the fields:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial6/snap1.png" align="middle" alt="A: 1, B: &lt;blank&gt;, A + B = &lt;blank&gt;" /></div></div><p>Let’s enter an invalid value for <span class="emphasis"><em>B</em></span>, and see what happens:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial6/snap2.png" align="middle" alt="A: 1, B: foo, A + B = &lt;blank&gt;" /></div></div><p>Again nothing. Is there something wrong with application?</p><p>Let’s change <span class="emphasis"><em>B</em></span> to a valid number:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial6/snap3.png" align="middle" alt="A: 1, B: 2, A + B = 3" /></div></div><p>Now we get the result of the addition, <code class="literal">3</code>. The application resumed
its normal operation when valid input is entered.</p><p>What will happen if we change one of the fields to an invalid value,
let’s try changing <span class="emphasis"><em>A</em></span> this time:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial6/snap4.png" align="middle" alt="A: bar, B: 2, A + B = 3" /></div></div><p>No change in the result of <code class="literal">3</code>. It appears the application does not
change the result if invalid input was entered. This demands an
explanation.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_failure_values"></a>6.2. Failure Values</h3></div></div></div><p>What’s really going on under the hood is that when a value, which is
not a valid number, is entered in one of the input fields, the node
bound to that field is set to a <span class="emphasis"><em>failure value</em></span>.</p><p>A failure value is a special type of value which, when evaluated,
terminates the evaluation of the node, by which it was evaluated, and
the node’s value is set to the failure value. Failure values represent
the failure of an operation, the absence of a value or special classes
of values.</p><p>In the sum application, a failure value is returned by the <code class="literal">to-int</code>
meta-node, when the argument is a string which does not contain a
valid integer. Thus <code class="literal">to-int(a)</code> evaluates to a failure value if the
value entered in the input field for <span class="emphasis"><em>A</em></span> does not contain a valid
integer.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Remember that <code class="literal">to-int(a)</code> is bound, as the target, to the value
entered in the text input field.</p></td></tr></table></div><p>The observer of <code class="literal">to-int(a)</code> is <code class="literal">a</code>, and is thus set to the failure
value returned by <code class="literal">to-int</code>. Node <code class="literal">a + b</code> evaluates node <code class="literal">a</code>, thus
evaluating the failure value. This results in the computation of the
sum (<code class="literal">a + b</code>) being terminated and node <code class="literal">a + b</code>, and its observer
<code class="literal">sum</code>, being set to the failure value.</p><p>By default when a node, bound to a user interface element, evaluates
to a failure value, the user interface is not updated. As a result the
application appears to be doing nothing.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_handling_failures"></a>6.3. Handling Failures</h3></div></div></div><p>Whilst the current behaviour of the application is a step up from
crashing or producing garbage results, it does not provide any
indication to the user that the input entered was invalid. This is
confusing to the user as the application appears to not be working
properly. Proper error handling should be in place.</p><p>The <code class="literal">core</code> module provides a handy utility meta-node <code class="literal">fails?</code>, which
returns true if its argument node evaluates to a failure, and false
otherwise. This can be used to detect failures in our application and
display an appropriate error message.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>A related utility meta-node <code class="literal">?</code>, also from the <code class="literal">core</code> module,
returns true if its argument does not evaluate to a failure.</p></td></tr></table></div><p>We need to detect failures in the <code class="literal">a</code> and <code class="literal">b</code> nodes which are bound to
the values of the input fields for <span class="emphasis"><em>A</em></span> and <span class="emphasis"><em>B</em></span>, respectively. This can
be achieved using the expression <code class="literal">fails?(a)</code> for <code class="literal">a</code> and <code class="literal">fails?(b)</code>
for <code class="literal">b</code>.</p><p>We would like to display a message, indicating that the input entered
was invalid, next to the field where invalid input was entered. This
can be achieved using a <code class="literal">case</code> expression. The following is the <code class="literal">case</code>
expression for <code class="literal">a</code>:</p><pre class="screen">case(
    fails?(a) : "Not a valid number!",
    ""
)</pre><p>The <code class="literal">case</code> expression returns the constant string “Not a valid
number!”, if <code class="literal">fails?(a)</code> is true, that is <code class="literal">a</code> evaluates to a failure,
otherwise it returns the empty string. To display the error message
next to the field for <span class="emphasis"><em>A</em></span>, we can simply place the entire <code class="literal">case</code>
expression in an inline node declaration, between <code class="literal">&lt;?@ ... ?&gt;</code>, next to
the field. We can do the same for <span class="emphasis"><em>B</em></span>, substituting <code class="literal">a</code> with <code class="literal">b</code>, to
get an error indication for <span class="emphasis"><em>B</em></span> as well.</p><p>That’s it we have added error handling to an existing application
without having to make fundamental changes to our application
logic. In-fact the addition of error handling was as simple as adding
new UI elements.</p><p>Let’s try it out. Build and run the application and enter an invalid
value in one of the input fields:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial6/snap5.png" align="middle" alt="A: 1, B: foo, Not a valid number!; A + B =" /></div></div><p>The message “Not a valid number!” is displayed next to the field
containing the invalid value, <span class="emphasis"><em>B</em></span> in this case.</p><p>Now correct the invalid value, to a valid number:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial6/snap6.png" align="middle" alt="A: 1, B: 6; A + B = 7" /></div></div><p>The message disappears and the sum is computed.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_cleaning_up"></a>Cleaning Up</h4></div></div></div><p>The error handling logic, added in the previous section, can do with
some cleaning up.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
The error message is duplicated next to both fields. If we’d like to
change the message we’d have to make sure we’ve changed it in both
places.
</li><li class="listitem">
The <code class="literal">case</code> expression is identical for both fields with the only
difference being the node. If we change the error handling logic, to
display a different message, we’d have to edit both the <code class="literal">case</code>
expressions.
</li></ul></div><p>The case expression can be extracted into a
meta-node, let’s call it <code class="literal">error-message</code> which takes the node as input
and returns the appropriate error message.</p><p><strong>Meta-Node <code class="literal">error-message</code>. </strong>
</p><pre class="screen">error-message(value) :
    case(
        fails?(value) : "Not a valid number!",
        ""
    )</pre><p>
</p><p><span class="emphasis"><em>Add this definition to the top of the Tridash code tag.</em></span></p><p>We can now replace the <code class="literal">case</code> expressions, inside the inline node
declarations with the following for field <span class="emphasis"><em>A</em></span>:</p><pre class="screen">error-message(a)</pre><p>and the following for field <span class="emphasis"><em>B</em></span>:</p><pre class="screen">error-message(b)</pre><p>Changes to the error message and error handling logic are now much
easier to implement as only the definition of the <code class="literal">error-message</code>
meta-node needs to be changed.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_initial_values"></a>6.4. Initial Values</h3></div></div></div><p>You may have noticed that the error messages are not displayed
initially, when the input fields are empty. Similarly no visible
result is observed until a value is entered in both fields. You’re
probably wondering why this is so, as an empty string is certainly not
a valid integer. In-fact, if you first enter a valid integer in a
field, and then change its value to empty, the error message will be
displayed.</p><p>The problem is that the nodes <code class="literal">a</code> and <code class="literal">b</code> are not given initial
values. As a result the value of the <code class="literal">error-message(a)</code> node, and the
corresponding node for <code class="literal">b</code>, is not computed until <code class="literal">a</code> is given its
first value. But then what happens when the node <code class="literal">a + b</code> is updated
after a value is entered in the first field, <span class="emphasis"><em>A</em></span>, only? Since only the
dependency <code class="literal">a</code>, of <code class="literal">a + b</code> has been given a value, <code class="literal">a + b</code> does not
have a value for <code class="literal">b</code> and thus the value it uses for <code class="literal">b</code> defaults to a
failure. To solve this problem we can give initial values to <code class="literal">a</code> and
<code class="literal">b</code>.</p><p>An explicit binding in which the <span class="emphasis"><em>source</em></span> is a literal constant and
the <span class="emphasis"><em>target</em></span> is a node is interpreted as giving the node an initial
value, equal to the constant.</p><p>The following assigns an initial value of 1 to <code class="literal">a</code> and 2 to <code class="literal">b</code>:</p><p><strong>Example. </strong>
</p><pre class="screen">1 -&gt; a
2 -&gt; b</pre><p>
</p><p>The setting of the initial values is treated as an ordinary value
change from the default failure value to the given initial value,
which occurs immediately after the application is launched. As a
result, the values of the node’s observers are updated. In this case
the nodes: <code class="literal">a + b</code>, <code class="literal">error-message(a)</code> and <code class="literal">error-message(b)</code> will be
updated.</p><p>In our application, let’s give both <code class="literal">a</code> and <code class="literal">b</code> an initial value of
<code class="literal">0</code>. Add the following to the Tridash code tag at the top of the file:</p><pre class="screen">0 -&gt; a
0 -&gt; b</pre><p>Build and run the application:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial6/snap7.png" align="middle" alt="A: 0, B: 0, A + B: 0" /></div></div><p>Both fields are initialized to <code class="literal">0</code> and the sum of <code class="literal">0</code> is
displayed.</p><p>Experiment with changing the node’s initial values and even try
setting them to invalid integers.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>You may be wondering how it is that giving an initial value to
the nodes <code class="literal">a</code> and <code class="literal">b</code> affects the values of the text input
fields. This is due to the fact that there is a two-way binding
between <code class="literal">a</code> and the value of the input element for <span class="emphasis"><em>A</em></span>, and between
<code class="literal">b</code> and the value of the input element for <span class="emphasis"><em>B</em></span>.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_exercise"></a>6.5. Exercise</h3></div></div></div><p>As an exercise make the color of the border, or alternatively the
background color, of the input element change to red when an invalid
value is entered in it.</p><p>Try to achieve something similar to the following:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial6/snap8.png" align="middle" alt="A: foo, Not a number, B: 0, A + B = 0" /></div></div><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Some CSS styling rules have also been added to change the text
color of the error messages to red, this is not part of the exercise.</p></td></tr></table></div><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>To change the border color of an element bind to the
<code class="literal">style.borderColor</code> attribute of the element node.</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_failure_types"></a>7. Failure Types</h2></div></div></div><p>The error handling tools we’ve seen so far have one serious
shortcoming, there is no means for identifying the cause of the
error. In the application, which we augmented with error handling in
the previous tutorial, we don’t check at all what the cause of the
failure is. Instead, we simply assumed that a failure value means
invalid input was entered. Whilst this is the case in our simple
application, it is not the case for more complex real world
applications where there are many potential sources of errors.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_identifying_the_cause_of_failures"></a>7.1. Identifying the cause of Failures</h3></div></div></div><p>Each failure value has an associated type, which is a value that
identifies the cause of the failure. The <span class="emphasis"><em>failure type</em></span> can be
obtained using the <code class="literal">fail-type</code> meta-node from the <code class="literal">core</code> module. If
the argument of <code class="literal">fail-type</code> evaluates to a failure, the meta-node
returns its type, otherwise if the argument does not evaluate to a
failure or evaluates to a failure without a type, the meta-node
returns a failure.</p><p>The meta-node <code class="literal">fail-type</code> is a bit clunky to use as it, itself,
returns a failure if the argument does not evaluate to a failure
value. The utility <code class="literal">fail-type?</code> meta-node, also from the <code class="literal">core</code>
module, takes two arguments, a value and a failure type, and returns
true if the value evaluates to a failure of that type.</p><p>A value used as a failure type is generally bound to a constant node,
which is used in place of the raw value. An accompanying node, with
the same identifier but with a trailing <code class="literal">!</code> is bound to a failure of
the type.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_example_checking_failure_type_in_emphasis_adding_numbers_emphasis_application"></a>7.2. Example: Checking Failure type in <span class="emphasis"><em>Adding Numbers</em></span> Application</h3></div></div></div><p>The type of the failure returned by <code class="literal">to-int</code>, when given a string that
does not contain a valid integer, is designated by the node
<code class="literal">Invalid-Integer</code>, from the <code class="literal">core</code> module. The node <code class="literal">Invalid-Integer!</code>
is bound to a failure of type <code class="literal">Invalid-Integer</code>.</p><p>We can use the <code class="literal">fail-type?</code> meta-node to explicitly check whether the
failure is of the type <code class="literal">Invalid-Integer</code>. Simply replace
<code class="literal">fails?(value)</code> with <code class="literal">fail-type?(value, Invalid-Integer)</code> in the
definition of the <code class="literal">error-message</code> meta-node.</p><p><strong>Improved <code class="literal">error-message</code> Meta-Node. </strong>
</p><pre class="screen">error-message(value) :
    case(
        fail-type?(value, Invalid-Integer) : "Not a valid number!",
        ""
    )</pre><p>
</p><p>The new implementation returns the string “Not a valid number!” only
for errors caused by invalid input being entered. It returns the empty
string for errors of any other type.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_creating_failure_values"></a>7.3. Creating Failure Values</h3></div></div></div><p>Failures are limited in use if they can only be created by builtin
meta-nodes. You can create your own failure values using the <code class="literal">fail</code>
meta-node, which takes one optional argument — the type of the
failure. If the type argument is not provided, a failure without a
type is created.</p><p><strong>Example. </strong>
</p><pre class="screen"># Creates failure with no type
fail()

# Creates a failure with type `My-Type`
fail(My-Type)</pre><p>
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_example_positive_numbers_only"></a>Example: Positive Numbers Only</h4></div></div></div><p>Suppose for some reason, we’d like to limit the numbers being added,
in the <span class="emphasis"><em>Adding Numbers</em></span> application, to positive numbers. It could
be that the numbers represent amounts for which negative values do not
make sense in the context of the application.</p><p>Let’s write a meta-node, <code class="literal">validate</code>, which takes an integer value and
returns that value if it is greater than or equal to zero. Otherwise
it returns a failure of a user-defined type designated by the node
<code class="literal">Negative-Number</code>.</p><p><strong>Meta-Node <code class="literal">validate</code>. </strong>
</p><pre class="screen">validate(x) :
    case(
        x &gt;= 0 : x,
        fail(Negative-Number)
    )</pre><p>
</p><p>If the argument <code class="literal">x</code> is greater than or equal to zero it is returned
directly, otherwise a failure, created using the <code class="literal">fail</code> meta-node, of
type designated by <code class="literal">Negative-Number</code> is returned.</p><p>Now let’s bind the <code class="literal">Negative-Number</code> node to a value, which uniquely
identifies the failure. For now let’s choose the value <code class="literal">-1</code>. While
we’re at it let’s also define the <code class="literal">Negative-Number!</code> meta-node which
is simply bound to a failure of type <code class="literal">Negative-Number</code>.</p><p><strong>Failure Type `Negative-Number `. </strong>
</p><pre class="screen">Negative-Number  &lt;- -1
Negative-Number! &lt;- fail(Negative-Number)</pre><p>
</p><p>We can simplify <code class="literal">validate</code> by substituting <code class="literal">fail(Negative-Number)</code>
with <code class="literal">Negative-Number!</code>:</p><p><strong>Simplified <code class="literal">validate</code> Meta-Node. </strong>
</p><pre class="screen">validate(x) :
    case(
        x &gt;= 0 : x,
        Negative-Number!
    )</pre><p>
</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>It does not matter whether you place the binding declarations of
the nodes <code class="literal">Negative-Number</code> and <code class="literal">Negative-Number!</code> before or after the
definition of <code class="literal">validate</code>.</p></td></tr></table></div><p>To incorporate this in our application, we have to change the nodes,
to which the input fields are bound, from <code class="literal">a</code> and <code class="literal">b</code> to <code class="literal">input-a</code> and
<code class="literal">input-b</code>.</p><p>Replace <code class="literal">a</code> with <code class="literal">input-a</code>, in the text field for <span class="emphasis"><em>A</em></span>, and <code class="literal">b</code> with
<code class="literal">input-b</code> in the text field for <span class="emphasis"><em>B</em></span>.</p><pre class="screen">...
&lt;label&gt;A: &lt;input value="&lt;?@ to-int(input-a) ?&gt;"/&gt;&lt;/label&gt;
...
&lt;label&gt;B: &lt;input value="&lt;?@ to-int(input-b) ?&gt;"/&gt;&lt;/label&gt;
...</pre><p>Also change the setting of initial values such that they are set on
nodes <code class="literal">input-a</code> and <code class="literal">input-b</code> rather than <code class="literal">a</code> and <code class="literal">b</code>.</p><pre class="screen">0 -&gt; input-a
0 -&gt; input-b</pre><p>Now we’re going to bind <code class="literal">a</code> to the result of <code class="literal">validate</code> applied on
<code class="literal">input-a</code> and we’re going to bind <code class="literal">b</code> to the result of <code class="literal">validate</code>
applied on <code class="literal">input-b</code>.</p><pre class="screen">a &lt;- validate(input-a)
b &lt;- validate(input-b)</pre><p>Finally let’s update the <code class="literal">error-message</code> meta-node to return “Number
must be greater than or equal to 0!” in the case that the failure
is of type <code class="literal">Negative-Number</code>.</p><p><strong>Updated <code class="literal">error-message</code> Meta-Node. </strong>
</p><pre class="screen">error-message(value) :
    case(
        fail-type?(value, Invalid-Integer) :
            "Not a valid number!",
        fail-type?(value, Negative-Number) :
            "Number must be greater than or equal to 0!",
        ""
    )</pre><p>
</p><p>Build and run the application and enter a positive number in one field
and a negative number in the other:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial7/snap1.png" align="middle" alt="A: 1, B: -1, Number must be greater than or equal to 0!, A + B = 1" /></div></div><p>The error message, explaining that a positive number (or zero) must be
entered, is displayed next to the field where the negative number was
entered, <span class="emphasis"><em>B</em></span> in this case. The result of the addition with the new
numbers entered is not displayed, instead the previous result is
retained, as expected.</p><p>Change the negative number to an invalid number:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial7/snap2.png" align="middle" alt="A: 1, B: foo, Not a valid number!, A + B = 1" /></div></div><p>The error message changes to “Not a valid number!” and the displayed
sum is unchanged, as in the previous versions.</p><p>Now change the value to a valid positive number:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial7/snap3.png" align="middle" alt="A: 1, B: 2, A + B = 3" /></div></div><p>The error message disappears and the new sum is displayed.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_proper_failure_types"></a>7.4. Proper Failure Types</h3></div></div></div><p>There is one issue with the application we’ve just developed. There is
no guarantee that the arbitrary constant <code class="literal">-1</code> uniquely represents a
failure of type <code class="literal">Negative-Number</code>. If all failure types used arbitrary
integer constants, there is no guarantee that <code class="literal">-1</code> doesn’t already
represent a builtin failure type, such as <code class="literal">Invalid-Integer</code>. Whilst it
so happened to work, it is certainly not robust, especially when
bringing in third party libraries.</p><p>A value, which is guaranteed to be unique, can be obtained by taking a
reference to the <span class="emphasis"><em>raw node object</em></span> of <code class="literal">Negative-Number</code>.</p><p>A reference to the raw node object, of a node, can be obtained using
the <code class="literal">&amp;</code> special operator, which takes the identifier of the node as an
argument. Raw node references are mostly useful when writing macros,
which you’ll learn about in a later tutorial. For now all that you
need to know is that this value can serve as the failure type,
i.e. can be compared using <code class="literal">=</code>, and is guaranteed to be unique.</p><p>Replace the binding declaration for <code class="literal">Negative-Number</code> with the
following:</p><p><strong>Proper <code class="literal">Negative-Number</code> Failure Type. </strong>
</p><pre class="screen">Negative-Number  &lt;- &amp;(Negative-Number)</pre><p>
</p><p>And now we have a robust way of distinguishing between failures
originating from <code class="literal">to-int</code>, due to the input fields not containing
valid integers, and errors originating from our own application logic.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_target_node_transforms"></a>8. Target Node Transforms</h2></div></div></div><p>Wow, we had to make so many fundamental changes to our code just to
implement a minor change in the input accepted by the application. We
had to:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Add the nodes <code class="literal">input-a</code> and <code class="literal">input-b</code>, for which we had to come up
with meaningful identifiers.
</li><li class="listitem">
Change the input fields to be bound to <code class="literal">input-a</code> and <code class="literal">input-b</code>
rather than <code class="literal">a</code> and <code class="literal">b</code>.
</li><li class="listitem">
Change the initial values to be assigned to <code class="literal">input-a</code> and <code class="literal">input-b</code>
rather than <code class="literal">a</code> and <code class="literal">b</code>.
</li><li class="listitem">
Bind <code class="literal">a</code> to <code class="literal">validate(input-a)</code> and <code class="literal">b</code> to <code class="literal">validate(input-b)</code>.
</li></ol></div><p>This is contrary to “simply adding new UI elements” which was the
case when we introduced error handling. We can do better.</p><p>Notice that a lot of the code we added was simply repetitive binding
boilerplate code, which is the same for both <code class="literal">a</code> and <code class="literal">b</code>. It would be
nice if we could somehow abstract it away and not have to write the
same code for both nodes. Luckily, there is a way.</p><p>Remember, from the second tutorial, that some meta-nodes, such as
<code class="literal">to-int</code>, are special in that a two-way binding is established between
the meta-node instance and the argument node. This allows instances of
the meta-node to also appear as targets of bindings.</p><p><strong>Refresher Example. </strong>
</p><pre class="screen"># The following
a -&gt; to-int(b)

# Is equivalent to
to-int(a) -&gt; b</pre><p>
</p><p>It turns out <code class="literal">to-int</code> is not so special as we can do the same for our
own meta-nodes by setting the <code class="literal">target-node</code> attribute.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_node_attributes"></a>8.1. Node Attributes</h3></div></div></div><p>Node attributes are simply key-value pairs associated with a node,
which control various compilation options. Attributes are set using
the special <code class="literal">/attribute</code> operator:</p><p><strong><code class="literal">/attribute</code> Operator Syntax. </strong>
</p><pre class="screen">/attribute(node, key, value)</pre><p>
</p><p>This sets the attribute of <code class="literal">node</code> with key <code class="literal">key</code> to the value <code class="literal">value</code>.</p><p><strong>Examples. </strong>
</p><pre class="screen"># Set value of attribute `my-attribute` to 1
/attribute(a, my-attribute, 1)

# Set value of attribute `akey` to literal symbol `raw-id`
/attribute(b, "akey", raw-id)</pre><p>
</p><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="literal">key</code> and <code class="literal">value</code> are interpreted as literal symbols rather
than references to the values of nodes. Attribute keys are case
insensitive and there is no difference between raw symbols and string
keys. The following keys <code class="literal">key</code>, <code class="literal">Key</code>, <code class="literal">"key"</code> and <code class="literal">"kEy"</code> all refer
to the same attribute.</p></td></tr></table></div><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Node attributes do not form part of a runtime node’s state.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_attribute_literal_target_node_literal"></a>8.2. Attribute <code class="literal">target-node</code></h3></div></div></div><p>The <code class="literal">target-node</code> attribute determines, when set, the meta-node which
is used as the binding function of the binding in the reverse
direction, from a meta-node instance to the meta-node arguments.</p><p>As an example, a meta-node <code class="literal">f</code> with its <code class="literal">target-node</code> attribute set to
<code class="literal">g</code> results in the following:</p><p><strong>Example. </strong>
</p><pre class="screen">/attribute(f, target-node, g)

# The following
a -&gt; f(b)

# Is equivalent to
g(a) -&gt; b</pre><p>
</p><p>In the example above the <code class="literal">target-node</code> attribute of <code class="literal">f</code> is set to
<code class="literal">g</code>. Thus the declaration <code class="literal">f(b)</code> also results in the binding <code class="literal">g(f(b))
-&gt; b</code> being created.</p><p>The meta-node <code class="literal">to-int</code> simply has its <code class="literal">target-node</code> attribute set to
itself, which is why it performs the same function, when it appears as
the target of a binding, as when it appears as the source of a
binding.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">to-int</code> meta-node performs the same function as the <code class="literal">int</code>
meta-node however the difference is that when an instance of <code class="literal">int</code>
appears as the target of a binding, pattern matching (which will be
introduced in a later tutorial) is performed, whereas <code class="literal">to-int</code> simply
performs the same function. <code class="literal">int</code> has not been mentioned till this
point to avoid creating confusion as to what’s the difference between
it and <code class="literal">to-int</code>.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="target-node-own-meta-nodes"></a>8.3. Target-Node for own Meta-Nodes</h3></div></div></div><p>Our code can be simplified considerably by allowing a meta-node, which
performs the additional input validation, to be bound (as the target)
to the values in the input field. Let’s first write that meta-node,
called <code class="literal">valid-int</code> which is responsible for converting an input string
to an integer and ensuring that the resulting integer is greater than
or equal to zero. In essence this meta-node combines <code class="literal">to-int</code>, we’ll
use <code class="literal">int</code> this time, and <code class="literal">validate</code>.</p><p><strong>Meta-node <code class="literal">valid-int</code>. </strong>
</p><pre class="screen">valid-int(value) : {
    x &lt;- int(value)
    validate(x)
}</pre><p>
</p><p>In order to allow the node to appear as the target of a binding, and
still perform the same function, let’s set its <code class="literal">target-node</code> attribute
to itself:</p><pre class="screen">/attribute(valid-int, target-node, valid-int)</pre><p>Now we can bind the contents of the input fields directly to an
instance of the <code class="literal">valid-int</code> meta-node. In-fact, we can place the
<code class="literal">valid-int</code> instance directly in an inline node declaration.</p><p>Replace <code class="literal">to-int(input-a)</code> with <code class="literal">valid-int(a)</code>, and the same for <code class="literal">b</code>,
in the input fields as follows:</p><pre class="screen">&lt;label&gt;A: &lt;input value="&lt;?@ valid-int(a) ?&gt;"/&gt;&lt;/label&gt;
&lt;label&gt;B: &lt;input value="&lt;?@ valid-int(b) ?&gt;"/&gt;&lt;/label&gt;</pre><p>The nodes <code class="literal">input-a</code> and <code class="literal">input-b</code> can be removed, as well as the
following declarations:</p><pre class="screen"> a &lt;- validate(input-a)
 b &lt;- validate(input-b)</pre><p>The initial values of <code class="literal">0</code> can once again be given to the nodes <code class="literal">a</code> and
<code class="literal">b</code> rather than <code class="literal">input-a</code> and <code class="literal">input-b</code>.</p><pre class="screen"> 0 -&gt; a
 0 -&gt; b</pre><p>The following is the full content of the Tridash code tag.</p><pre class="screen">/import(core)

# Error Reporting

error-message(value) :
    case(
        fail-type?(value, Invalid-Integer) :
            "Not a valid number!",
        fail-type?(value, Negative-Number) :
            "Number must be greater than or equal to 0!",
        ""
    )

# Input Validation

Negative-Number  &lt;- &amp;(Negative-Number)
Negative-Number! &lt;- fail(Negative-Number)

validate(x) :
    case(
        x &gt;= 0 : x,
        Negative-Number!
    )

valid-int(value) : {
    x &lt;- int(value)
    validate(x)
}

/attribute(valid-int, target-node, valid-int)

# Initial Values

0 -&gt; a
0 -&gt; b</pre><p>Compared to the previous version, the only modifications are in the
<code class="literal">error-message</code> meta-node, the inline bindings in the input fields and
the addition of the <code class="literal">validate</code> and <code class="literal">valid-int</code> meta-nodes along with
the <code class="literal">Negative-Number</code> failure type. This version, however, did not
require the addition of new nodes or modifying the bindings comprising
the core application logic. Changing the input validation logic was
simply a matter of substituting <code class="literal">to-int</code> with <code class="literal">valid-int</code> in the
bindings to the input field values.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="contexts"></a>9. Contexts</h2></div></div></div><p>Throughout these tutorials, we’ve glossed over two-way bindings
without going into much detail of how they work, yet they were a vital
component of every application as the bindings to the UI elements have
all been two-way bindings.</p><p>Each node has a number of <span class="emphasis"><em>contexts</em></span> which store information about how
to compute the node’s value, i.e. what function to use and what
dependencies are operands to the function. The <span class="emphasis"><em>active</em></span> context of a
node, at a given moment in time, is the context which is used to
compute the node’s value. In general, a context is <span class="emphasis"><em>activated</em></span> when
the value of an operand node of the context changes. By default, a
node context is created for each dependency of a node which was added
by an explicit binding.</p><p><strong>Example. </strong>
</p><pre class="screen">a -&gt; x # Context created for dependency `a`
b -&gt; x # Context created for dependency `b`
c -&gt; x # Context created for dependency `c`</pre><p>
</p><p>In this example node <code class="literal">x</code> has three contexts one for each of its
dependency nodes, <code class="literal">a</code>, <code class="literal">b</code> and <code class="literal">c</code>, to which it is bound explicitly.</p><p>An implicit binding between a meta-node instance and the meta-node
arguments does not result in the creation of a context for each
operand.</p><pre class="screen">a + b</pre><p>Nodes <code class="literal">a</code> and <code class="literal">b</code> are implicitly added as dependencies of <code class="literal">a + b</code>
however they are added as operands to the same context with the <code class="literal">+</code>
function.</p><p>The following application demonstrates how different contexts are
activated, when the values of their operand nodes change.</p><p><strong><code class="literal">ui.html</code>. </strong>
</p><pre class="programlisting">&lt;?
 x -&gt; node
 y -&gt; node
 z -&gt; node
?&gt;
&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Node Contexts&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;div&gt;&lt;label&gt;X: &lt;input value="&lt;?@ x ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;div&gt;&lt;label&gt;Y: &lt;input id="b" value="&lt;?@ y ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;div&gt;&lt;label&gt;Z: &lt;input value="&lt;?@ z ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;hr/&gt;
      &lt;div&gt;&lt;strong&gt;Last value entered: &lt;?@ node ?&gt;&lt;/strong&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><p>This is a simple application consisting of three text input fields
bound to nodes <code class="literal">x</code>, <code class="literal">y</code> and <code class="literal">z</code>. Nodes <code class="literal">x</code>, <code class="literal">y</code> and <code class="literal">z</code> are each
explicitly bound to <code class="literal">node</code>, the value of which is displayed below the
fields.</p><p>Let’s enter a value in each field and see what happens. Observe the
value displayed below the fields after each change:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial9/snap1.png" align="middle" alt="X: 1, Y: _, Z: _, Last value entered: 1" /></div></div><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial9/snap2.png" align="middle" alt="X: 1, Y: 2, Z: _, Last value entered: 2" /></div></div><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial9/snap3.png" align="middle" alt="X: 1, Y: 2, Z: 3, Last value entered: 3" /></div></div><p>Notice that after each change, the value that was just entered is
displayed.</p><p>Now let’s try changing the values of the fields which were edited
previously:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial9/snap4.png" align="middle" alt="X: 1, Y: 10, Z: 3, Last value entered: 10" /></div></div><p>In this case the value of the second field, <span class="emphasis"><em>Y</em></span>, was changed to 10 and
that value was immediately displayed below the fields.</p><p>The value of the field that was changed last is displayed. To
understand why this is so, let’s examine the sequence of steps taken
when a value is entered in the <span class="emphasis"><em>X</em></span> field.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
The value of <code class="literal">x</code>, which is bound to the value in the <span class="emphasis"><em>X</em></span> field, is
updated.
</li><li class="listitem">
The context corresponding to the binding <code class="literal">x -&gt; node</code> is activated
due to the value of <code class="literal">x</code> being updated.
</li><li class="listitem">
The value of <code class="literal">node</code> is updated to the value of <code class="literal">x</code>.
</li></ol></div><p>Contexts make two-way bindings possible:</p><p><strong>Example. </strong>
</p><pre class="screen">input1 -&gt; a

# Two-way binding
a -&gt; b; a -&gt; b

input2 -&gt; b</pre><p>
</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">;</code> character separates multiple declarations written on a
single line.</p></td></tr></table></div><p><code class="literal">a</code> has two contexts corresponding to dependency nodes <code class="literal">input1</code> and
<code class="literal">b</code> (which is also an observer). <code class="literal">b</code> has two contexts corresponding to
dependency nodes <code class="literal">input2</code> and <code class="literal">a</code>.</p><p>When <code class="literal">input1</code> is changed, the contexts corresponding to the bindings
in the following direction are activated:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">input1 -&gt; a</code>
</li><li class="listitem">
<code class="literal">a -&gt; b</code>
</li></ul></div><p>When <code class="literal">input2</code> is changed, the contexts corresponding to the bindings
in the following direction are activated:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">input2 -&gt; b</code>
</li><li class="listitem">
<code class="literal">b -&gt; a</code>
</li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_explicit_contexts"></a>9.1. Explicit Contexts</h3></div></div></div><p>The context of a binding can be set explicitly to a named context,
using the <code class="literal">@</code> operator from the <code class="literal">core</code> module.</p><pre class="screen">a -&gt; b @ context-id</pre><p>The binding <code class="literal">a -&gt; b</code> is established in the context, of <code class="literal">b</code>, with
identifier <code class="literal">context-id</code>.</p><p>When multiple bindings are established to the same explicit context,
the observer node takes on the value of the first operand which does
not evaluate to a failure. The operands are ordered by the order in
which the explicit bindings are declared in the source file. If all
the operands evaluate to failures, the node evaluates to the failure
value of the last operand.</p><p>This is better explained with an example application:</p><p><strong><code class="literal">ui.html</code>. </strong>
</p><pre class="programlisting">&lt;?
 /import(core)

 x -&gt; node @ context
 y -&gt; node @ context
 z -&gt; node @ context
?&gt;
&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Explicit Contexts&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;div&gt;&lt;label&gt;X: &lt;input value="&lt;?@ to-int(x) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;div&gt;&lt;label&gt;Y: &lt;input value="&lt;?@ to-int(y) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;div&gt;&lt;label&gt;Z: &lt;input value="&lt;?@ to-int(z) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
      &lt;hr/&gt;
      &lt;div&gt;&lt;strong&gt;Value: &lt;?@ node ?&gt;&lt;/strong&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><p>This application is similar to the previous application except the
bindings from nodes <code class="literal">x</code>, <code class="literal">y</code> and <code class="literal">z</code>, to <code class="literal">node</code> are established in an
explicit context with identifier <code class="literal">context</code>. Additionally the input
fields are bound to <code class="literal">to-int</code> instances, of <code class="literal">x</code>, <code class="literal">y</code> and <code class="literal">z</code> which
results in <code class="literal">x</code>, <code class="literal">y</code> and <code class="literal">z</code> being bound to the values entered in the
fields converted to integers. If a non-integer value is entered in a
field, the corresponding node is bound to a failure value.</p><p>Let’s try it out. Enter some integer values in each of the fields:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial9/snap5.png" align="middle" alt="X: 1, Y: 2, Z: 3, Value: 1" /></div></div><p>The value entered in the first field, <span class="emphasis"><em>X</em></span>, was displayed. Since a
valid integer was entered, node <code class="literal">x</code> evaluates to the integer value
1. The binding <code class="literal">x -&gt; node</code> was established first, as the declaration
occurs first in the source file, and since <code class="literal">x</code> does not evaluate to a
failure, <code class="literal">node</code> takes on the value of <code class="literal">x</code>. The values of <code class="literal">y</code> and <code class="literal">z</code>
are ignored.</p><p>Now let’s change <code class="literal">x</code> to a non-integer value:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial9/snap6.png" align="middle" alt="X: foo, Y: 2, Z: 3, Value: 2" /></div></div><p>The value entered in the second field, 2, is displayed. Since a
non-integer value was entered in the first field, <code class="literal">x</code> evaluates to a
failure. <code class="literal">node</code> thus takes on the value of the next dependency, bound
to the explicit context, which does not evaluate to a failure. The
dependency is <code class="literal">y</code> which evaluates to the integer entered in the second
field, 2.</p><p>Let’s see what happens if we enter a non-integer value in the third
field:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial9/snap7.png" align="middle" alt="X: foo, Y: 2, Z: bar, Value: 2" /></div></div><p>The displayed value is unchanged since the second dependency, node
<code class="literal">y</code>, already evaluates to a value which is not a failure value. The
value of the third dependency <code class="literal">z</code>, corresponding to the value entered
in the third field, is ignored, regardless of whether it evaluates to
a failure or not.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_handling_failures_with_explicit_contexts"></a>9.2. Handling Failures with Explicit Contexts</h3></div></div></div><p>Explicit contexts are a useful tool for handling failures. In the
previous application a failure originating from the first input field,
was handled by taking the value of the node bound to the second
field. Similarly a failure originating from the second input field is
handled by taking the value entered in the third field.</p><p>The <code class="literal">@</code> operator also allows a binding to be activated only if the
result of the previous binding(s), in the same context, is a failure
value with a given type. When the context identifier is of the form
<code class="literal">when(context, type)</code> the binding is only activated if the result of
the previous binding(s) is a failure of type <code class="literal">type</code>.</p><p><strong>Example. </strong>
</p><pre class="screen">x -&gt; node @ context
y -&gt; node @ when(context, Invalid-Integer)
z -&gt; node @ when(context, Negative-Number)</pre><p>
</p><p>Three bindings to <code class="literal">node</code> are established in the explicit context
<code class="literal">context</code>.</p><p><code class="literal">node</code> is primarily bound to the value of <code class="literal">x</code> if it does not evaluate
to a failure. If <code class="literal">x</code> evaluates to a failure of type <code class="literal">Invalid-Integer</code>,
<code class="literal">node</code> is bound to the value of <code class="literal">y</code>. If <code class="literal">x</code>, or <code class="literal">y</code> evaluate to a
failure of type <code class="literal">Negative-Number</code>, then <code class="literal">node</code> is bound to the value
of <code class="literal">z</code>.</p><p>To try this out replace the binding declarations, in the application
from the previous section, with the declarations in the example
above. Also copy over the definition of the meta-nodes <code class="literal">valid-int</code>,
<code class="literal">validate</code> and the <code class="literal">Negative-Number</code> failure type from
<a class="xref" href="#target-node-own-meta-nodes" title="8.3. Target-Node for own Meta-Nodes">Section 8.3, “Target-Node for own Meta-Nodes”</a>, into the Tridash code tag. Replace
<code class="literal">to-int</code> with <code class="literal">valid-int</code> in the inline node declarations within the
input field values.</p><p>Enter a non-integer value in the first field, and an integer value in
the second and third fields:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial9/snap8.png" align="middle" alt="X: foo, Y: 1, Z: 2, Value: 1" /></div></div><p>The value of the second field is displayed, since <code class="literal">node</code> is bound to
it when the value in the first field is not an integer.</p><p>Now change the value of the second field to a negative integer, or
alternatively enter a negative integer value in the first field:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial9/snap9.png" align="middle" alt="X: foo, Y: -1, Z: 2, Value: 2" /></div></div><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial9/snap10.png" align="middle" alt="X: -1, Y: 1, Z: 2, Value: 2" /></div></div><p>The value of the third field is displayed in both cases, even when the
value of the second field is a valid positive integer. This is due to
<code class="literal">node</code> being bound to the value of the third field when either the
value of the first field or second field is a negative number.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="literal">when</code> is registered as an infix operator thus the following:</p><pre class="screen">a -&gt; b @ when(context, type)</pre><p>can be rewritten as:</p><pre class="screen">a -&gt; b @ context when type</pre></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="adding-numbers-improved-error-handling"></a>9.3. Improved Error Handling in <span class="emphasis"><em>Adding Numbers</em></span></h3></div></div></div><p>Whilst the error handling logic in the <span class="emphasis"><em>Adding Numbers</em></span> application,
from <a class="xref" href="#_target_node_transforms" title="8. Target Node Transforms">Section 8, “Target Node Transforms”</a>, is adequate and correct, the
definition of the <code class="literal">error-message</code> meta-node, responsible for selecting
an appropriate error message, can be improved using explicit
contexts. The current definition repeatedly checks whether the failure
type of the <code class="literal">value</code> argument is of a given type using the <code class="literal">fail-type?</code>
meta-node. This is repetitive and does not convey the intent that this
is error handling/reporting logic.</p><p>The <code class="literal">error-message</code> meta-node returns:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
The empty string if the <code class="literal">value</code> argument does not evaluate to a
  failure.
</li><li class="listitem">
The string “Not a valid number!” when <code class="literal">value</code> evaluates to a
  failure of type <code class="literal">Invalid-Integer</code>.
</li><li class="listitem">
The string “Number must be greater than or equal to 0!” when
  <code class="literal">value</code> evaluates to a failure of type <code class="literal">Negative-Number</code>.
</li></ul></div><p>We can re-implement this logic using bindings to the <code class="literal">self</code> node with
explicit contexts.</p><p>The <code class="literal">self</code> node should primarily be bound to the empty string, if the
<code class="literal">value</code> argument does not evaluate to a failure. There is a handy
utility meta-node, <code class="literal">!-</code>, in the <code class="literal">core</code> module, which returns the value
of its second argument if the first argument does not evaluate to a
failure. If the first argument evaluates to a failure value, it is
returned. This meta-node is registered as an infix operator thus can
be placed between its arguments.</p><p>The primary binding can thus be written as follows:</p><pre class="screen">value !- "" -&gt;
    self @ context</pre><p>If this binding results in a failure of type <code class="literal">Invalid-Integer</code>, <code class="literal">self</code>
should be bound to the constant string “Not a valid number!”. This
is achieved with the following:</p><pre class="screen">"Not a valid number!" -&gt;
    self @ context when Invalid-Integer</pre><p>Finally <code class="literal">self</code> should be bound to “Number must be greater than or
equal to 0!”, if the previous bindings resulted in a failure of type
<code class="literal">Negative-Number</code>.</p><pre class="screen">"Number must be greater than or equal to 0!" -&gt;
    self @ context when Negative-Number</pre><p>Putting it all together we have the following definition of
<code class="literal">error-message</code> re-implemented using explicit contexts:</p><p><strong>New implementation of <code class="literal">error-message</code>. </strong>
</p><pre class="screen">error-message(value) : {
    value !- "" -&gt;
        self @ context

    "Not a valid number!" -&gt;
        self @ context when Invalid-Integer

    "Number must be greater than or equal to 0!" -&gt;
        self @ context when Negative-Number
}</pre><p>
</p><p>The advantage of this implementation is that it more explicitly
conveys the intent that this is error handling logic. As such it can
be optimized more effectively, e.g. if <code class="literal">self</code> evaluates to a failure
of type <code class="literal">Negative-Number</code>, the check for whether the failure type is
<code class="literal">Invalid-Integer</code> can be skipped altogether.</p><p>An additional advantage of this implementation is that the third
binding is activated on failures of type <code class="literal">Negative-Number</code> originating
both from the first and second bindings whereas the previous
implementation only handled failures originating in <code class="literal">value</code>. In this
case it doesn’t make a difference as the second binding cannot result
in a failure of type <code class="literal">Negative-Number</code>. However this does make a
difference, in more complex error handling logic, where the handling
of an error may itself result in a new error.</p><p>This implementation does, however, have a difference from the previous
implementation in that if <code class="literal">value</code> evaluates to a failure of a type
other than <code class="literal">Invalid-Integer</code> or <code class="literal">Negative-Number</code> it returns a
failure, whereas the previous implementation returned the empty
string. In this application it doesn’t make a difference as the
arguments passed to <code class="literal">error-message</code> do not evaluate to failures of
other types.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_concise_syntax"></a>9.4. Concise Syntax</h3></div></div></div><p>Coming up with a context identifier and typing it out repeatedly can
become tiresome. The original reason for having an identifier for
explicit contexts is to distinguish them from the remaining contexts
which are implicitly created and to allow for multiple explicit
contexts. However, there is usually only a single explicit context
used for handling failures.</p><p>To shorten the syntax for binding to an explicit context, a default
identifier, such as <code class="literal">_</code> can be given to all explicit contexts which
are used only for handling failures. Alternatively, the <code class="literal">@</code> operator
can take a single argument, the node, in which case it is a shorthand
for the explicit context with identifier <code class="literal">default</code>.</p><pre class="screen"># The following:
x -&gt; y @ default

# Is equivalent to:
x -&gt; @(y)</pre><p>When the context identifier is of the form <code class="literal">when(type)</code>, that is
omitting the context identifier and leaving only the failure type, the
explicit context with identifier <code class="literal">default</code> is, once again, assumed.</p><pre class="screen"># The following:
x -&gt; y @ default when type

# Is equivalent to:
x -&gt; y @ when(type)</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_node_states"></a>10. Node States</h2></div></div></div><p>So far, we’ve seen that Tridash is good at producing an output, which
is a function of a given input, and ensuring that it is always
synchronized with the input. What we haven’t seen, however, is mapping
a previous output to a new output. In-fact, with the tools introduced
so far, this is impossible.</p><p>To be able to map a previous output to a new output, a binding has to
be established in which the <span class="emphasis"><em>source</em></span> is a function of the <span class="emphasis"><em>target</em></span>
node. As an example, to implement a counter, intuitively we might do
the following:</p><pre class="screen"># This does not work!!!
counter + 1 -&gt; counter</pre><p>The problem here is that a change in the value of <code class="literal">counter</code> triggers a
change in the value of <code class="literal">counter</code>, which triggers a further change in
the value of <code class="literal">counter</code> <span class="emphasis"><em>ad infinitum</em></span>. What we require is a way to
tell Tridash, that when the value of <code class="literal">counter</code> is updated to <code class="literal">counter
+ 1</code>, it should not trigger another update to the value of <code class="literal">counter +
1</code>. We also need a way to specify when we would like the value of
<code class="literal">counter</code> to be updated to <code class="literal">counter + 1</code>, as updating it only once is
hardly useful.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_stateful_bindings"></a>10.1. Stateful Bindings</h3></div></div></div><p>Node states allow us to control when the value of a node is updated,
beyond the simple rule of <span class="emphasis"><em>whenever the value of one of its dependency
nodes changes</em></span>. The target of a binding can have an explicit <span class="emphasis"><em>state</em></span>
associated with it, using the <code class="literal">::</code> operator. In this case the binding
is referred to as a <span class="emphasis"><em>stateful binding</em></span>.</p><p><strong>Explicit state using <code class="literal">::</code> operator. </strong>
</p><pre class="screen">a -&gt; b :: state-id</pre><p>
</p><p>The left-hand side of the <code class="literal">::</code> operator is the node and the right hand
side is the state identifier, which is a symbol identifier (similar to
a context identifier). The result of this is that the binding <code class="literal">a -&gt; b</code>
only takes effect when <code class="literal">b</code> <span class="strong"><strong><span class="emphasis"><em>switches</em></span></strong></span> to the state with identifier
<code class="literal">state-id</code>. The emphasis is on <span class="emphasis"><em>switches</em></span> as a change in the value of
<code class="literal">a</code> will not automatically trigger a change in the value of <code class="literal">b</code>. Only
a change in the <span class="emphasis"><em>state</em></span> of <code class="literal">b</code> will trigger a change in its
value. This may seem counter-intuitive at first, however if <code class="literal">b</code> was
updated on every change in the value of <code class="literal">a</code>, and instead of <code class="literal">a</code> we
have <code class="literal">b + 1</code> we’ll end up with the same problem, as in the previous
section.</p><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Stateful bindings declared later in the source take
priority over those declared earlier.</p></td></tr></table></div><p>A node’s state is determined by the value of the special node
<code class="literal">/state(node)</code>. Binding to it allows us to control a node’s state.</p><p><strong>Example: Counter. </strong>
</p><pre class="screen">counter + 1 -&gt; counter :: increment

/state(counter) &lt;-
    case(
        should-increment? : '(increment),
        '(default)
    )</pre><p>
</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">'</code> operator returns its argument as a literal symbol.
<code class="literal">'(id)</code> returns the literal symbol <code class="literal">id</code>, whereas <code class="literal">id</code> on its own is a
reference to the value of the node with identifier
<code class="literal">id</code>. <a href="#ftn.idm315188384416" class="footnote" id="idm315188384416"><sup class="footnote">[1]</sup></a></p></td></tr></table></div><p>In this example, a binding <code class="literal">counter + 1 -&gt; counter</code> is established
which only takes effect when <code class="literal">counter</code> switches to the <code class="literal">increment</code>
state.</p><p>The second declaration binds a <code class="literal">case</code> expression to the
<code class="literal">/state(counter)</code> node, thus controlling the state of <code class="literal">counter</code>. When
<code class="literal">should-increment?</code> is true the value of the <code class="literal">case</code> expression, and
thus the state of <code class="literal">counter</code> is <code class="literal">increment</code>, otherwise it is <code class="literal">default</code>.</p><p>The result is that when the value of <code class="literal">/state(counter)</code> (the state of
<code class="literal">counter</code>) is updated to <code class="literal">increment</code>, the value of <code class="literal">counter</code> is
updated to it’s previous value incremented by 1.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_interfacing_with_javascript"></a>10.2. Interfacing with JavaScript</h3></div></div></div><p>To provide a runnable example, we have to interface with JavaScript in
order to hook into its event system. In the next major release of
Tridash, this wont be necessary.</p><p>This section will go over only the basics of interfacing with
JavaScript, which are necessary for completing this tutorial. A full
in-depth tutorial on interfacing with JavaScript, will follow.</p><p>Tridash nodes are compiled to runtime node objects, which store the
node’s value. To be able to reference a runtime node object from
JavaScript, the node has to be given an identifier with which it can
be referenced. The <code class="literal">public-name</code> attribute, if given, determines the
name of this identifier.</p><p>Once an identifier is given, it can be accessed as a member of the
<code class="literal">nodes</code> property of the runtime module object. To access the runtime
module object of a compiled Tridash program, embedded in an HTML file,
it needs to be given an identifier. The module is then accessible via
a global variable with that identifier. This is achieved using the
<code class="literal">module-name</code> output options.</p><div class="caution" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="images/icons/caution.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Currently Tridash does not check whether multiple nodes are
given the same <code class="literal">public-name</code>.</p></td></tr></table></div><p><strong>Example: Setting <code class="literal">public-name</code> identifier. </strong>
</p><pre class="screen">/attribute(node, public-name, "aNode")</pre><p>
</p><p><strong>Example: Referencing the runtime node object in JavaScript. </strong>
</p><pre class="screen">// Assuming runtime module is stored in variable mod
var node = mod.nodes["aNode"];

// or equivalently if the public-name is a valid JS variable name
var node = mod.nodes.aNode;</pre><p>
</p><p>Once a reference is obtained to the runtime node object, the node’s
value can be set using the <code class="literal">set_value</code> method, which takes the value
as an argument.</p><p><strong>Example: Setting Node Value from JavaScript. </strong>
</p><pre class="screen">node.set_value(1);</pre><p>
</p><p>It is important, however, that if <code class="literal">set_value</code> will be called on a
runtime node object, the node is marked as an <span class="emphasis"><em>input</em></span> node, by setting
its <code class="literal">input</code> attribute to true.</p><pre class="screen">/attribute(node, input, True)</pre><div class="caution" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="images/icons/caution.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Not every Tridash node corresponds to an actual runtime node
object, due to some intermediate nodes being optimized out by the
compiler. The only nodes, for which it is guaranteed that a runtime
node object is created, are <span class="emphasis"><em>input</em></span> nodes and nodes with no observers,
which are assumed to represent <span class="emphasis"><em>output</em></span> nodes.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="example-counter-app"></a>10.3. Example: Counter Application</h3></div></div></div><p>In this section we’ll build a very simple application consisting of a
counter which is incremented when a button is pressed.</p><p>Let’s start off with the Tridash binding declarations. We’ve in-fact
already written the bulk of the code in the previous example, which we
can simply copy into our new application.</p><pre class="screen">counter + 1 -&gt; counter :: increment

/state(counter) &lt;-
    case(
        should-increment? : '(increment),
        '(default)
    )</pre><p>The node <code class="literal">counter</code> stores the value of the counter which is
incremented when <code class="literal">should-increment?</code> is true. We’ll add the attributes
which are necessary in order to be able to set the value of
<code class="literal">should-increment?</code> from JavaScript, namely we need to set the
<code class="literal">public-name</code> identifier and mark it as an <code class="literal">input</code> node.</p><pre class="screen">/attribute(should-increment?, input, True)
/attribute(should-increment?, public-name, "should_increment")</pre><p>We’ll allow the user to set/reset the value of the counter by binding
a <code class="literal">start</code> node to an input field. We’ll bind <code class="literal">start</code> directly to
<code class="literal">counter</code> and give it an initial value of <code class="literal">0</code>.</p><pre class="screen">start -&gt; counter
0 -&gt; start</pre><p>Now let’s define the user interface. We need a text input field for
entering the initial value for the counter, which will be bound to
<code class="literal">start</code> and an <span class="emphasis"><em>increment</em></span> button. The value of the counter will be
displayed below the counter.</p><p><strong><code class="literal">ui.html</code>. </strong>
</p><pre class="screen">...
&lt;div&gt;&lt;label&gt;Start: &lt;input value="&lt;?@ to-int(start) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
&lt;div&gt;&lt;button id="increment"&gt;Increment&lt;/button&gt;&lt;/div&gt;
&lt;hr/&gt;
&lt;div&gt;&lt;strong&gt;Counter: &lt;?@ counter ?&gt;&lt;/strong&gt;&lt;/div&gt;
...</pre><p>
</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The HTML boilerplate is not shown.</p></td></tr></table></div><p>We’ve given the <span class="emphasis"><em>Increment</em></span> button the ID <code class="literal">increment</code> so that we can
attach an event listener to its <span class="emphasis"><em>click</em></span> event. We’ll do so using the
following JavaScript code, in a script tag which should be added below
the element where the counter is displayed:</p><pre class="screen">&lt;script&gt;
  document.addEventListener("DOMContentLoaded", async () =&gt; {
      const module = await mod;

      const increment = document.getElementById('increment');
      const node_increment = module.nodes.should_increment;

      increment.addEventListener('click', function() {
          node_increment.set_value(true);
          node_increment.set_value(false);
      });
  });
&lt;/script&gt;</pre><p>A couple of things to note:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
We’ve assumed the runtime module object is stored in the global
  variable <code class="literal">mod</code>. The runtime module object identifier will be set
  with the <code class="literal">module-name</code> output option.
</li><li class="listitem">
The entire code is wrapped in an event handler for the
  <code class="literal">DOMContentLoaded</code> event to ensure that it is run after the
  JavaScript code which assigns the runtime module object to <code class="literal">mod</code>.
</li><li class="listitem">
<code class="literal">await</code> is applied on the module object <code class="literal">mod</code>, inside an <code class="literal">async</code>
  callback function, since the module itself may be created
  asynchronously. This is the case when the compilation target is
  WebAssembly (<code class="literal">wasm32</code>).
</li></ul></div><p>The callback function, run after all HTML elements and scripts have
been loaded, does the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Obtains a reference to the HTML element with ID <code class="literal">increment</code>.
</li><li class="listitem">
Obtains a reference to the <code class="literal">should-increment?</code> node which was given
a <code class="literal">public-name</code> of <code class="literal">should_increment</code>.
</li></ul></div><p>The remainder of the function attaches a listener, for the <span class="emphasis"><em>click</em></span> event,
on the <span class="emphasis"><em>Increment</em></span> button. In that listener we first set the value of
the <code class="literal">should-increment?</code> node to true, then immediately afterwards we
set it to false again.</p><p>Setting the value of <code class="literal">should-increment?</code> to true, causes the state of
<code class="literal">counter</code> to change to <code class="literal">increment</code>. Setting it back to false again
causes the state to change to <code class="literal">default</code>.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>In a future release, when the HTML library is complete, a
subnode <code class="literal">clicked?</code>, of the element node, will be available which will
automatically be set to true when the button is clicked and to false
when it is released. Thus the above JavaScript code wont be necessary.</p></td></tr></table></div><p>Change the build configuration file (<code class="literal">build.yml</code>) to the following:</p><p><strong><code class="literal">build.yml</code>. </strong>
</p><pre class="screen">sources:
  - path: ui.html
    node-name: ui

output:
  path: app.html
  type: html
  main-ui: ui
  module-name: mod</pre><p>
</p><p>The addition of the line <code class="literal">module-name: mod</code> sets the <code class="literal">module-name</code>
output option to <code class="literal">mod</code>, which is the identifier of the variable in
which the runtime module object will be stored.</p><p>Build and run the application, and press the increment button a few
times:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial10/snap1.png" align="middle" alt="Start: 0, Counter: 1" /></div></div><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial10/snap2.png" align="middle" alt="Start: 0, Counter: 2" /></div></div><p>The displayed value, for the counter, is incremented after each press.</p><p>Now enter a value in the <span class="emphasis"><em>Start</em></span> field to reset the counter, and then
press the increment button again:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial10/snap3.png" align="middle" alt="Start: 5, Counter: 5" /></div></div><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial10/snap4.png" align="middle" alt="Start: 5, Counter: 6" /></div></div><p>The counter is reset to the value entered in the <span class="emphasis"><em>Start</em></span>
field. Pressing increment afterwards increments the new counter value.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_state_transitions"></a>10.4. State Transitions</h3></div></div></div><p>Let’s do a little experiment, comment out the line, in the <span class="emphasis"><em>click</em></span>
event handler, which sets the value of the <span class="emphasis"><em>should-increment?</em></span> node to
<span class="emphasis"><em>false</em></span>, i.e. comment out the following:</p><pre class="screen">node_increment.set_value(false);</pre><p>What do you expect to happen? Initially, we might think that since the
<code class="literal">should-increment?</code> node is not being reset to false, the state of
<code class="literal">counter</code> is not being reset to <code class="literal">default</code>. The state of <code class="literal">counter</code> will
thus switch to <code class="literal">increment</code> once, after which, there are no further
state changes. The result is that the counter will only be incremented
the first time the increment button is pressed.</p><p>Let’s try it. Build and run the application and press the increment
button twice.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial10/snap5.png" align="middle" alt="Start: 0, Counter: 2" /></div></div><p>What happened? The counter carries on incrementing after the first
button press. Why?</p><p>The declaration:</p><pre class="screen">counter + 1 -&gt; counter :: increment</pre><p>states that the binding should only take effect when the state of
<code class="literal">counter</code> switches to the <code class="literal">increment</code> state. Switching from the
<code class="literal">increment</code> state to the <code class="literal">increment</code> state is still considered as
switching to the <code class="literal">increment</code> state, even though the new state is
identical to the previous state. This is due to the fact that each
time we’re setting the value of the <code class="literal">should-increment?</code> node to
<code class="literal">true</code>, we’re triggering a change in the value of the node
<code class="literal">/state(counter)</code> and thus the state of <code class="literal">counter</code>, even though the new
value of <code class="literal">should-increment?</code> is identical to its previous value.</p><p>The above declaration should thus be thought of as declaring a binding
which takes effect whenever <code class="literal">counter</code> switches from any state,
including <code class="literal">increment</code>, to the <code class="literal">increment</code> state.</p><p>To fix this issue we can specify an explicit <span class="emphasis"><em>from</em></span> state. When
specified, the binding only takes effect when the state of the node
changes from the <span class="emphasis"><em>from</em></span> state to the <span class="emphasis"><em>to</em></span> state. This is specified
using the following syntax:</p><p><strong>Node State Binding with Explicit From State. </strong>
</p><pre class="screen">a -&gt; b :: previous =&gt; next</pre><p>
</p><p>When the state identifier is a functor of the form <code class="literal">previous =&gt; next</code>,
<code class="literal">previous</code> is interpreted as the identifier of the <span class="emphasis"><em>from</em></span> state and
<span class="emphasis"><em>next</em></span> is interpreted as the identifier of the <span class="emphasis"><em>to</em></span> state.</p><p>To achieve the intuitive behaviour we can limit the binding <code class="literal">counter +
1 -&gt; counter</code> to only take effect when the state of counter
transitions from <code class="literal">default</code> to <code class="literal">increment</code>. Replace the binding
declaration of <code class="literal">counter</code> with the following:</p><pre class="screen">counter + 1 -&gt; counter :: default =&gt; increment</pre><p>This implementation will, however, require two initial button presses
before the counter starts incrementing. This is due to the fact that
we haven’t given <code class="literal">counter</code> an initial state. The first press causes it
to change to <code class="literal">increment</code>, and then back to default, however since it
is not a change from <code class="literal">default</code> to <code class="literal">increment</code>, the binding does not
take effect. We can fix this by giving <code class="literal">/state(counter)</code> an initial
value of <code class="literal">default</code>.</p><p><strong>Setting Initial State. </strong>
</p><pre class="screen">'(default) -&gt; /state(counter)</pre><p>
</p><p>Now the counter starts incrementing after the first press.</p><p>Let’s repeat the experiment on this new implementation, comment out
the line, in the JavaScript script tag, which sets the value of
<code class="literal">should-increment?</code> to <code class="literal">false</code>. The counter should only increment the
first time the <span class="emphasis"><em>Increment</em></span> button is pressed.</p><p>This example served to demonstrate the difference between a stateful
binding with and without a <span class="emphasis"><em>from</em></span> state. However, in this example,
there is no value in specifying a from state, as the previous example,
without a from state, was simpler and performed the same function.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_example_alternating_increment_button"></a>10.5. Example: Alternating Increment Button</h3></div></div></div><p>In this example, we’ll build a silly application in which the
<span class="emphasis"><em>Increment</em></span> button, the button which actually increments the counter,
alternates between two buttons. The goal of this example is to
demonstrate what can be done with stateful bindings with a <span class="emphasis"><em>from</em></span>
state that cannot be done with stateful bindings without a <span class="emphasis"><em>from</em></span>
state.</p><p>We’ll start off with a similar interface to the previous counter
application, however with two increment buttons.</p><p><strong><code class="literal">ui.html</code>. </strong>
</p><pre class="programlisting">&lt;h1&gt;Counter&lt;/h1&gt;
&lt;div&gt;&lt;label&gt;Start: &lt;input value="&lt;?@ to-int(start) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
&lt;div&gt;
  &lt;button id="increment1"&gt;Increment 1&lt;/button&gt;
  &lt;button id="increment2"&gt;Increment 2&lt;/button&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;div&gt;&lt;strong&gt;Counter: &lt;?@ counter ?&gt;&lt;/strong&gt;&lt;/div&gt;</pre><p>
</p><p>Both button’s have been given ID’s as we’ll need to attach event
listeners to both buttons, in JavaScript.</p><p>We’ll need two nodes <code class="literal">clicked1?</code> and <code class="literal">clicked2?</code> which change to true
when the first and second buttons are clicked, respectively. The
values of these nodes will have to be set via JavaScript, thus we’ll
mark them as input nodes and set their <code class="literal">public-name</code> attributes:</p><pre class="screen">/attribute(clicked1?, input, True)
/attribute(clicked1?, public-name, "clicked1");

/attribute(clicked2?, input, True)
/attribute(clicked2?, public-name, "clicked2");</pre><p>The following JavaScript code attaches event listeners for the
<span class="emphasis"><em>clicked</em></span> events, of both buttons, which simply set the value of the
corresponding <span class="emphasis"><em>clicked?</em></span> node to true and them immediately to false,
again.</p><pre class="screen">document.addEventListener("DOMContentLoaded", async () =&gt; {
    const module = await mod;

    const increment1 = document.getElementById('increment1');
    const increment2 = document.getElementById('increment2');

    const clicked1 = module.nodes.clicked1;
    const clicked2 = module.nodes.clicked2;

    increment1.addEventListener('click', function() {
        clicked1.set_value(true);
        clicked1.set_value(false);
    });

    increment2.addEventListener('click', function() {
        clicked2.set_value(true);
        clicked2.set_value(false);
    });
});</pre><p>We’ll need two states for the <code class="literal">counter</code> node:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">increment1</code>
</span></dt><dd>
Corresponds to the first button being clicked last.
</dd><dt><span class="term">
<code class="literal">increment2</code>
</span></dt><dd>
Corresponds to the second button being clicked last.
</dd></dl></div><p>The value of <code class="literal">counter</code> should be incremented only when its state
switches from one state to the other, i.e. the button, which was
clicked, is different from the previous button to be clicked. This can
be achieved using two stateful bindings which take effect during the
state transitions <code class="literal">increment1 =&gt; increment2</code>, <code class="literal">increment2 =&gt;
increment1</code>.</p><pre class="screen">counter + 1 -&gt; counter :: increment1 =&gt; increment2
counter + 1 -&gt; counter :: increment2 =&gt; increment1</pre><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="literal">counter + 1</code> can be refactored into a separate node to avoid
having to type it out twice.</p></td></tr></table></div><p><code class="literal">counter</code> will retain its previous value during any other state
transition.</p><p>We need to set <code class="literal">counter</code>'s state, to <code class="literal">increment1</code> or
<code class="literal">increment2</code>, based on which button was clicked last. To achieve that
we can exploit the fact that each explicit binding to a node, without
an explicit context, results in the creation of a new context. When
the value of the <span class="emphasis"><em>source</em></span> node, of the binding, changes, the binding
context is activated.</p><p>We know that the value of <code class="literal">clicked1</code> changes to true, and then to
false, again, when the first button is clicked. The same is true for
<code class="literal">clicked2</code> when the second button is pressed. We want the state of
<code class="literal">counter</code> (<code class="literal">/state(counter)</code>) to be bound to the literal symbol
<code class="literal">increment1</code>, when the value of <code class="literal">clicked1</code> changes regardless of what
that value is. For that, we can use the utility <code class="literal">!-</code> meta-node,
introduced in <a class="xref" href="#adding-numbers-improved-error-handling" title="9.3. Improved Error Handling in Adding Numbers">Section 9.3, “Improved Error Handling in <span class="emphasis"><em>Adding Numbers</em></span>”</a>, which
returns the value of its second argument if its first argument does
not evaluate to a failure.</p><p>The following are the binding declarations which set the state of
<code class="literal">counter</code>.</p><pre class="screen">clicked1? !- '(increment1) -&gt; /state(counter)
clicked2? !- '(increment2) -&gt; /state(counter)</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The sole purpose of the <code class="literal">!-</code> operator is to force the value of
<code class="literal">/state(counter)</code> to be updated whenever the value <code class="literal">clicked1</code> or
<code class="literal">clicked2</code> changes.</p></td></tr></table></div><p>To make it obvious which button should be clicked, we’ll make the
button which increments the counter change to green. We’ll bind each
button’s background color to <code class="literal">"green"</code> if the other button was the
last button to be pressed, and <code class="literal">"gray"</code> if it was the last button to
be pressed. This is achieved with the following:</p><pre class="screen">increment1 &lt;- /state(counter) = '(increment1)
increment2 &lt;- /state(counter) = '(increment2)

case (increment2 : "green", "gray") -&gt;
    self.increment1.style.backgroundColor
case (increment1 : "green", "gray") -&gt;
    self.increment2.style.backgroundColor</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>We’re comparing the state of counter directly to determine which
button was pressed last.</p></td></tr></table></div><p>Finally, let’s make the initial state of <code class="literal">counter</code>, <code class="literal">increment2</code> so
that pushing on the first button, increments the counter.</p><p>Build and run the application. Initially you should see something
similar to the following:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial10/snap6.png" align="middle" alt="Start: 0, Increment 1 (green), Increment 2, Counter: 0" /></div></div><p>Click on the green <span class="emphasis"><em>Increment 1</em></span> button:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial10/snap7.png" align="middle" alt="Start: 0, Increment 1, Increment 2 (green), Counter: 1" /></div></div><p>The counter is incremented by one, and the button changes to grey with
the other button changing to green. Clicking on the same, now grey,
button will not affect the value of the counter.</p><p>Click on the green <span class="emphasis"><em>Increment 2</em></span> button:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial10/snap8.png" align="middle" alt="Start: 0, Increment 1 (green), Increment 2, Counter: 2" /></div></div><p>The counter is incremented once again, and button <span class="emphasis"><em>Increment 1</em></span>
changes back to green with button <span class="emphasis"><em>Increment 2</em></span> changing back to
<span class="emphasis"><em>grey</em></span>.</p><p>Just to make sure everything works properly let’s reset the counter
and push the green button to increment it.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial10/snap9.png" align="middle" alt="Start: 10, Increment 1 (green), Increment 2, Counter: 10" /></div></div><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial10/snap10.png" align="middle" alt="Start: 10, Increment 1, Increment 2 (green), Counter: 11" /></div></div><p>Everything works as expected. The state of <code class="literal">counter</code> does not affect
the binding <code class="literal">start -&gt; counter</code> as it is a <span class="emphasis"><em>stateless</em></span>, without an
explicit state specified, binding.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_exercises"></a>10.6. Exercises</h3></div></div></div><p>Try out the following as an exercise:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Change the previous application such that clicking on the grey
  button, i.e. the button which does not increment the counter,
  decrements the counter.
</li><li class="listitem">
Implement a toggle button of which the background color, and text,
  changes when pressed.
</li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_list_processing"></a>11. List Processing</h2></div></div></div><p>This tutorial is an introduction to processing lists of data. Lists
are <span class="emphasis"><em>conceptually</em></span> represented as a linked list of nodes in which the
<span class="emphasis"><em>head</em></span> of the node stores the list element and the <span class="emphasis"><em>tail</em></span> stores the
next node, i.e. the remainder, of the list. The meta-nodes <code class="literal">head</code> and
<code class="literal">tail</code>, from the <code class="literal">core</code> module, return the <code class="literal">head</code> and <code class="literal">tail</code> of a list
node respectively.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>This is only a conceptual view as not all lists are necessarily
implemented as linked lists. Some lists are actually implemented as
contiguous arrays which provide a linked list interface. In the
current release, only linked lists can be created explicitly, however
functionality for creating arrays will be added in a future release.</p></td></tr></table></div><p>The empty list is represented by the value of the node <code class="literal">Empty</code>. The
<code class="literal">tail</code> of the last node in a list is bound to this node.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The node <code class="literal">Empty!</code> is bound to a failure of type <code class="literal">Empty</code>, which is
returned when attempting to access the <span class="emphasis"><em>head</em></span> or <span class="emphasis"><em>tail</em></span> of an empty
list.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_creating_lists"></a>11.1. Creating Lists</h3></div></div></div><p>The <code class="literal">cons</code> meta-node creates a list node, taking the value for the
<code class="literal">head</code> and the <code class="literal">tail</code> as arguments. This can be used to append to the
front of an existing list:</p><pre class="screen"># Create a list of 1 element, by appending to the front of the empty
# list
l1 &lt;- cons(a, Empty)

# Append to front of l1, creating a list of 2 elements
l2 &lt;- cons(b, l1)</pre><p>The <code class="literal">list</code> meta-node takes a variable number of arguments and returns
a list containing the values of the arguments as elements.</p><pre class="screen"># Create list with elements: 1, 2, 3
l &lt;- list(1, 2, 3)</pre><p>The <code class="literal">list*</code> meta-node, also taking a variable number of arguments, is
used to prepend a number of elements to the front of a list. The last
argument is interpreted as a list with the remaining arguments
prepended to the front of it.</p><pre class="screen"># Create list with 1 and 2 prepended to the front of l1
l2 &lt;- list*(1, 2, l1)</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_higher_order_meta_nodes"></a>11.2. Higher-Order Meta-Nodes</h3></div></div></div><p>Meta-Nodes can be passed to other meta-nodes as arguments, or bound to
ordinary nodes, in which case the function of the meta-node is
referenced.</p><p>A node can appear as the operator in a functor node in which case the
function, of which the reference is stored in the node’s value, is
applied on the arguments. If the node’s value is not a reference to
function or the function is applied on an incorrect number of
arguments, the result is a failure value.</p><p><strong>Example. </strong>
</p><pre class="screen">call(f, arg) : f(arg)
func(x) : x

f &lt;- func
result &lt;- call(f, y)</pre><p>
</p><p>In this example the <code class="literal">call</code> meta-node takes two arguments and returns
the result of applying the first argument <code class="literal">f</code> on the second argument
<code class="literal">arg</code>. The node <code class="literal">f</code> is bound to a reference to the function of the
meta-node <code class="literal">func</code>, which is then passed to the <code class="literal">call</code> meta-node.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_outer_node_references"></a>Outer Node References</h4></div></div></div><p>An interesting aspect of higher-order programming in Tridash is that
when referencing a meta-node as a value, which references the values
of nodes declared in the global scope, a binding is established
between the referenced nodes and meta-node reference. A binding is
also established between the default values of optional arguments, in
the case that they are references to other nodes, and the meta-node
reference.</p><p><strong>Example. </strong>
</p><pre class="screen"># Increment `x` by the value of the global node `delta
increment(x) : x + delta

call(f, arg) : f(arg)

result &lt;- call(increment, n)</pre><p>
</p><p>The <code class="literal">increment</code> meta-node references the value of the global <code class="literal">delta</code>
node. The function of the <code class="literal">increment</code> meta-node is referenced by the
node <code class="literal">call(increment, n)</code>, thus a binding is established between
<code class="literal">delta</code> and <code class="literal">call(increment, n)</code>. The result is that whenever the
value of <code class="literal">delta</code> is changed, the value of <code class="literal">call(increment, n)</code> is
updated.</p><p>Let’s demonstrate this with a simple application. Create a <code class="literal">ui.html</code>
file containing the above code in a Tridash code tag and the following
interface in the HTML body.</p><pre class="screen">&lt;div&gt;&lt;label&gt;N:&lt;br/&gt;&lt;input value="&lt;?@ to-int(n) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
&lt;div&gt;&lt;label&gt;Delta:&lt;br/&gt;&lt;input value="&lt;?@ to-int(delta) ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
&lt;hr/&gt;
&lt;div&gt;Result: &lt;?@ result ?&gt;&lt;/div&gt;</pre><p>Build and run the application and enter a value for <span class="emphasis"><em>N</em></span> and
<span class="emphasis"><em>Delta</em></span>.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial11/snap1.png" align="middle" alt="N: 5, Delta: 1, Result: 6" /></div></div><p>The result of the value entered for <span class="emphasis"><em>N</em></span> plus <span class="emphasis"><em>Delta</em></span> is
displayed, nothing new here.</p><p>Now change the value for <span class="emphasis"><em>Delta</em></span>:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial11/snap2.png" align="middle" alt="N: 5, Delta: 3, Result: 8" /></div></div><p>The result is updated even though there is no direct instance of
<code class="literal">increment</code> but rather a reference to the function of <code class="literal">increment</code>,
which is passed to the <code class="literal">call</code> meta-node. This demonstrates that an
implicit binding <code class="literal">delta -&gt; call(increment, n)</code> is created due to
<code class="literal">increment</code> referencing the value of <code class="literal">delta</code> in its definition.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_higher_order_meta_nodes_in_list_processing"></a>Higher-Order Meta-Nodes in List Processing</h4></div></div></div><p>Higher-order meta-nodes are extremely useful for processing
lists. There are many list processing utility meta-nodes, in the
<code class="literal">core</code> module, which take a reference to a meta-node as an argument,
and perform an operation on the list using the meta-node. Here are few
examples:</p><p><strong><code class="literal">map(f, list)</code>. </strong>The <code class="literal">map</code> meta-node takes a function <code class="literal">f</code> and a list as arguments and
returns a new list with the result of the applying the function on
each element of the list.</p><p><strong>Example: <code class="literal">map</code>. </strong>
</p><pre class="screen">l &lt;- list(1, 2, 3)

1+(n) : n + 1
map(1+, l)    # Result: list(2, 4, 6)</pre><p>
</p><p>The meta-node <code class="literal">1+</code> returns its argument plus one. <code class="literal">1+</code> is applied on
each element of list <code class="literal">l</code>, containing the elements 1, 2, 3, using the
<code class="literal">map</code> meta-node. The result is the list containing the elements 2, 4,
6, which is each element of the original list plus one.</p><p><strong><code class="literal">foldl(f, list)</code>. </strong>The <code class="literal">foldl</code> meta-node reduces a list to a single value by
applying a function on the first two elements of the list, and then
applies the function again on the result of the previous application
and the next element. This is repeated until there are no more
elements in the list.</p><p><strong>Example: <code class="literal">foldl</code>. </strong>
</p><pre class="screen">l &lt;- list(1, 2, 3)
foldl(+, l)  # Result ((1 + 2) + 3) = 6</pre><p>
</p><p>In this example the <code class="literal">+</code> function is applied on the list containing the
elements 1, 2, 3. <code class="literal">foldl</code> first applies <code class="literal">+</code> on the first two elements
of the list (1, 2) producing the result 3. The <code class="literal">+</code> function is then
applied on the result 3 and the next element of the list 3, producing
the result 6.</p><p>The <code class="literal">foldl'(x, f, list)</code> function is similar to <code class="literal">foldl</code> except the
function <code class="literal">f</code> is first applied on <code class="literal">x</code> and the first element of the
list, rather than the first two elements of the list.</p><p>The <code class="literal">foldr(f, list)</code> function is similar to <code class="literal">foldl</code> except the
reduction starts from the last two elements of the list and proceeds
backwards until the first element.</p><p>Some other useful functions are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">filter(f, list)</code>
</span></dt><dd>
Returns a list containing only those elements of
<code class="literal">list</code> for which <code class="literal">f</code> returns true.
</dd><dt><span class="term">
<code class="literal">every?(f, list)</code>
</span></dt><dd>
Returns true if <code class="literal">f</code> returns true for every element
of <code class="literal">list</code>.
</dd><dt><span class="term">
<code class="literal">some?(f, list)</code>
</span></dt><dd>
Returns true if <code class="literal">f</code> returns true for at least one
element of <code class="literal">list</code>.
</dd><dt><span class="term">
<code class="literal">not-any?(f, list)</code>
</span></dt><dd>
Returns true if <code class="literal">f</code> returns false for all elements
of <code class="literal">list</code>.
</dd><dt><span class="term">
<code class="literal">not-every?(f, list)</code>
</span></dt><dd>
Returns true if <code class="literal">f</code> returns false for at least
one element of <code class="literal">list</code>.
</dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_example_message_list"></a>11.3. Example: Message List</h3></div></div></div><p>We’ll create a simple application consisting of an input field and an
<span class="emphasis"><em>Add Message</em></span> button. When the <span class="emphasis"><em>Add Message</em></span> button is pressed, the
message entered in the input field is appended to the list of
messages, which are displayed below the button.</p><p>Start off with the following user interface:</p><p><strong><code class="literal">ui.html</code>. </strong>
</p><pre class="programlisting">&lt;div&gt;&lt;label&gt;New Message: &lt;input value="&lt;?@ new-message ?&gt;"/&gt;&lt;/label&gt;&lt;/div&gt;
&lt;div&gt;&lt;button id="add"&gt;Add Message&lt;/button&gt;&lt;/div&gt;
&lt;hr/&gt;
&lt;pre&gt;&lt;?@ messages ?&gt;&lt;/pre&gt;</pre><p>
</p><p>The value of the <span class="emphasis"><em>New Message</em></span> input field is bound to the node
<code class="literal">new-message</code>. The value of the <code class="literal">messages</code> node is bound to the
contents of a <code class="literal">pre</code> tag. This node will store the list of messages in
a single formatted string.</p><p>The button is given the id <code class="literal">add</code> so that we can attach an event
listener for its click event, in JavaScript:</p><p>Add the following code, which is similar to the code seen in
<a class="xref" href="#_node_states" title="10. Node States">Section 10, “Node States”</a>, to a <code class="literal">script</code> tag below the <code class="literal">pre</code> tag:</p><pre class="screen">document.addEventListener("DOMContentLoaded", async () =&gt; {
    const module = await mod;

    const add = document.getElementById('add');
    const clicked = module.nodes.clicked;

    add.addEventListener('click', function() {
        clicked.set_value(true);
        clicked.set_value(false);
    });
});</pre><p>The value of the node with the public identifier <code class="literal">clicked</code>, which is
the <code class="literal">add-clicked?</code> node, is set to true and the immediately to false
when the button is clicked. Add the following attribute declarations
for the <code class="literal">add-clicked?</code> node:</p><pre class="screen">/attribute(add-clicked?, input, True)
/attribute(add-clicked?, public-name, "clicked")</pre><p>We’ll need a node to store the list of messages. Let’s call it
<code class="literal">message-list</code> and set its initial value to the empty list.</p><pre class="screen">message-list &lt;- Empty</pre><p>The new message entered, bound to <code class="literal">new-message</code>, has to be added to
the end of <code class="literal">message-list</code>. The <code class="literal">append</code> meta-node takes two lists and
appends the second list at the end of the first list. Thus to append a
single item, we’ll pass a list of that one item to <code class="literal">append</code>.</p><pre class="screen">append(message-list, list(new-message))</pre><p>We want the value of <code class="literal">new-message</code> to be appended to <code class="literal">message-list</code>
when the <span class="emphasis"><em>Add Message</em></span> button is clicked. This can be achieved with a
stateful binding to <code class="literal">message-list</code> in the <code class="literal">add-new</code> state.</p><pre class="screen">append(message-list, list(new-message)) -&gt;
    message-list :: add-new</pre><p>The state of <code class="literal">message-list</code> should be set to <code class="literal">add-new</code> when the <span class="emphasis"><em>Add
Message</em></span> Button is pressed. The <code class="literal">add-clicked?</code> node is true when the
button is being pressed and false otherwise, thus the state of
<code class="literal">message-list</code> can be set with the following <code class="literal">case</code> expression:</p><pre class="screen">case(
    add-clicked? : '(add-new),
    '(default)
) -&gt; /state(message-list)</pre><p>We have completed the functionality for adding a message to the end of
the messages list. All that remains is to format that list into a
string which is displayed to the user.</p><p>We need a single string containing each message followed by a
newline. We’ll write a <code class="literal">format-message</code> meta-node which appends a line
break to a message.</p><p><strong>Meta-Node <code class="literal">format-message</code>. </strong>
</p><pre class="screen">format-message(message) :
    format("%s\n", message)</pre><p>
</p><p><code class="literal">format-message</code> uses the <code class="literal">format</code> meta-node, introduced in
<a class="xref" href="#functions" title="4. Writing your own Functions">Section 4, “Writing your own Functions”</a>, to produce a string containing the message, replacing
the <code class="literal">%s</code> placeholder, followed by a line break.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="literal">\n</code> in a string is an escape sequence for a line break. Other
escape sequences are: <code class="literal">\r</code> — carriage return, <code class="literal">\t</code> — tab and
<code class="literal">\u{&lt;code&gt;}</code> — Unicode character with code <code class="literal">&lt;code&gt;</code>.</p></td></tr></table></div><p>To format each message, we’ll apply <code class="literal">format-message</code> on each message
in <code class="literal">message-list</code> using <code class="literal">map</code>.</p><pre class="screen">formatted-messages &lt;- map(format-message, message-list)</pre><p>Finally, to concatenate the formatted messages into a single string,
we’ll use the <code class="literal">string-concat</code> meta-node, which takes two strings as
arguments and returns the concatenation of both strings. We’ll need to
apply <code class="literal">string-conat</code> on each element in <code class="literal">formatted-messages</code> in turn,
accumulating the result in a single string. We can do that using the
<code class="literal">foldl</code> node, passing in <code class="literal">string-concat</code> as the reduction function:</p><pre class="screen">messages &lt;- foldl(string-concat, formatted-messages)</pre><p>The resulting string is bound to <code class="literal">messages</code> which is displayed in the
<code class="literal">pre</code> (preformatted) tag, below the <span class="emphasis"><em>Add Message</em></span> button.</p><p>Build and run the application, using the build configuration file from
<a class="xref" href="#example-counter-app" title="10.3. Example: Counter Application">Section 10.3, “Example: Counter Application”</a>. Enter a message and press the <span class="emphasis"><em>Add Message</em></span> button.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial11/snap3.png" align="middle" alt="Hello World!" /></div></div><p>The message is displayed.</p><p>Now enter a new message and click the <span class="emphasis"><em>Add Message</em></span> button.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials/images/tutorial11/snap4.png" align="middle" alt="Hello World!, Hi there, how you doing?" /></div></div><p>The message is displayed below the old message.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_modules_and_organization"></a>12. Modules And Organization</h2></div></div></div><p>Up till this point we haven’t given much thought as to how our source
code is organized. Instead we’ve crammed all our code in a Tridash
code tag inside a single <code class="literal">ui.html</code> file. This strategy obviously wont
scale for larger applications. Ideally we’d like to have <span class="emphasis"><em>separation
of concerns</em></span> with our application divided into multiple source files,
each containing the code implementing a separate component of the
application. The <code class="literal">ui.html</code> should ideally contain a minimal amount of
Tridash code, limited only to inline node references and bindings
directly related to the presentation logic. The core application logic
should be in a separate source file.</p><p>In this tutorial we’ll take the <span class="emphasis"><em>Adding Numbers</em></span> application, as it is
at the end of <a class="xref" href="#contexts" title="9. Contexts">Section 9, “Contexts”</a>, and reorganize its source code.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multiple_source_files"></a>12.1. Multiple Source Files</h3></div></div></div><p>The simplest form of code organization is splitting up the application
into multiple source files. Source files containing only Tridash code
are given the extension <code class="literal">trd</code>.</p><p>Let’s extract the validation logic in a separate <code class="literal">validation.trd</code>
file. This includes the meta-nodes <code class="literal">validate</code>, <code class="literal">valid-int</code> and the
<code class="literal">Negative-Number</code> failure type.</p><p><strong><code class="literal">validation.trd</code>. </strong>
</p><pre class="screen">/import(core)

Negative-Number  &lt;- &amp;(Negative-Number)
Negative-Number! &lt;- fail(Negative-Number)

validate(x) :
    case(
        x &gt;= 0 : x,
        Negative-Number!
    )

valid-int(value) : {
    x &lt;- int(value)
    validate(x)
}

/attribute(valid-int, target-node, valid-int)</pre><p>
</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>We’ve kept the <code class="literal">/import(core)</code> declaration at the top of the
file.</p></td></tr></table></div><p>The application logic simply consists of the definition of the
<code class="literal">error-message</code> meta-node, which is responsible for choosing an
appropriate error message, the computation of the sum, and the setting
of the initial values for <code class="literal">a</code> and <code class="literal">b</code>.</p><p>Let’s place this in a separate source file called <code class="literal">app.trd</code></p><p><strong><code class="literal">app.trd</code>. </strong>
</p><pre class="screen">/import(core)

error-message(value) : {
    value !- "" -&gt;
        @(self)

    "Not a valid number!" -&gt;
        self @ when(Invalid-Integer)

    "Number must be greater than or equal to 0!" -&gt;
        self @ when(Negative-Number)
}

sum &lt;- a + b

0 -&gt; a
0 -&gt; b</pre><p>
</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>We’ve kept the <code class="literal">/import(core)</code> declaration at the top of the
file in case we want this file to be processed first by the
compiler. If we know this file will be processed after
<code class="literal">validation.trd</code>, which already contains an <code class="literal">/import(core)</code>,
declaration we can omit it.</p></td></tr></table></div><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>We’ve bound the sum of <code class="literal">a</code> and <code class="literal">b</code> to node <code class="literal">sum</code>, in order to
avoid placing application logic in inline node declarations.</p></td></tr></table></div><p>All that’s left in the <code class="literal">ui.html</code> file is the user interface elements
and the inline bindings to the nodes <code class="literal">a</code>, <code class="literal">b</code>, <code class="literal">sum</code> and the
<code class="literal">error-message</code> instances, which display the error messages.</p><p><strong><code class="literal">ui.html</code>. </strong>
</p><pre class="programlisting">&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Adding Numbers&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Adding Numbers&lt;/h1&gt;
      &lt;div&gt;
        &lt;label&gt;A: &lt;input id="a" value="&lt;?@ valid-int(a) ?&gt;"/&gt;&lt;/label&gt;
        &lt;?@ error-message(a) ?&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label&gt;B: &lt;input id="b" value="&lt;?@ valid-int(b) ?&gt;"/&gt;&lt;/label&gt;
        &lt;?@ error-message(b) ?&gt;
      &lt;/div&gt;
      &lt;hr/&gt;
      &lt;div&gt;&lt;strong&gt;A + B = &lt;?@ sum ?&gt;&lt;/strong&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_building_2"></a>Building</h4></div></div></div><p>To build an application consisting of multiple source files, the
source files are simply listed, under the <code class="literal">sources</code> entry, of the
build configuration file. Modify the <code class="literal">build.yml</code> file to the
following:</p><p><strong><code class="literal">build.yml</code>. </strong>
</p><pre class="screen">sources:
  - validation.trd
  - app.trd
  - path: ui.html
    node-name: ui

output:
  path: app.html
  type: html
  main-ui: ui</pre><p>
</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The source files are processed in the order they are listed.</p></td></tr></table></div><p>Since there are no processing options for <code class="literal">validation.trd</code> and
<code class="literal">app.trd</code>, we’ve listed the paths to the files directly rather than in
the <code class="literal">path</code> entry of a dictionary.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>To build entirely from the command-line, simply list the files, in the
order they are to be processed, after <code class="literal">tridashc</code>.</p><p>The following is equivalent to the build configuration file</p><pre class="screen">tridashc validation.trd app.trd path : node-name=ui.html \
    -o path.html -p type=html -p main-ui=ui</pre></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_modules_in_depth"></a>12.2. Modules In Depth</h3></div></div></div><p>Whilst separating the application into multiple source files, grouping
related components in a single file, is a significant cleanup, it
would be even better if the nodes could be grouped into different
namespaces based on their purpose, for example <span class="emphasis"><em>utility</em></span>, <span class="emphasis"><em>application
logic</em></span> and <span class="emphasis"><em>ui</em></span>. This would allow us to use only the nodes from the
<span class="emphasis"><em>utility</em></span> namespace, without having the rest of the <span class="emphasis"><em>utility</em></span> nodes
clash (i.e. have the same identifiers) with the <span class="emphasis"><em>application logic</em></span>
nodes. Whilst in this application there are no clashes, keeping the
nodes in separate namespaces allows us to use the same
<code class="literal">validation.trd</code> file in another application without the fear that
some node is going to clash with other nodes in the application.</p><p>Modules are a means of separating nodes into different namespaces,
where each module is a namespace in which nodes are contained. A node
with identifier <code class="literal">x</code> in module <code class="literal">mod1</code> is a distinct node from the node
<code class="literal">x</code> in <code class="literal">mod2</code>, even though the two nodes share the same identifier.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>We’ve already made use of the <code class="literal">core</code> module throughout these
tutorials.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_creating_modules"></a>Creating Modules</h4></div></div></div><p>Modules are created with the <code class="literal">/module</code> operator which has the
following syntax:</p><p><strong><code class="literal">/module</code> Operator Syntax. </strong>
</p><pre class="screen">/module(module-name)</pre><p>
</p><p>This indicates that all node references, in the declarations following
the <code class="literal">/module</code> declaration, will occur in the module with identifier
<code class="literal">module-name</code>. Remember that nodes are created the first time they are
referenced, thus if a node is referenced which is not in the module,
it is created and added to the module.</p><p><strong>Example. </strong>
</p><pre class="screen">/module(mod1)
x -&gt; node1

/module(mod2)
x -&gt; node2</pre><p>
</p><p>The first reference to the node <code class="literal">x</code> occurs in module <code class="literal">mod1</code> thus a
node <code class="literal">x</code> is added to <code class="literal">mod1</code>. The second referenced occurs in module
<code class="literal">mod2</code> thus the node is added to <code class="literal">mod2</code>. The two nodes are distinct
even though they share the same identifier.</p><p>If no module is specified the node references occur in a nameless
<span class="emphasis"><em>init</em></span> module. The current module is reset to the <span class="emphasis"><em>init</em></span> module prior
to processing each source file.</p><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Module identifiers are distinct from node identifiers, thus
a node <code class="literal">mod</code> will not clash with a module <code class="literal">mod</code> unless the module is
added as a node to the module containing the node <code class="literal">mod</code>.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_using_modules"></a>Using Modules</h4></div></div></div><p>This is great but it is of little use if you can’t reference a node
that is declared in a different module from the current module.</p><p>The <code class="literal">/use</code> operator allows nodes in a module to be referenced as
subnodes of a node with same identifier as the module identifier.</p><p><strong><code class="literal">/use</code> Operator Syntax. </strong>
</p><pre class="screen">/use(mod1)</pre><p>
</p><p>This adds a node <code class="literal">mod1</code> to the module in which the declaration
occurs. Then you can reference a node <code class="literal">x</code> in <code class="literal">mod1</code> as a subnode of
<code class="literal">mod1</code>, <code class="literal">mod1.x</code>. <code class="literal">mod1</code> is, however, a pseudo-node as its value
cannot be referenced nor can bindings involving it be established. It
only serves as a means to reference nodes in the module <code class="literal">mod1</code>.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>To use a meta-node <code class="literal">f</code> declared in <code class="literal">mod1</code>, simply reference it as
a subnode of <code class="literal">mod1</code>, <code class="literal">mod1.f(a, b)</code>.</p></td></tr></table></div><p>This greatly increases the functionality of modules however sometimes
it may become annoying to have to type out the full name of the module
over and over again, for each node. You can try keeping the module
names short however then you run the risk of module name
collisions. The <code class="literal">/use-as</code> operator allows you to control the
identifier of the pseudo-node, that is created in the current module,
with which nodes in the module can be referenced.</p><p><strong><code class="literal">/use-as</code> Operator Syntax. </strong>
</p><pre class="screen">/use-as(mod1, m)</pre><p>
</p><p>This creates a pseudo-node with identifier <code class="literal">m</code>, with which nodes in
<code class="literal">mod1</code> can be referenced. Nodes in <code class="literal">mod1</code> can then be referenced as
subnodes of <code class="literal">m</code>.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Both <code class="literal">/use</code> and <code class="literal">/use-as</code> will trigger a compilation error if
the pseudo-node identifier already names a node in the current module.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_importing_nodes"></a>Importing Nodes</h4></div></div></div><p>Sometimes you would like to explicitly add a node in another module to
the current module, so that you don’t have to reference it as a
subnode of the module. The <code class="literal">/import</code> operator allows you to do this.</p><p>It has two forms:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
A short form taking only the module as an argument, in which case
  all nodes exported from the module are added to the current module.
</li><li class="listitem">
A long form in which the first argument is the module and the
  following arguments are the individual nodes to import from the
  module. Only the nodes listed are imported.
</li></ul></div><p><strong>Example. </strong>
</p><pre class="screen"># Short form: Import all nodes exported from mod1
/import(mod1)

# Long form: Only import nodes x, y, z
/import(mod1, x, y, z)</pre><p>
</p><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The short form only imports those nodes which are exported
from the module not all nodes.</p></td></tr></table></div><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The long form allows you to choose which nodes are imported into
the current module. You can list any node in the module, not just an
exported node.</p></td></tr></table></div><p><code class="literal">/import</code> also has a side-effect in that if an imported node, whether
imported by the long or short form, is registered as an infix
operator, its entry in the operator table is copied over to the
operator table of the current module so that it can also be written in
infix position in the current module.</p><p><strong>Example. </strong>
</p><pre class="screen"># @ is a meta-node that is registered as an infix operator
/import(mod1, @)

# It can be also be placed in infix position in the current module
x @ y</pre><p>
</p><p>You cannot place a node in infix position if it is referenced as a
subnode of the module.</p><pre class="screen">/use(mod1)

# The following will not compile as you cannot place a subnode in
# infix position.

x mod1.@ y

# Instead you have to write it in prefix notation:
mod1.@(x, y)</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_exporting_nodes"></a>Exporting Nodes</h4></div></div></div><p>We mentioned that the short form of the <code class="literal">/import</code> operator imports all
nodes which are exported from the module. Nodes are exported from the
current module using the <code class="literal">/export</code> operator.</p><pre class="screen">/module(mod1)

# Exports nodes x, y and z from the current module
/export(x, y, z)</pre><p>Importing <code class="literal">mod1</code> by the short form, <code class="literal">/import(mod1)</code>, will import nodes
<code class="literal">x</code>, <code class="literal">y</code> and <code class="literal">z</code> into the module.</p><p><code class="literal">/export</code> can take any number of arguments and multiple <code class="literal">/export</code>
declarations will result in the nodes listed in each declaration being
exported.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_directly_reference_nodes_in_another_module"></a>Directly Reference Nodes in Another Module</h4></div></div></div><p>The <code class="literal">/in</code> operator references a node in another module, for which a
symbol has not been created in the current module using <code class="literal">/use</code> or
<code class="literal">/use-as</code>.</p><p><strong><code class="literal">/in</code> Operator Syntax. </strong>
</p><pre class="screen">/in(module, node)</pre><p>
</p><p>where <code class="literal">module</code> is the name of the <code class="literal">module</code>, as declared by the
<code class="literal">/module</code> operator, and <code class="literal">node</code> is the node expression which is
processed in <code class="literal">module</code>.</p><p>This operator is most useful when writing macros, however there is
rarely a need for it when writing code directly as whatever can be
achieved with <code class="literal">/in</code> can be achieved in a more readable manner with
<code class="literal">/use</code>, <code class="literal">/use-as</code> or <code class="literal">/import</code>.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_adding_modularity_to_emphasis_adding_numbers_emphasis"></a>12.3. Adding Modularity to <span class="emphasis"><em>Adding Numbers</em></span></h3></div></div></div><p>Let’s group the nodes declared in the <code class="literal">validation.trd</code> file, i.e. the
nodes related to the input validation logic into a module called
<code class="literal">validation</code>. To do that simply add the declaration
<code class="literal">/module(validation)</code> to the top of the file.</p><p>We mainly require the <code class="literal">valid-int</code> meta-node and <code class="literal">Negative-Number</code>
failure type node to be referenced outside the <code class="literal">validation</code> module,
thus we’ll export those nodes using the declaration
<code class="literal">/export(valid-int, Negative-Number)</code>.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>We haven’t exported <code class="literal">validate</code> and <code class="literal">Negative-Number!</code> as those
are only used in the implementation of <code class="literal">valid-int</code>, and are not used
outside the <code class="literal">validation.trd</code> file.</p></td></tr></table></div><p><strong><code class="literal">validation.trd</code>. </strong>
</p><pre class="screen">/module(validation)
/import(core)
...
/export(valid-int, Negative-Number)</pre><p>
</p><p>We’ll group the main application logic into a <code class="literal">sum-app</code> module, by
adding the declaration <code class="literal">/module(sum-app)</code> to the top of the <code class="literal">app.trd</code>
file. The nodes exported from the <code class="literal">validation</code> module have to be
imported in this module, by adding an import declaration for the
module after the import declaration for the <code class="literal">core</code> module. We’ll
contain the user interface in this module, thus we wont be needing to
export any nodes from it.</p><p><strong><code class="literal">app.trd</code>. </strong>
</p><pre class="screen">/module(sum-app)

/import(core)
/import(validation)

...</pre><p>
</p><p>Finally, we have to add a Tridash code tag to the top of the <code class="literal">ui.html</code>
file, which changes the module to <code class="literal">sum-app</code>, since the <code class="literal">sum</code> and
<code class="literal">error-message</code> nodes are contained in it.</p><p><strong><code class="literal">ui.html</code>. </strong>
</p><pre class="screen">&lt;? /module(sum-app) ?&gt;
&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Adding Numbers&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Adding Numbers&lt;/h1&gt;
      &lt;div&gt;
        &lt;label&gt;A: &lt;input id="a" value="&lt;?@ valid-int(a) ?&gt;"/&gt;&lt;/label&gt;
        &lt;?@ error-message(a) ?&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label&gt;B: &lt;input id="b" value="&lt;?@ valid-int(b) ?&gt;"/&gt;&lt;/label&gt;
        &lt;?@ error-message(b) ?&gt;
      &lt;/div&gt;
      &lt;hr/&gt;
      &lt;div&gt;&lt;strong&gt;A + B = &lt;?@ sum ?&gt;&lt;/strong&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><p>We’ve successfully divided our source code into multiple modules,
based on the purpose of the nodes defined in it. However, the node
which references the contents of the <code class="literal">ui.html</code> file is still added to
the <span class="emphasis"><em>init</em></span> module. Whilst in this application it doesn’t pose a
problem as there is no other node with identifier <code class="literal">ui</code> in the <span class="emphasis"><em>init</em></span>
module, it may become a problem if there is a need to reference HTML
elements from within the <code class="literal">app.trd</code> file. Remember HTML elements can
only be referenced as subnodes of <code class="literal">self</code>, within the HTML file
itself. Outside the file they have to be referenced as subnodes of the
node which references the contents of the HTML file.</p><p>In order for the <code class="literal">ui</code> node to be created in a module other than
<span class="emphasis"><em>init</em></span>, the <code class="literal">node-name</code> option has to be of the following form
<code class="literal">module.name</code>, where <code class="literal">module</code> is the module in which the node should
be created and <code class="literal">name</code> is the name of the node. The same syntax applies
in the <code class="literal">main-ui</code> output option.</p><p>Change the <code class="literal">build.yml</code> file to the following:</p><p><strong><code class="literal">build.yml</code>. </strong>
</p><pre class="screen">sources:
  - util.trd
  - app.trd
  - path: ui.html
    node-name: sum-app.ui

output:
  path: app.html
  type: html
  main-ui: sum-app.ui</pre><p>
</p><p>With this you can now reference HTML elements, from <code class="literal">app.trd</code>, as
subnodes of the <code class="literal">ui</code> node.</p><p>Build and run the application. You wont see any new features however
we’ve significantly improved the organization of the code and thereby
improved the maintainability of the application.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>You wouldn’t typically divide an application this small into
multiple modules, however we’ve done so here in order to demonstrate
how it is done.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_infix_operators"></a>12.4. Infix Operators</h3></div></div></div><p>We have referred to some meta-nodes as being <span class="emphasis"><em>registered as infix
operators</em></span>. This allows them to be placed in infix position instead of
prefix position. It turns out you can do the same for your own
nodes. This section describes how.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_precedence_and_associativity_basics"></a>Precedence and Associativity Basics</h4></div></div></div><p>Each module has an operator table, which contains the identifiers of
all nodes which can be placed in infix position as well as their
precedence and associativity. The precedence is a number which
controls the priority with which operands are grouped with infix
operators, in an expression containing multiple different infix
operators. Higher numbers indicate greater precedence.</p><p>The multiplication <code class="literal">*</code> operator has a greater precedence (200), than
the addition <code class="literal">+</code> operator (100) thus arguments will be grouped with
the multiplication operator first and then the addition operator.</p><p>The following infix expression:</p><pre class="screen">x + y * z</pre><p>is parsed to the following expression in prefix notation:</p><pre class="screen">+(x, *(y, z))</pre><p>Notice that the <code class="literal">*</code> operator is grouped with the operands <code class="literal">y</code> and <code class="literal">z</code>
first, and then <code class="literal">x</code> and <code class="literal">*(y, z)</code> are grouped with the <code class="literal">+</code>
operator. This is due to <code class="literal">*</code> having a greater precedence than <code class="literal">+</code>.</p><p>To achieve the following grouping:</p><pre class="screen">*(+(x, y), z)</pre><p>enclose <code class="literal">x + y</code> in parenthesis:</p><pre class="screen">(x + y) * z</pre><p>Associativity controls the grouping of operands in an expression
containing multiple instances of the same infix operator. The <code class="literal">+</code>
operator has left associativity.</p><p>Thus the following infix expression:</p><pre class="screen">x + y + z</pre><p>is parsed to the following expression in prefix notation:</p><pre class="screen">+(+(x, y), z)</pre><p>i.e. it is equivalent to</p><pre class="screen">(x + y) + z</pre><p>If the <code class="literal">+</code> operator were to have right associativity, the expression
would be parsed to the following:</p><pre class="screen">+(x, +(y, z))</pre><p>Below is a table showing the precedence and associativity of some of
the builtin operators.</p><div class="informaltable"><table class="informaltable" cellpadding="4px" style="border-collapse: collapse;border-top: 3px solid #527bbd; border-bottom: 3px solid #527bbd; border-left: 3px solid #527bbd; border-right: 3px solid #527bbd; "><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /></colgroup><thead><tr><th style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"> Operator </th><th style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"> Precedence </th><th style="border-bottom: 1px solid #527bbd; " align="left" valign="top"> Associativity</th></tr></thead><tbody><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">-&gt;</code></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"><p>10</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>right</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">&lt;-</code></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"><p>10</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>left</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">!-</code></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"><p>15</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>right</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">or</code></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"><p>20</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>left</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">and</code></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"><p>25</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>left</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">+</code></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"><p>100</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>left</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">-</code></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"><p>100</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>left</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">*</code></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"><p>200</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>left</p></td></tr><tr><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">/</code></p></td><td style="border-right: 1px solid #527bbd; " align="right" valign="top"><p>200</p></td><td style="" align="left" valign="top"><p>left</p></td></tr></tbody></table></div><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Visit the <code class="literal">modules/core/operators.trd</code> file of your Tridash
installation to see the full list.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_registering_your_own_infix_operators"></a>Registering your own infix operators</h4></div></div></div><p>Node identifiers can be registered as infix operators with the special
<code class="literal">/operator</code> declaration.</p><p><strong><code class="literal">/operator</code> Syntax. </strong>
</p><pre class="screen">/operator(id, precedence, [left | right])</pre><p>
</p><p>The first argument is the identifier, the second argument is the
operator precedence as a number and the final argument is the symbol
<code class="literal">left</code> or <code class="literal">right</code> for left or right associativity. If the third
argument is omitted it defaults to <code class="literal">left</code>.</p><p>This declaration adds an infix operator to the operator table of the
current module. In the declarations, following the <code class="literal">/operator</code>
declaration, <code class="literal">id</code> can be placed in infix position.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="literal">id</code> can be any valid identifier, not just an identifier
consisting only of special symbols. However, as a result, a space is
required in between the operator and its operands.</p></td></tr></table></div><p>It is not checked whether <code class="literal">id</code> actually names an existing
node, however using it in infix position only makes sense if
<code class="literal">id</code> names a meta-node.</p><p>If the node with identifier <code class="literal">id</code> is imported into another module, its
entry in the operator table, of the module from which it is imported,
is copied into the operator table of the module into which it is
imported.</p><p>The precedence and associativity of existing operators can be changed
by an <code class="literal">/operator</code> declaration, however only the operator table of the
current module is changed even if the operator is an imported node.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_example_infix_literal_add_literal_operator"></a>Example: Infix <code class="literal">add</code> Operator</h4></div></div></div><p>To demonstrate how you would go about registering a meta-node as an
infix operator, we’ll write an <code class="literal">add</code> meta-node which computes the sum
of two numbers, register it as an infix operator and replace <code class="literal">a + b</code>
with <code class="literal">a add b</code> in the <span class="emphasis"><em>Adding Numbers</em></span> Application.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>There is no value in writing a new meta-node which is simply a
wrapper over a builtin meta-node, and registering it as an infix
operator. The purpose of this tutorial is simply to demonstrate how
you would register your own meta-node as an infix operator.</p></td></tr></table></div><p>We’ll first define <code class="literal">add</code> and then register it as an infix operator
with precedence 100 and <span class="emphasis"><em>left</em></span> associativity which is the same as the
builtin <code class="literal">+</code> operator.</p><p>Add the following somewhere near the top in <code class="literal">app.trd</code>:</p><pre class="screen">add(a, b) : a + b

/operator(add, 100, left)</pre><p>Now change the binding declaration to <code class="literal">sum</code> with the following:</p><pre class="screen">sum &lt;- a add b</pre><p>That’s it you’ve now added your own infix operator to the language.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_what_8217_s_next"></a>13. What’s Next?</h2></div></div></div><p>You’ve completed the introductory tutorials which introduce the
features of the language. More tutorials will follow shortly, on
more advanced topics such as the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Pattern Matching
</li><li class="listitem">
String processing
</li><li class="listitem">
Writing your own Macros
</li><li class="listitem">
Foreign Function Interface
</li><li class="listitem">
Controlling Optimizations
</li></ul></div><p>Tridash is still in the proof of concept phase, but is slowly
advancing to the point where it is fully usable for real-world
applications. There are still corner cases which need to be cleaned
up, and features, necessary for real world applications, to implement.
The next major release will feature the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
A complete HTML library allowing for directly hooking into events,
  from Tridash, and DOM manipulation
</li><li class="listitem">
Standard library with more math functions, string manipulation
  functions and other data structures besides lists.
</li></ul></div></div><div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.idm315188384416" class="footnote"><p><a href="#idm315188384416" class="simpara"><sup class="simpara">[1] </sup></a>This performs a similar function to Lisp’s <code class="literal">quote</code> or
<code class="literal">'</code> operator</p></div></div></div></body></html>