<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Tridash Tutorials</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /></head><body><div xml:lang="en" class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="idm122300439232"></a>Tridash Tutorials</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Alexander</span> <span class="surname">Gutev</span></h3><code class="email">&lt;<a class="email" href="mailto:alex.gutev@gmail.com">alex.gutev@gmail.com</a>&gt;</code></div></div></div><hr /></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#tutorial1">1. Hello Node</a></span></dt><dd><dl><dt><span class="section"><a href="#_nodes">1.1. Nodes</a></span></dt><dt><span class="section"><a href="#_bindings">1.2. Bindings</a></span></dt><dt><span class="section"><a href="#_first_application">1.3. First Application</a></span></dt><dt><span class="section"><a href="#_inline_node_declarations">1.4. Inline Node Declarations</a></span></dt></dl></dd><dt><span class="section"><a href="#_functional_bindings">2. Functional Bindings</a></span></dt><dd><dl><dt><span class="section"><a href="#_simple_budgeting_application">2.1. Simple Budgeting Application</a></span></dt><dt><span class="section"><a href="#_inline_functional_bindings">2.2. Inline Functional Bindings</a></span></dt><dt><span class="section"><a href="#_summary">2.3. Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#_conditional_bindings">3. Conditional Bindings</a></span></dt><dd><dl><dt><span class="section"><a href="#_case_operator">3.1. Case Operator</a></span></dt><dt><span class="section"><a href="#_budget_application_version_2_0">3.2. Budget Application Version 2.0</a></span></dt><dt><span class="section"><a href="#_improvements">3.3. Improvements</a></span></dt><dt><span class="section"><a href="#_summary_2">3.4. Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#tutorial4">4. Writing your own Functions</a></span></dt><dd><dl><dt><span class="section"><a href="#_definition_operator">4.1. Definition Operator</a></span></dt><dt><span class="section"><a href="#_budget_meter">4.2. Budget Meter</a></span></dt><dt><span class="section"><a href="#_summary_3">4.3. Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#_error_handling">5. Error Handling</a></span></dt><dd><dl><dt><span class="section"><a href="#_failures">5.1. Failures</a></span></dt><dt><span class="section"><a href="#_handling_failures">5.2. Handling Failures</a></span></dt><dt><span class="section"><a href="#_error_feedback">5.3. Error Feedback</a></span></dt><dt><span class="section"><a href="#_initial_values">5.4. Initial Values</a></span></dt><dt><span class="section"><a href="#_summary_4">5.5. Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#_failures_of_your_own">6. Failures of your own</a></span></dt><dd><dl><dt><span class="section"><a href="#_conditional_bindings_2">6.1. Conditional Bindings</a></span></dt><dt><span class="section"><a href="#_simple_validation">6.2. Simple Validation</a></span></dt><dt><span class="section"><a href="#_meta_node_instances_as_targets">6.3. Meta-Node Instances as Targets</a></span></dt><dt><span class="section"><a href="#_summary_5">6.4. Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#_outer_node_references">7. Outer Node References</a></span></dt><dd><dl><dt><span class="section"><a href="#_referencing_non_local_nodes">7.1. Referencing Non-Local Nodes</a></span></dt><dt><span class="section"><a href="#_global_color_nodes">7.2. Global Color Nodes</a></span></dt><dt><span class="section"><a href="#_application_preferences_interface">7.3. Application Preferences Interface</a></span></dt><dt><span class="section"><a href="#_referencing_global_nodes">7.4. Referencing Global Nodes</a></span></dt><dt><span class="section"><a href="#_summary_6">7.5. Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#_modules_and_organization">8. Modules and Organization</a></span></dt><dd><dl><dt><span class="section"><a href="#_multiple_source_files">8.1. Multiple Source Files</a></span></dt><dt><span class="section"><a href="#_modules_in_depth">8.2. Modules In Depth</a></span></dt><dt><span class="section"><a href="#_adding_modularity_to_our_application">8.3. Adding Modularity to our Application</a></span></dt><dt><span class="section"><a href="#_infix_operators">8.4. Infix Operators</a></span></dt><dt><span class="section"><a href="#_summary_7">8.5. Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#_what_8217_s_next">9. What’s Next?</a></span></dt></dl></div><p>These set of tutorials cover the basics of the Tridash programming
language.</p><p>Prior programming experience is not strictly necessary however is
helpful.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The full source code for these tutorials is available at
<a class="ulink" href="https://github.com/alex-gutev/tridash-tutorials" target="_top">https://github.com/alex-gutev/tridash-tutorials</a>.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="tutorial1"></a>1. Hello Node</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_nodes"></a>1.1. Nodes</h3></div></div></div><p>A Tridash program is made up of a number of components called nodes,
which are loosely analogous to variables in other languages. Each node
holds a particular value, at a given moment in time, which comprises
the node’s state.</p><p>Nodes are created the first time they are referenced. Most nodes are
explicitly referenced by their identifiers, which can consist of any
sequence of Unicode characters excluding whitespace, parenthesis <code class="literal">(</code>,
<code class="literal">)</code>, braces <code class="literal">{</code>, <code class="literal">}</code>, quotes <code class="literal">"</code> and the following special characters:
<code class="literal">;</code>, <code class="literal">,</code>, <code class="literal">.</code>, <code class="literal">#</code>. A node identifier must consist of at least one
non-digit character otherwise it is interpreted as a number.</p><p>The following are examples of valid node identifiers:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">name</code>
</li><li class="listitem">
<code class="literal">full-name</code>
</li><li class="listitem">
<code class="literal">node1</code>
</li><li class="listitem">
<code class="literal">1node</code>
</li></ul></div><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>There are few restrictions on the characters allowed in node
identifiers, meaning node identifiers may even contain symbols such as
<code class="literal">-</code>, <code class="literal">+</code>, <code class="literal">=</code>, <code class="literal">&gt;</code>, <code class="literal">?</code>, etc.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_bindings"></a>1.2. Bindings</h3></div></div></div><p>A node can be bound to another node in which case its value is
automatically updated when the value of the node, to which it is
bound, changes. Bindings can be established explicitly using the <code class="literal">-&gt;</code>
operator, or implicitly (<span class="emphasis"><em>more on this in the next section</em></span>).</p><p><strong>Example. </strong>
</p><pre class="screen">a -&gt; b</pre><p>
</p><p>In the example, above, a binding is established between node <code class="literal">a</code> and
node <code class="literal">b</code>. The result is that when the value of <code class="literal">a</code> changes, the value
of <code class="literal">b</code> is automatically updated to match the value of <code class="literal">a</code>. This kind
of binding is known as a simple binding since a node is simply set to
the value of another node. Node <code class="literal">a</code> is referred to as a <span class="emphasis"><em>dependency</em></span>
node of <code class="literal">b</code>, since <code class="literal">b</code><span class="emphasis"><em>s value depends on the value of <code class="literal">a</code>, and <code class="literal">b</code> is
referred to as an 'observer</em></span> node of <code class="literal">a</code> since it actively observes its
value.</p><p>The binding established in the example, above, is one-way since data
flows only from <code class="literal">a</code> to <code class="literal">b</code> and not from <code class="literal">b</code> to <code class="literal">a</code>. This means that
the value of <code class="literal">b</code> is updated when the value of <code class="literal">a</code> changes however the
value of <code class="literal">a</code> is not updated when the value of <code class="literal">b</code> changes.</p><p>If a binding in the reverse direction is also established:</p><pre class="screen">b -&gt; a</pre><p>the binding becomes a two-way binding and the value of each node is
updated when the value of the other node changes.</p><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="tutorials/images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The spaces between the node identifiers and the bind <code class="literal">-&gt;</code>
operator are mandatory since <code class="literal">a-&gt;b</code> is interpreted as a single node
identifier.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_first_application"></a>1.3. First Application</h3></div></div></div><p>In this tutorial we will build a simple application which asks for the
user’s name and displays a personalized “Hello” message.</p><p>This tutorial targets the JavaScript backend and makes use of HTML for
the user interface.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Some knowledge of the basics of HTML, i.e. what tags, elements
and attributes are, is necessary to complete this tutorial.</p></td></tr></table></div><p>We’ll start off by creating an HTML file, called <code class="literal">hello-ui.html</code>, with
the following contents:</p><p><strong>hello-ui.html. </strong>
</p><pre class="programlisting">&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Hello Node&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Tutorial 1: Hello Node&lt;/h1&gt;
        &lt;label&gt;Enter your name: &lt;input id="input-name"/&gt;&lt;/label&gt;
        &lt;p&gt;Hello &lt;span id="span-name"&gt;&lt;/span&gt;&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;

&lt;?
 self.input-name.value -&gt; name
 name -&gt; self.span-name.textContent
?&gt;</pre><p>
</p><p>Most of the file is HTML boilerplate, the interesting part is within
the <code class="literal">&lt;? .. ?&gt;</code> tag. The content of this tag is interpreted as Tridash
code. Tridash code tags can be placed almost anywhere in the file,
we’ve just chosen to place it at the bottom.</p><p>The Tridash code consists of two explicit binding
declarations. Declarations are separated by a line break or a
semicolon <code class="literal">;</code>.</p><p><strong>Tridash Code. </strong>
</p><pre class="screen">self.input-name.value -&gt; name
name -&gt; self.span-name.textContent</pre><p>
</p><p>The first declaration (the first line) binds the
<code class="literal">self.input-name.value</code> node to the <code class="literal">name</code> node.</p><p>The node <code class="literal">self.input-name</code> is a special node that references the
<code class="literal">input</code> element, with id <code class="literal">input-name</code>, in the HTML file. HTML elements
can be referenced from within Tridash code, in the same HTML file,
using the expression <code class="literal">self.&lt;id&gt;</code> where <code class="literal">&lt;id&gt;</code> is substituted with the
id of the element.</p><p>The <code class="literal">.</code> operator is a special operator for referencing subnodes of
nodes, these will be explained in detail later. The subnode identifier
is the identifier which appears to the right of the operator. When a
subnode of a node, that references an HTML element, is referenced, the
HTML attribute, of the element, with the same name as the subnode
identifier is referenced. Referencing attributes of HTML elements,
from Tridash, allows the values of attributes to be bound to Tridash
nodes.</p><p>The node <code class="literal">self.input-name.value</code>, which references the <code class="literal">value</code>
attribute of the HTML element with ID <code class="literal">input-name</code>, is bound to the
node <code class="literal">name</code>. Thus whenever the value of <code class="literal">input-name.value</code> changes,
the value of <code class="literal">name</code> is set to it. In other words, whenever text is
entered in the input element, the value of <code class="literal">name</code> is automatically set
to the text entered.</p><p>In the second declaration, the <code class="literal">name</code> node is bound to the
<code class="literal">self.span-name.textContent</code> node. <code class="literal">self.span-name</code> references the
HTML <code class="literal">span</code> element with ID <code class="literal">span-name</code>, with the node
<code class="literal">self.span-name.textContent</code> referencing the <code class="literal">textContent</code> attribute,
i.e. the content, of the element. The result of this binding is that
whenever the value of the <code class="literal">name</code> node changes, its value is displayed
in the <code class="literal">span</code> element. As mentioned earlier, the value of the <code class="literal">name</code>
node is automatically set to the text entered in the <code class="literal">input</code> element,
thus the value entered in the <code class="literal">input</code> element is displayed in the
<code class="literal">span</code> element.</p><p>The application we’ve just written, simply prompts the user for
his/her name and displays “Hello” followed by the user’s name
directly below the prompt. Let’s try it out to see if it works.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_building"></a>Building</h4></div></div></div><p>Run the following command to build the application:</p><pre class="screen">tridashc hello-ui.html : node-name=ui -o hello.html -p type=html -p main-ui=ui</pre><p>That looks complicated, let’s simplify it a bit.</p><p>The <code class="literal">tridashc</code> executable compiles one or more Tridash source files,
generating a single output file. The source files are simply listed,
after the command <code class="literal">tridashc</code>. In this case there is one source file,
<code class="literal">hello-ui.html</code>. The name of the output file is given by the <code class="literal">-o</code> or
<code class="literal">--output-file</code> option, in this case <code class="literal">hello.html</code>.</p><p>The syntax <code class="literal">: &lt;option&gt;=&lt;value&gt;</code> is used to set options which affect
how the last source file, listed before the <code class="literal">:</code>, is
processed. Multiple options can be set by separating the options with
a comma <code class="literal">,</code>. In the command, above, <code class="literal">: node-name=ui</code> sets the
<code class="literal">node-name</code> option to <code class="literal">ui</code> for the source file <code class="literal">hello-ui.html</code>. The
<code class="literal">node-name</code> option sets the identifier of the node, with which, the
contents of the HTML file can be referenced later. In effect, a
special HTML component node <code class="literal">ui</code> is created, which serves to reference
the HTML contents of the file.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">self</code> node, when occurring within an HTML file, references
the HTML component node of the current file.</p></td></tr></table></div><p>The <code class="literal">-p option=value</code> command-line options sets various options
related to the compilation output. The first option <code class="literal">type</code>, sets the
type of output generated. In this case it is set to <code class="literal">html</code> in order to
generate an <code class="literal">html</code> file, with the generated JavaScript code embedded
in it. If the option is omitted, the output is simply a JavaScript
file containing only the raw generated code. The second option
<code class="literal">main-ui</code>, sets the name of the HTML component node, the contents of
which, become the contents of the output HTML file. In this case it is
set to <code class="literal">ui</code> which is the node name, given earlier in the <code class="literal">node-name</code>
option, of the HTML component node containing the contents of the
<code class="literal">hello-ui.html</code> file.</p><p>If all went well a <code class="literal">hello.html</code> file should have been created in the
same directory, after running the command.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_running_the_application"></a>Running The Application</h4></div></div></div><p>Open the <code class="literal">hello.html</code> file in a web-browser with JavaScript
enabled. You should see something similar to the following:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial1/snap1.png" align="middle" alt="Snapshot: Name Prompt" /></div></div><p>Try entering some text in the text field, and press enter afterwards:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial1/snap2.png" align="middle" alt="Snapshot: &quot;John&quot; entered in text field.&quot;Hello John&quot; displayed below the prompt." /></div></div><p>Notice that the text entered appears next to the “Hello” message
underneath the text field. This is due to the binding of the text
field to the <code class="literal">name</code> node and the binding of the <code class="literal">name</code> node to the
contents of the <code class="literal">span</code> element placed adjacent to the “Hello” text.</p><p>Now try changing the text entered in the text field:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial1/snap3.png" align="middle" alt="Snapshot: &quot;John Doe&quot; entered in text field. &quot;Hello John Doe&quot; displayed below the prompt." /></div></div><p>The text next to “Hello” changes to match the contents of the text
field. This demonstrates the automatic updating of a node’s state when
the state of its dependency nodes changes.</p><p>When the state (the contents) of the text field changes, the state of
the <code class="literal">name</code> node is updated to the text entered in the field, and the
state of <code class="literal">span</code> element is updated to match the state of the <code class="literal">name</code>
node.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_inline_node_declarations"></a>1.4. Inline Node Declarations</h3></div></div></div><p>The application in this tutorial can be implemented much more
succinctly using implicit bindings and inline node declarations.</p><p><strong>hello-ui.html. </strong>
</p><pre class="programlisting">&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Hello Node&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Tutorial 1: Hello Node&lt;/h1&gt;
        &lt;label&gt;Enter your name: &lt;input value="&lt;?@ name ?&gt;"/&gt;&lt;/label&gt;
        &lt;p&gt;Hello &lt;?@ name @&gt;&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><p>Implicit bindings between an HTML node and a Tridash node can be
established using the <code class="literal">&lt;?@ declaration ?&gt;</code> tag. This is similar to the
Tridash code tag, seen earlier, however an implicit binding is
established between the nodes appearing in the tag and the HTML node
in which the tag appears.</p><p>If the tag is placed within an attribute of an element, an implicit
two-way binding is established between the element’s attribute and the
node, appearing in the tag. If the tag appears outside an attribute,
an HTML element is created in its place, and a binding is established
between the node appearing in the tag, and the content of the element
(referenced as <code class="literal">textContent</code> from Tridash).</p><p>With inline declarations it is not necessary to give the HTML elements
unique ID’s unless they will be referenced from within Tridash
code. In the example, above, they have been omitted.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_functional_bindings"></a>2. Functional Bindings</h2></div></div></div><p>The bindings in the previous tutorial were pretty boring and
limited. Whatever was entered in the text field was simply displayed
below it, verbatim. In-fact, this functionality is already offered by
many web frameworks and GUI toolkits. The real power of the Tridash
language comes from the ability to specify arbitrary functions in
bindings which are dependent on the values of more than a single
node. Moreover these bindings can be established in Tridash itself
without having to implement "transformer" or "converter"
interfaces/subclasses in a lower-level language.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_simple_budgeting_application"></a>2.1. Simple Budgeting Application</h3></div></div></div><p>In this tutorial, and the following tutorials, we’ll be implementing a
very basic budgeting application with the following desired features:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Allocate amounts to spend on a number of predefined expense
    categories.
</li><li class="listitem">
Compute the total amount allocated.
</li><li class="listitem">
Specify a limit (the budget) on the total amount spent on expenses.
</li><li class="listitem">
Indicate whether the total amount allocated exceeds the limit,
    with some visual cues such as the total amount turning red if it
    exceeds the limit.
</li></ul></div><p>We’ll start with a very basic version and incrementally add features
and improve it.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_first_version"></a>First Version</h4></div></div></div><p>In the first version we’ll focus on the first two features, allocating
an amount of money to different expenses and computing the total
amount allocated.</p><p>Begin with the following <code class="literal">ui.html</code> file:</p><p><strong>ui.html. </strong>
</p><pre class="programlisting">&lt;?
 :import(core)

 food + electricity + water -&gt; total
?&gt;

&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Budget App&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Budget App&lt;/h1&gt;
      &lt;div&gt;
        &lt;label for="food"&gt;Food:&lt;/label&gt;
        &lt;div&gt;&lt;input id="food" value="&lt;?@ to-real(food) ?&gt;" /&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label for="electricity"&gt;Electricity:&lt;/label&gt;
        &lt;div&gt;&lt;input id="electricity" value="&lt;?@ to-real(electricity) ?&gt;" /&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label for="water"&gt;Water:&lt;/label&gt;
        &lt;div&gt;&lt;input id="water" value="&lt;?@ to-real(water) ?&gt;" /&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;hr&gt;
      &lt;div&gt;
        &lt;label for="total"&gt;&lt;strong&gt;Total:&lt;/strong&gt;&lt;/label&gt;
        &lt;div&gt;&lt;input id="total" value="&lt;?@ total ?&gt;" readonly/&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><p>A lot is going on here, lets focus on the body of the HTML file for
now.</p><p>The body defines an interface with three text input fields for
entering the amounts allocated to “Food”, “Electricity” and
“Water” expenses, and a fourth readonly text field for displaying
the total amount allocated. Each field is bound, using implicit
bindings, to the nodes <code class="literal">to-real(food)</code>, <code class="literal">to-real(electricity)</code>,
<code class="literal">to-real(water)</code> and <code class="literal">total</code> respectively.</p><p>The <code class="literal">total</code> node is a simple node, similar to the nodes seen in the
previous tutorial.</p><p>The remaining nodes are examples of <code class="literal">functor</code> nodes. A functor node
consists of an expression comprising an operator applied to zero or
more arguments.</p><pre class="screen">operator(argument1, argument2, ...)</pre><p>A binding is established between each of the arguments and the functor
node. Whenever the value of one of the arguments changes, the
expression is reevaluated and the value of the functor node is
updated.</p><p>In the functor node <code class="literal">to-real(food)</code> the operator is <code class="literal">to-real</code>, which
simply converts its single argument, the node <code class="literal">food</code>, to a real
(floating-point) numeric value. With the <code class="literal">to-real</code> operator a two-way
binding is established between the argument and the functor node. The
result of this is that if another node (not the argument) is bound to
the functor node, <code class="literal">node -&gt; to-real(argument)</code>, its value is converted to
a real value and the value of the argument node is updated to it.</p><p>The value of the input element, in which the amount allocated to food
is entered, is implicitly bound to <code class="literal">to-real(food)</code>. Thus when text is
entered in the input element, the value of the <code class="literal">food</code> node is set to
the value in text field converted to a real value. The same is true
for the electricity and water fields.</p><p>The bulk of the application logic is specified in the Tridash code tag
at the beginning of the file.</p><p>The first line, <code class="literal">:import(core)</code>, is a special declaration which imports
all the nodes from the <code class="literal">core</code> module into the current module, <span class="emphasis"><em>more on
modules later</em></span>. The only nodes we use from the <code class="literal">core</code> module are the
addition <code class="literal">+</code> operator and <code class="literal">to-real</code> operator.</p><p>The line <code class="literal">food + electricity + water -&gt; total</code> is in effect
responsible for computing the total amount allocated and displaying it
in the “Total” field. Lets break it down bit by bit.</p><p>A binding is established between the node <code class="literal">food + electricity + water</code>
and the node <code class="literal">total</code>. The former is a functor node with the <code class="literal">+</code>
operator.</p><p>The <code class="literal">+</code> operator is an infix operator, which means it can be placed
between its two arguments (infix notation), instead of being placed
before its arguments (prefix notation). The spaces between the infix
<code class="literal">+</code> operator and its argument nodes are mandatory as
<code class="literal">food+electricity+water</code> is a valid node identifier and is thus
interpreted as a single node. The infix notation is transformed to the
prefix notation <code class="literal">+(+(food, electricity), water)</code>. Both notations are
equivalent and either one can be written in the source file, provided
the operator is registered as an infix operator (<span class="emphasis"><em>more on this
later</em></span>).</p><p>The <code class="literal">+</code> operator computes, you guessed it, the sum of the values of
its argument nodes. The first argument is the functor node <code class="literal">+(food,
electricity)</code> which computes the sum of the amount allocated to <code class="literal">food</code>
and <code class="literal">electricity</code>, and the second argument is <code class="literal">water</code>, thus the
functor node computes the total sum.</p><p>The total sum is bound to the <code class="literal">total</code> node which, recall, is bound to
the text field displaying the total amount allocated to all
expenses. Thus whenever the total amount allocated changes, the new
total is displayed in the text field next to “Total:”. The total
amount, itself, is updated, whenever the amount in one of the
“Food”, “Electricity” or “Water” text fields is changed by
the user.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_build_configuration_file"></a>Build Configuration File</h4></div></div></div><p>To simplify the build command, the build options will be specified in
a build configuration file.</p><p>The build configuration file contains the list of sources, along with
the source-specific options, and the output options in YAML syntax
<span class="emphasis"><em>(see <a class="ulink" href="https://yaml.org" target="_top">https://yaml.org</a> for details)</em></span>.</p><p>Create the following <code class="literal">build.yaml</code> file:</p><p><strong>build.yml. </strong>
</p><pre class="screen">sources:
  - path: ui.html
    node-name: ui

output:
  path: app.html
  type: html
  main-ui: ui</pre><p>
</p><p>The outer structure of the file is a dictionary with two entries
<code class="literal">sources</code> and <code class="literal">output</code>.</p><p>The <code class="literal">sources</code> entry contains the list of source files. Each item in
the list is either the path to the source file or is a dictionary with
the path in the <code class="literal">path</code> entry and the source-specific options in the
remaining entries. In this application there is one source file
<code class="literal">ui.html</code> with one source processing option <code class="literal">node-name</code> set to <code class="literal">ui</code>.</p><p>The <code class="literal">output</code> entry is a dictionary containing the output options. The
<code class="literal">path</code> entry specifies the <code class="literal">path</code> to the output file, in
this case <code class="literal">app.html</code>. The remainder of the entries are output
options. In this case, the output options are the same as in the
previous tutorial, <code class="literal">type=html</code> and <code class="literal">main-ui=ui</code>.</p><p>To build from a build configuration file run the following command:</p><pre class="screen">tridashc -b build.yml</pre><p>The <code class="literal">-b</code> option specifies the path to the build configuration file
containing the build options. All other command line options are
ignored when this option is specified.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_running_the_application_2"></a>Running the Application</h4></div></div></div><p>Open the <code class="literal">app.html</code> file in a web browser, and enter some
numbers in the text fields:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial2/snap1.png" align="middle" alt="Snapshot: 100, 300, 500 entered in expense fields. 900 displayed in total." /></div></div><p>Notice that the total is computed and displayed in the “Total:”
field.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>You will only see a total computed once you have entered a valid
number in each field.</p></td></tr></table></div><p>Now try changing some of the amounts allocated (<span class="emphasis"><em>remember to press
enter after you’ve changed a value</em></span>):</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial2/snap2.png" align="middle" alt="Snapshot: Electricity changed to 350. New total 950 displayed." /></div></div><p>Notice that the total amount allocated is automatically recomputed and
the new total is displayed in the “Total” field.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_inline_functional_bindings"></a>2.2. Inline Functional Bindings</h3></div></div></div><p>The application built in this tutorial can be implemented more
succinctly by replacing the <code class="literal">total</code> node with <code class="literal">food + electricity +
water</code> in the inline node declaration within the <code class="literal">value</code> attribute of
the total <code class="literal">input</code> element.</p><pre class="programlisting">&lt;label for="total"&gt;&lt;strong&gt;Total:&lt;/strong&gt;&lt;/label&gt;
&lt;div&gt;&lt;input id="total" value="&lt;?@ food + electricity + water ?&gt;" readonly/&gt;&lt;/div&gt;</pre><p>This shows that inline node declarations can contain any valid node
declaration not just a simple node.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_summary"></a>2.3. Summary</h3></div></div></div><p>In this tutorial you learned how to create bindings involving a
function of the values of two or more nodes. Whenever the value of one
of the argument nodes changes, the expression is re-evaluated to
compute the node’s new value.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_conditional_bindings"></a>3. Conditional Bindings</h2></div></div></div><p>In this tutorial we’ll implement the third feature of our simple
budgeting application, namely specifying the budget and displaying a
message, indicating whether the budget was exceeded. In essence this
tutorial demonstrates conditional bindings.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_case_operator"></a>3.1. Case Operator</h3></div></div></div><p>Conditions are specified using the special <code class="literal">case</code> operator. The <code class="literal">case</code>
operator is special in that it has a special syntax to make it more
readable.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">case</code> operator is actually a macro-node, implemented in
Tridash, which expands to a series of nested <code class="literal">if</code> functor
expressions. You can see its source in the <code class="literal">modules/core/macros.trd</code>
file of your Tridash installation.</p></td></tr></table></div><p>The syntax of the case operator is as follows:</p><pre class="screen">case(
  condition-1 : value-1,
  condition-2 : value-2,
  ....
  default-value
)</pre><p>Each argument is of the form <code class="literal">condition : value</code> where <code class="literal">condition</code> is
the condition node and <code class="literal">value</code> is the corresponding value node. The
last argument may also be of the form <code class="literal">value</code>, that is there is no
condition node, in which case it becomes the default or else value.</p><p>The <code class="literal">case</code> functor node evaluates to the value of the value node
corresponding to the first condition node which has a <span class="emphasis"><em>true</em></span> value
(any non-zero value), or the value of the default node, if any, when
all condition nodes have a <span class="emphasis"><em>false</em></span> (zero) value.</p><p><strong>Example. </strong>
</p><pre class="screen">case(
  a &gt; b : a - b
  b &gt; a : b - a
  0
)</pre><p>
</p><p>If the node <code class="literal">a &gt; b</code> evaluates to true, the <code class="literal">case</code> node evaluates to
the value of <code class="literal">a - b</code>, otherwise if <code class="literal">b &gt; a</code> evaluates to true, the
<code class="literal">case</code> node evaluates to the value of <code class="literal">b - a</code>. If neither <code class="literal">a &gt; b</code> nor
<code class="literal">b &gt; a</code> evaluate to true, the <code class="literal">case</code> node evaluates to <code class="literal">0</code>.</p><p>If the default value node is omitted and no condition node evaluates
to <span class="emphasis"><em>true</em></span>, the <code class="literal">case</code> node evaluates to a failure value (<span class="emphasis"><em>you will
learn about failure values in a later tutorial which introduces error
handling</em></span>).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_budget_application_version_2_0"></a>3.2. Budget Application Version 2.0</h3></div></div></div><p>The feature we would like to implement is the ability to specify the
budget and display an appropriate message indicating whether the
budget was exceeded.</p><p>We’ll need a new input field for specifying the budget and a node in
which to store it, lets call it <code class="literal">budget</code>. Add a new text input element
with its value attribute bound to <code class="literal">to-real(budget)</code>, in order to
convert the string in the text input field to a real numeric
value. The input element should be something similar to the following,
if inline declarations are used:</p><pre class="programlisting">&lt;input id="total" value="&lt;?@ to-real(budget) @&gt;"/&gt;</pre><p>Next we’ll need to display the status message somewhere. Let’s place
it next to the total <code class="literal">input</code> element. We’ll use inline declarations to
make the code more succinct, however the logic can be placed in a
Tridash code tag as well.</p><p>Add the following next to the <code class="literal">input</code> element in which the total is
displayed:</p><pre class="programlisting">&lt;span&gt;
  &lt;?@
    case(
      total &lt; budget : "Within budget.",
      "Budget exceeded!!!"
    )
  @&gt;
&lt;/span&gt;</pre><p>To simplify the code the node <code class="literal">total</code> is bound to the total sum
allocated. Alternatively the functor node <code class="literal">food + electricity + water</code>
could have been used directly instead of the node <code class="literal">total</code>.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>There is no difference in efficiency between using the <code class="literal">total</code>
node or using the functor node directly. The value of a node is only
computed once, whenever one of its arguments changes, even if it is
referenced in more than one location. Moreover the value of a node is
not computed if it is not used anywhere.</p></td></tr></table></div><p>Ensure that there is a Tridash code tag at the top of the file with
the following contents:</p><pre class="screen">:import(core)

food + electricity + water -&gt; total</pre><p>And modify the input element next to “Total:”, to be bound to the
node <code class="literal">total</code> instead of <code class="literal">food + electricity + water</code>.</p><pre class="programlisting">&lt;input value="&lt;?@ total @&gt;"/&gt;</pre><p>Now we have a working application which should display the message
“Within budget.”, if the total is within the budget, and “Budget
exceeded!!!”, if the budget has been exceeded.</p><p>Full <code class="literal">ui.html</code> source code:</p><p><strong>ui.html. </strong>
</p><pre class="programlisting">&lt;?
 :import(core)

 food + electricity + water -&gt; total
?&gt;

&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Budget App&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Budget App&lt;/h1&gt;
      &lt;div&gt;
        &lt;label for="budget"&gt;&lt;strong&gt;Budget:&lt;/strong&gt;&lt;/label&gt;
        &lt;div&gt;&lt;input id="budget" value="&lt;?@ to-real(budget) ?&gt;"/&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;hr&gt;
      &lt;div&gt;
        &lt;label for="food"&gt;Food:&lt;/label&gt;
        &lt;div&gt;&lt;input id="food" value="&lt;?@ to-real(food) ?&gt;" /&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label for="electricity"&gt;Electricity:&lt;/label&gt;
        &lt;div&gt;&lt;input id="electricity" value="&lt;?@ to-real(electricity) ?&gt;" /&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label for="water"&gt;Water:&lt;/label&gt;
        &lt;div&gt;&lt;input id="water" value="&lt;?@ to-real(water) ?&gt;" /&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;hr&gt;
      &lt;div&gt;
        &lt;label for="total"&gt;&lt;strong&gt;Total:&lt;/strong&gt;&lt;/label&gt;
        &lt;div&gt;
          &lt;input id="total" value="&lt;?@ total ?&gt;" readonly/&gt;
          &lt;span&gt;
            &lt;?@
             case(
                 total &lt; budget : "Within budget.",
                 "Budget exceeded!!!"
             )
             ?&gt;
          &lt;/span&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_let_8217_s_try_it_out"></a>Let’s try it out</h4></div></div></div><p>Build the application, using the same build configuration file,
<code class="literal">build.yml</code>, and build command from the previous tutorial.</p><p>Open the <code class="literal">app.html</code> file in a web browser, and enter some initial
numbers in the budget and expenses fields:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial3/snap1.png" align="middle" alt="Snapshot: 100 entered in budget and all expense fields. Total 300, Budget Exceeded!!! displayed." /></div></div><p>Notice that the status message, next to the total, says “Budget
Exceeded!!!”  since the total of 300 did indeed exceed the budget of
100, with the numbers in the snapshot above.</p><p>Now try increasing the budget:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial3/snap2.png" align="middle" alt="Snapshot: Budget increased to 400. Within Budget displayed." /></div></div><p>The message changes to “Within Budget.”. This demonstrates that the
value of a <code class="literal">case</code> functor node is recomputed if the values of any of
the condition nodes change.</p><p>Now try increasing some of the expenses, in order for the total to
exceed the budget again:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial3/snap3.png" align="middle" alt="Snapshot: Expense total increased to 500. Budget Exceeded displayed." /></div></div><p>The message changes back to “Budget Exceeded!!!”.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_improvements"></a>3.3. Improvements</h3></div></div></div><p>Whilst the application we’ve implemented so far demonstrates the power
of functional bindings, it is rather lacking in that whether the
budget has been exceeded or not is only indicated by text. The text
has to be read in full to determine whether the budget was exceeded,
and changes from <span class="emphasis"><em>within budget</em></span> to <span class="emphasis"><em>budget exceeded</em></span>, and vice versa,
are hard to notice. Some visual indications, such as the background of
the total changing color, when the budget is exceeded, would be
helpful.</p><p>As an improvement of the application, we would like the background
color of the element, which displays the total, and the text color of
the status message to change to <span class="red">red</span> if the total exceeds the
budget, and change to <span class="green">green</span> if it is within the budget.</p><p>Let’s start off by giving an id to the <code class="literal">input</code> element, which displays
the total, and the <code class="literal">span</code> element, which displays the status message,
so that they can be referenced from Tridash code. The <code class="literal">input</code> element,
next to “Total:”, is given the id <code class="literal">total</code> and the <code class="literal">span</code>
element, in which the status message is displayed, is given the id
<code class="literal">status</code>.</p><p>Let’s create a node <code class="literal">color</code> to store the background color of the total
and text color of the status message. It should have the value
<code class="literal">"green"</code> when the total is within the budget and the value <code class="literal">"red"</code>
when the total exceeds the budget. This can be achieved by binding to
a <code class="literal">case</code> functor node.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The values <code class="literal">"green"</code> and <code class="literal">"red"</code> are strings, storing CSS color
names.</p></td></tr></table></div><p>Add the following to the Tridash code tag.</p><pre class="screen">case(
  total &lt; budget : "green",
  "red"
) -&gt; color</pre><p>The value of the <code class="literal">case</code> functor node is <code class="literal">"green"</code> if <code class="literal">total</code> is less
than <code class="literal">budget</code> and <code class="literal">"red"</code> otherwise. The case functor node is bound to
the <code class="literal">color</code> node.</p><p>The <code class="literal">color</code> node somehow has to be bound to the background color of
the <code class="literal">total</code> <code class="literal">input</code> element and the text color of the <code class="literal">status</code> <code class="literal">span</code>
element. The text and background colors are style attributes of the
elements. All style attributes are grouped under a single subnode
<code class="literal">style</code> of the HTML element node (as is done when referencing style
attributes from JavaScript). The background color is controlled by the
<code class="literal">backgroundColor</code> attribute, referenced using <code class="literal">style.backgroundColor</code>
and the text color is controlled by the <code class="literal">color</code> style attribute,
referenced using <code class="literal">style.color</code>.</p><p>The <code class="literal">color</code> node is bound to the style attributes of the elements with
the following (add to the Tridash code tag):</p><pre class="screen">color -&gt; self.total.style.backgroundColor
color -&gt; self.status.style.color</pre><p>Additionally we would like the text, in the <code class="literal">total</code> element, to be
displayed in white in order to be legible. We can achieve this using
inline CSS or CSS classes, however we can also bind the text color of
the element to the constant <code class="literal">"white"</code>. This is useful if later on, we
would like the text color to change dynamically as well.</p><p>Full <code class="literal">ui.html</code> code:</p><p><strong>ui.html. </strong>
</p><pre class="programlisting">&lt;?
 :import(core)

 food + electricity + water -&gt; total

 case(
     total &lt; budget : "green",
     "red"
 ) -&gt; color

 color -&gt; self.total.style.backgroundColor
 color -&gt; self.status.style.color

 "white" -&gt; self.total.style.color
?&gt;

&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Budget App&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
      &lt;h1&gt;Budget App&lt;/h1&gt;
      &lt;div&gt;
        &lt;label for="budget"&gt;&lt;strong&gt;Budget:&lt;/strong&gt;&lt;/label&gt;
        &lt;div&gt;&lt;input id="budget" value="&lt;?@ to-real(budget) ?&gt;"/&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;hr&gt;
      &lt;div&gt;
        &lt;label for="food"&gt;Food:&lt;/label&gt;
        &lt;div&gt;&lt;input id="food" value="&lt;?@ to-real(food) ?&gt;" /&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label for="electricity"&gt;Electricity:&lt;/label&gt;
        &lt;div&gt;&lt;input id="electricity" value="&lt;?@ to-real(electricity) ?&gt;" /&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label for="water"&gt;Water:&lt;/label&gt;
        &lt;div&gt;&lt;input id="water" value="&lt;?@ to-real(water) ?&gt;" /&gt;&lt;/div&gt;
      &lt;/div&gt;
      &lt;hr&gt;
      &lt;div&gt;
        &lt;label for="total"&gt;&lt;strong&gt;Total:&lt;/strong&gt;&lt;/label&gt;
        &lt;div&gt;
          &lt;input id="total" value="&lt;?@ total ?&gt;" readonly/&gt;
          &lt;span id="status"&gt;
            &lt;?@
             case(
                 total &lt; budget : "Within budget.",
                 "Budget exceeded!!!"
             )
             ?&gt;
          &lt;/span&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre><p>
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_let_8217_s_try_it_out_2"></a>Let’s try it out</h4></div></div></div><p>Enter some values for the expenses and budget such that the total
exceeds the budget.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial3/snap4.png" align="middle" alt="Snapshot: 100 entered in budget and expense fields. Total and Budget Exceeded!!! displayed in red." /></div></div><p>The status message and total are now shown in red which provides an
immediate visual indication that the budget has been exceeded.</p><p>Now increase the budget, or decrease the expenses:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial3/snap5.png" align="middle" alt="Snapshot: Budget increased to 400. Total and Within Budget displayed in green." /></div></div><p>The color of the message and total is immediately changed to green,
which provides a noticeable indication that the budget has no longer
been exceeded.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_summary_2"></a>3.4. Summary</h3></div></div></div><p>In this tutorial you learned how to create conditional bindings using
the <code class="literal">case</code> operator which allows the value of a node to be
conditionally bound to the value of another node based on whether a
condition node evaluates to true.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="tutorial4"></a>4. Writing your own Functions</h2></div></div></div><p>In this tutorial you’ll learn how to create your own functions, which
can be used in functional bindings. Another feature which distinguishes
Tridash from frameworks/toolkits, which offer bindings, is that new
functions can be written in the same language, as the language in
which the bindings are declared, rather than having to be implemented
in a lower-level language.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_definition_operator"></a>4.1. Definition Operator</h3></div></div></div><p>New functions, referred to as meta-nodes, are defined using the
special <code class="literal">:</code> operator, which has the following syntax:</p><pre class="screen">function(arg1, arg2, ...) : {
   declarations...
}</pre><p>The left-hand side contains the function name (<code class="literal">function</code>) followed by
the argument list in brackets, where each item (<code class="literal">arg1</code>, <code class="literal">arg2</code>, …)
is the name of the local node to which the argument at that position
is bound.</p><p>The right-hand side, of the <code class="literal">:</code> operator, contains the declarations
making up the body of the function, which may consist of any Tridash
node declaration.</p><p>Nodes created within the body of a meta-node are local to the
meta-node, meaning they can only be referenced from within it even if
the same node identifier occurs in an expression in the global
scope. Local nodes are created for each of the arguments, and for
nodes which appear as the target of a binding. Node expressions which
appear in source position primarily reference local nodes, however if
no local node is found, the enclosing scope of the meta-node is
searched. This differs from global node expressions, in which nodes
are automatically created if no node with that identifier exists.</p><p>Meta-nodes return the value of the last node in the <code class="literal">declarations</code>
list comprising the body. The curly braces <code class="literal">{</code> and <code class="literal">}</code> are optional if
the meta-node body consists of a single declaration.</p><p>Alternatively an explicit binding to the <code class="literal">self</code> node, can be
established. In that case, the return value of the meta-node, is the
value of the <code class="literal">self</code> node, rather than the last node in the body.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_examples"></a>Examples</h4></div></div></div><pre class="screen"># Add two numbers <a id="CO1-1"></a><span><img src="tutorials/images/icons/callouts/1.png" alt="1" border="0" /></span>

add(x, y) : x + y</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-1"><span><img src="tutorials/images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
This is a comment. Comments begin with a <code class="literal">#</code> character and extend
till the end of the line. All content within a comment is discarded.
</p></td></tr></table></div><p>In the example, above, a meta-node <code class="literal">add</code> is defined which takes two
arguments, bound to the local nodes <code class="literal">x</code> and <code class="literal">y</code>. The function body
consists of a single node declaration, hence the curly braces were
omitted, <code class="literal">x + y</code> which is a functor node that computes the sum of <code class="literal">x</code>
and <code class="literal">y</code>. The meta-node returns the value of <code class="literal">x + y</code> since it is the
last node in the body.</p><p>The following example demonstrates recursive meta-nodes:</p><pre class="screen"># Computes the factorial of n

factorial(n) : {
  case(
    n &gt; 1 : n * factorial(n - 1),
    1
  )
}</pre><p>The following example demonstrates that meta-nodes may themselves
contain nested meta-nodes, which are local to the meta-node and can
only be referenced within it.</p><pre class="screen"># Tail recursive factorial

factorial(n) : {
  iter(n, acc) : {
    case(
      n &gt; 1 : iter(n - 1, n * acc),
      acc
    )
  }

  iter(n, 1)
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_budget_meter"></a>4.2. Budget Meter</h3></div></div></div><p>Our current application displays some nice visual indications, in the
form of color, which allow us to see, at a glance, whether the budget
has been exceeded. However the visual indications are still quite
limited, giving only a binary indication of whether the budget was
exceeded or not. It would be nice if there is also a visual indication
of how close the total is to the budget.</p><p>In this tutorial we’ll enhance the budget application by displaying a
meter, which directly indicates how close the total is to the
budget. Additionally we’d also like the meter to be displayed in a
color that is between green and red proportional to how much the total
is between zero and the budget.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_color_interpolation"></a>Color Interpolation</h4></div></div></div><p>Let’s first begin with computing the color of the meter. Our goal is
to linearly interpolate a color between green and red depending on
where the total amount allocated lies between zero and the
budget. This is where meta-nodes will come in handy.</p><p>We’ll start off by writing a linear interpolation meta-node <code class="literal">lerp</code>.</p><pre class="screen">lerp(a, b, alpha) : lo + alpha * (b - a)</pre><p>The value returned by the meta-node is the fractional value, at the
fraction <code class="literal">alpha</code>, between <code class="literal">a</code> and <code class="literal">b</code>.</p><p>Let’s write another handy meta-node for creating a CSS <code class="literal">hsl</code> color
string out of hue, saturation and luminance components.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Interpolation is done in the HSL color space, rather than the RGB
color space as it provides better results.</p></td></tr></table></div><pre class="screen">make-hsl(h, s, l) :
    format("hsl(%s,%s%%,%s%%)", h, s, l)</pre><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">format</code> meta-node takes a format string, followed by a
variable number of arguments, and returns the format string with all
<code class="literal">%s</code> placeholders replaced by the arguments. <code class="literal">%%</code> is replaced with a
literal <code class="literal">%</code> character.</p></td></tr></table></div><p>The next step is to compute the interpolation coefficient <code class="literal">alpha</code>
based on where the total sum lies between zero and the budget.</p><p>To make sure that the interpolation coefficient is between 0 and 1,
we’ll write a <code class="literal">clamp</code> meta-node, for clamping a value to a given
range:</p><pre class="screen">clamp(x, min, max) :
   case (
      x &lt; min : min,
      x &gt; max : max,
      x
   )</pre><p>Using the <code class="literal">clamp</code> meta-node, we compute the <code class="literal">alpha</code> coefficient
clamped to the range [0, 1]:</p><pre class="screen">clamp((total + 1) / (budget + 1), 0, 1) -&gt; scale</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="literal">1</code> was added to the total and budget to prevent division by
zero in the case that <code class="literal">budget</code> is equal to <code class="literal">0</code>. This obviously does
not work if <code class="literal">budget</code> is equal to <code class="literal">-1</code> however this will be handled in
the following tutorials.</p></td></tr></table></div><p>And now finally we’ll compute the color making use of the <code class="literal">lerp</code>
meta-node we implemented earlier:</p><pre class="screen">make-hsl(
   lerp(120, 0, scale),
   90,
   45
) -&gt; meter-color</pre><p>The hue is linearly interpolated between <span class="green">green</span> <code class="literal">120</code> and
<span class="red">red</span> <code class="literal">0</code>, depending on where the total lies between <code class="literal">0</code> and the
<code class="literal">budget</code>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_creating_the_meter"></a>Creating the Meter</h4></div></div></div><p>Now we’ll actually create the meter. We need two block elements, one
which displays a border containing the meter and another element which
displays the portion of the meter that is filled.</p><p>Add the following HTML elements below the “Total” field.</p><pre class="programlisting">&lt;div class="meter-box"&gt;
  &lt;div id="meter" class="meter-bar"&gt;&lt;/div&gt;
&lt;/div&gt;</pre><p>Add the following <code class="literal">style</code> tag, which contains the style attributes of
the <code class="literal">meter-box</code> and <code class="literal">meter-bar</code> classes, within the <code class="literal">&lt;head&gt;...&lt;/head&gt;</code>
tag:</p><pre class="programlisting">&lt;style&gt;
 .meter-box {
     margin-top: 5px;
     width: 200px;
     height: 1em;
     border: 1px solid black;
  }
 .meter-bar {
     height: 100%;
 }
&lt;/style&gt;</pre><p>The <code class="literal">meter-box</code> class, applied to the block element which serve as the
container, gives the element a width, height and a border. The
<code class="literal">meter-bar</code> class, applied to the element which displays the filled
portion, specifies that the filled portion should take up <code class="literal">100%</code> of
the vertical space within the container.</p><p>The meter should be filled proportionally to how close the value of
<code class="literal">total</code> is to the value of <code class="literal">budget</code>. The proportion is already given
by the value of the <code class="literal">scale</code> node. To implement the <span class="emphasis"><em>filling</em></span> of the
meter, we simply need to bind the <code class="literal">scale</code> node to the <code class="literal">width</code> style
attribute of the <code class="literal">meter</code> element.</p><p>This is achieved with the following:</p><pre class="screen">format("%s%%", scale * 100) -&gt; self.meter.style.width</pre><p>The <code class="literal">scale</code> is multiplied by <code class="literal">100</code> to convert it to a percentage, and
<code class="literal">format</code> is used to convert the numeric value to a string with a <code class="literal">%</code>
appended to it. This specifies that the width of the meter should be a
percentage, given by <code class="literal">scale</code>, of the width of its parent container.</p><p>Finally we need to bind <code class="literal">meter-color</code>, which stores the interpolated
color, to the background color of the meter.</p><pre class="screen">meter-color -&gt; self.meter.style.backgroundColor</pre><p>This is the full code that needs to be added to the Tridash code tag,
to implement the meter:</p><pre class="screen">lerp(a, b, alpha) : a + alpha * (b - a)

clamp(x, min, max) :
    case (
        x &lt; min : min,
        x &gt; max : max,
        x
    )

make-hsl(h, s, l) :
    format("hsl(%s,%s%%,%s%%)", h, s, l)

clamp((total + 1) / (budget + 1), 0, 1) -&gt; scale

make-hsl(
    lerp(120, 0, scale),
    90,
    45
) -&gt; meter-color

format("%s%%", scale * 100) -&gt; self.meter.style.width
meter-color -&gt; self.meter.style.backgroundColor</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_let_8217_s_try_it_out_3"></a>Let’s try it out</h4></div></div></div><p>Build the application and open the resulting <code class="literal">app.html</code> file in a web
browser.</p><p>Enter some initial values for the budget and expense totals. Start off
with low expense totals such that the total expenses are well within
the budget:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial4/snap1.png" align="middle" alt="Snapshot: Budget 100, Total 30. Meter 1/3 filled, displayed in bright green." /></div></div><p>The filled portion is roughly a third of the meter and is displayed in
a bright green.</p><p>Now start increasing the expenses to bring the total closer to the
budget:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial4/snap2.png" align="middle" alt="Snapshot: Total 50. Meter half filled, displayed in yellow." /></div></div><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial4/snap3.png" align="middle" alt="Snapshot: Total 70. Meter more than half filled, displayed in orange." /></div></div><p>The meter gradually fills up and starts changing to red the closer the
total expenses are to the budget.</p><p>Now finally increase the expenses till the total exceeds the budget:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial4/snap4.png" align="middle" alt="Snapshot: Total, 120. Meter filled, displayed in bright red." /></div></div><p>The mete is fully filled and displayed in a bright red color.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_summary_3"></a>4.3. Summary</h3></div></div></div><p>In this tutorial you learned how to create your own functions,
referred to as meta-nodes, which can be used in functor node
expressions.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Functions are referred to as meta-nodes since they are nodes,
themselves, which describe how the values of other nodes, referred to
as meta-node instances, are computed, hence the term meta-nodes.</p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_error_handling"></a>5. Error Handling</h2></div></div></div><p>In all the tutorials, till this point, we’ve completely ignored the
issue of invalid data being entered in the text fields, such as
non-numeric data and negative numeric values.</p><p>Let’s try entering some non-numeric data in our existing application
and see what happens.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial5/error1.png" align="middle" alt="foo entered in food, 10 entered in water and electricity. No total or message printed." /></div></div><p>If an invalid value is initially entered in one of the “food”,
 “electricity”, or “water” fields, no total is computed, the meter
 is filled, and no status message is displayed.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial5/error2.png" align="middle" alt="Water changed from 10 to foo, 20 and 10 entered in food and electricity. Total, color and message unchanged." /></div></div><p>If the value of one of the fields is changed from a valid to an
invalid numeric value, such as “Electricity” in the snapshot above,
the total is not recomputed, with the old total being displayed in the
text field. Likewise the meter and status message are unchanged, even
if the values of the “Budget” or other fields are changed. The new
total is only computed when the invalid numeric value is replaced with
a valid numeric value.</p><p>Now let’s try entering a non-numeric value for the budget, however
keeping the values of the other fields valid:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial5/error3.png" align="middle" alt="Budget changed from 100 to foo. Food changed from 10 to 90, water and electricity set to 10. New total (110) computed, color and message unchanged." /></div></div><p>Changing the budget to a non-numeric value does not result in the
total, color or message being changed. However changing the values of
the expense fields does result in the new total being computed and
displayed. The meter and status message, however, remain unchanged.</p><p>Whilst the application is still functioning when non-numeric values
are entered in the text fields, and can quickly resume its normal
operation when the invalid values are replaced with valid numeric
values, there is no indication to the user that an invalid value has
been entered. This can be misleading, as in the last snapshot, no
matter how large of the total is entered, “Within Budget” is always
displayed.</p><p>Negative values are treated as ordinary numeric values. Obviously
these don’t make sense in our application, thus an error message
should be displayed as well if a negative value is entered.</p><p>The following functionality has to be implemented:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Check whether data entered in the text fields is actually
      numeric data. If not print an appropriate error message.
</li><li class="listitem">
Validate the numeric data, checking that the numbers entered are
      positive.
</li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_failures"></a>5.1. Failures</h3></div></div></div><p>A failure is a special type of value which indicates the absence of a
value, or the failure to compute a value. If a meta-node expects one
of its argument nodes to evaluate to a value, but it evaluates to a
failure, the failure is returned immediately.</p><p>The <code class="literal">to-real</code> meta-node returns a failure if its argument cannot be
converted to a real number. In this case, each of the instance nodes
<code class="literal">to-real(budget)</code>, <code class="literal">to-real(food)</code>, <code class="literal">to-real(electricity)</code> and
<code class="literal">to-real(water)</code>, evaluate to failures if the argument is a string,
from which a real-number cannot be parsed.</p><p>The <code class="literal">+</code>, <code class="literal">-</code>, <code class="literal">*</code>, <code class="literal">&lt;</code>, and <code class="literal">&gt;</code> meta-nodes return failures if any of
their arguments evaluate to failures. As a result if at least one of
<code class="literal">food</code>, <code class="literal">electricity</code> or <code class="literal">water</code> evaluate to failures the node <code class="literal">food +
electricity + water</code>, and likewise the node <code class="literal">total</code>, evaluates to a
failure.</p><p>When an HTML attribute is bound to a node, which evaluates to a
failure, the value of the attribute is simply left as is. Thus, if the
node <code class="literal">total</code> evaluates to a failure, due to an invalid value being
entered for <span class="emphasis"><em>Food</em></span>, <span class="emphasis"><em>Electricity</em></span> or <span class="emphasis"><em>Water</em></span>, the <code class="literal">value</code> attribute of
the <span class="emphasis"><em>Total</em></span> input field is not changed.</p><p>Similarly, if the <code class="literal">budget</code> node evaluates to a failure, due to an
invalid value for <span class="emphasis"><em>Budget</em></span> being entered, the <code class="literal">color</code> node, <code class="literal">scale</code>
node and the node storing the status message evaluate to failures. As
a result the status message and meter is not updated.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_handling_failures"></a>5.2. Handling Failures</h3></div></div></div><p>Failures can be handled using explicit contexts. A node context is the
information about how a node’s value is computed, and which of the
dependency nodes' values are required. Each binding to a node, whether
explicit or implicit creates a context.</p><p>The context to which a binding is established, can be set explicitly
using the <code class="literal">@</code> macro <a href="#ftn.idm122299989760" class="footnote" id="idm122299989760"><sup class="footnote">[1]</sup></a>, from the <code class="literal">core</code>
module.</p><p><strong><code class="literal">@</code> Macro Syntax. </strong>
</p><pre class="screen">node @ context-id</pre><p>
</p><p><code class="literal">node</code> is the node expression and <code class="literal">context-id</code> is the identifier of
the explicit context, which can be any identifier. When this
expression appears as the target of a binding, the binding is
established in that context. When it appears as the source of a
binding, it has no effect.</p><p>Multiple bindings can be established in the same explicit context. The
value of the node is bound to the value of the source node of the
first binding that is declared in the source code. However, if the
source node evaluates to a failure, the value of the node is set to
the value of the source node of the second binding. If the source node
of the second binding evaluates to a failure, the node value is set to
the value of source node of the third binding and so on. If the source
nodes of all the context’s bindings evaluate to failures, the node
evaluates to the failure value of the last binding’s source node.</p><p><strong>Example. </strong>
</p><pre class="screen">a -&gt; x @ ctx
b -&gt; x @ ctx
c -&gt; x @ ctx</pre><p>
</p><p>In the example, above, <code class="literal">x</code> primarily evaluates to the value of
<code class="literal">a</code>. However, if <code class="literal">a</code> evaluates to a failure, <code class="literal">x</code> evaluates to the
value of <code class="literal">b</code>. If <code class="literal">b</code> evaluates to a failure, <code class="literal">x</code> evaluates to the
value of <code class="literal">c</code>.</p><p>Using explicit contexts we can write a meta-node which returns true if
its argument node evaluates to a failure, otherwise returns false.</p><p><strong>Meta-Node: <code class="literal">fails?</code> </strong>
</p><pre class="screen">fails?(x) : {
    x and 0 -&gt; self @ catch-failure
    1 -&gt; self @ catch-failure
}</pre><p>
</p><p>The first declaration, in the function’s body, establishes the primary
binding to the <code class="literal">self</code> node, if you recall from the previous
tutorial it’s value is returned by the meta-node when an
explicit binding to it is established. The primary binding ensures
that the value of the <code class="literal">self</code> node is <span class="emphasis"><em>false</em></span> (<code class="literal">0</code>) if <code class="literal">x</code> does not
evaluate to a failure.</p><p>The second declaration binds the <code class="literal">self</code> node to <span class="emphasis"><em>true</em></span> (<code class="literal">1</code>) if the
previous binding evaluates to a failure. As a result, the <code class="literal">fails?</code>
meta-node returns <span class="emphasis"><em>false</em></span> when <code class="literal">x</code> does not evaluate to a failure and
<span class="emphasis"><em>true</em></span> when <code class="literal">x</code> evaluates to a failure.</p><p>It turns out we don’t need to write our own <code class="literal">fails?</code> meta-node, as the
<code class="literal">core</code> module already provides a <code class="literal">fails?</code> meta-node which performs the
same function. However, the implementation provided in this section
serves as an introduction to <span class="emphasis"><em>failure</em></span> values and <span class="emphasis"><em>explicit contexts</em></span>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_error_feedback"></a>5.3. Error Feedback</h3></div></div></div><p>The first improvement to we’d like to make, is to display an error
message indicating when a non-numeric value is entered in the budget
or expense text fields.</p><p>The first step is to detect failures in the nodes storing the budget
and expense categories. For that, we’ll write a utility meta-node,
<code class="literal">error-prompt</code> which returns an error message if its argument node evaluates
to a failure.</p><p><strong>Meta-Node <code class="literal">error-prompt</code>. </strong>
</p><pre class="screen">error?(thing) : {
    error-message &lt;- "Please enter a valid number"
    if (fails?(thing), error-message, "")
}</pre><p>
</p><p>The first declaration simply creates a local <code class="literal">error-message</code> node and
binds it to the error message string. The expression in the last line
of the body, which serves as the return value of the meta-node,
evaluates to the error message (value of the <code class="literal">error-message</code> node) if
the argument <code class="literal">thing</code> evaluates to a failure, determined using the
<code class="literal">fails?</code> meta-node from the <code class="literal">core</code> module. Otherwise the expression
evaluates to the empty string.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip: Meta-Node if"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left">Meta-Node <code class="literal">if</code></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">if</code> meta-node from the <code class="literal">core</code> module returns:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
its second argument if its first argument is true.
</li><li class="listitem">
its third argument if the first argument is false.
</li></ul></div></td></tr></table></div><p>We’d like to display the error messages next to each text field, which
has an invalid value, thus we’ll change the body of the HTML file to
the following:</p><pre class="programlisting">&lt;label for="budget"&gt;&lt;strong&gt;Budget:&lt;/strong&gt;&lt;/label&gt;
&lt;div&gt;
  &lt;input id="budget" value="&lt;?@ to-real(budget) ?&gt;"/&gt;
  &lt;?@ error-prompt(budget) ?&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;hr&gt;
&lt;div&gt;
  &lt;label for="food"&gt;Food:&lt;/label&gt;
  &lt;div&gt;
    &lt;input id="food" value="&lt;?@ to-real(food) ?&gt;" /&gt;
    &lt;?@ error-prompt(food) ?&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div&gt;
  &lt;label for="electricity"&gt;Electricity:&lt;/label&gt;
  &lt;div&gt;
    &lt;input id="electricity" value="&lt;?@ to-real(electricity) ?&gt;" /&gt;
    &lt;?@ error-prompt(electricity) ?&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div&gt;
  &lt;label for="water"&gt;Water:&lt;/label&gt;
  &lt;div&gt;
    &lt;input id="water" value="&lt;?@ to-real(water) ?&gt;" /&gt;
    &lt;?@ error-prompt(water) ?&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre><p>We’ve added an <code class="literal">error-prompt</code> meta-node instance next to each text
input field. Each instance evaluates to the error message if the node,
bound to the field’s value, evaluates to a failure. Recall, the nodes
bound to the value attributes evaluate to failures if the <code class="literal">to-real</code>
meta-node fails to parse a real number from the string value.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_let_8217_s_try_it_out_4"></a>Let’s try it out</h4></div></div></div><p>Build and run the application. Enter some non-numeric value in some of
the text input fields.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial5/snap1.png" align="middle" alt="Snapshot: Error message displayed next to food and electricity fields, with invalid numeric values." /></div></div><p>Notice the error messages displayed next to the input fields with
non-numeric values.</p><p>Now try changing the input fields back to numeric values.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial5/snap2.png" align="middle" alt="Snapshot: All fields changed to valid numbers. Total recomputed." /></div></div><p>The error messages disappear and the application resumes its normal
operation, computing the new total and adjusting the meter.</p><p>This fixes the first issue with our application. As an exercise you
can try to make the text color of the input fields change to "red" if
non-numeric values are entered in them.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_initial_values"></a>5.4. Initial Values</h3></div></div></div><p>The issue with no feedback being displayed, in case of non-numeric
values being entered in the text input fields, is fixed, however until
a value is entered in each field, no total or status message is
displayed. The nodes <code class="literal">budget</code>, <code class="literal">food</code>, <code class="literal">electricity</code> and <code class="literal">water</code> have
not been given initial values. When a node is not given an initial
value, its initial value is a failure. This results in the node
<code class="literal">total</code> evaluating to a failure.</p><p>A node may be given an initial value, which is set as soon as the
application is launched. The setting of the initial value is treated
as an ordinary value change from the node’s previous value, which is a
<span class="emphasis"><em>failure</em></span> value. Binding a node to a constant value, without an
explicit context, is interpreted as setting its initial value.</p><pre class="screen">0 -&gt; x</pre><p>In the example, above, node <code class="literal">x</code> is given the initial value <code class="literal">0</code>. Nodes
can also be given initial values which involve more complex
expressions and even reference other nodes, provided they are constant
nodes. Constant nodes are nodes with a constant value, that does not
change throughout the execution of the application. In-effect constant
nodes only have an initial value and do not depend on the values of
other non-constant nodes.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">error-message</code> node, seen earlier in <a class="xref" href="#_error_feedback" title="5.3. Error Feedback">Section 5.3, “Error Feedback”</a>,
is an example of a constant node.</p></td></tr></table></div><p>Let’s give each of the <code class="literal">budget</code>, <code class="literal">food</code>, <code class="literal">electricity</code> and
<code class="literal">water</code> nodes an initial value of <code class="literal">0</code>.</p><p>Add the following to the Tridash code tag in the <code class="literal">ui.html</code> file:</p><pre class="screen">0 -&gt; budget
0 -&gt; food
0 -&gt; electricity
0 -&gt; water</pre><p>When running the application all text fields will be initialized to
the value <code class="literal">0</code>.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial5/snap3.png" align="middle" alt="Initial State Snapshot: All fields initialized to 0. Total (0) and Budget Exceeded displayed in red" /></div></div><p>Since we gave initial values to all the nodes, and there is an
implicit two-way binding between these nodes and the contents of the
text fields, the contents of the text input fields are immediately
initialized to <code class="literal">0</code>. This demonstrates that the setting of the initial
node values is treated the same as any other node value change.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_summary_4"></a>5.5. Summary</h3></div></div></div><p>In this tutorial you were introduced to <span class="emphasis"><em>failure</em></span> values and how to
handle failures with explicit contexts. Additionally you also learned
how to give nodes initial values.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_failures_of_your_own"></a>6. Failures of your own</h2></div></div></div><p>You’ve been introduced to failure values in the previous tutorial and
how to handle them using explicit contexts. In this tutorial you’ll
learn how to create your own failure values, which will be used to fix
the second issue with our budgeting application, namely ensuring that
only positive numeric values are entered in the budget and expense
text input fields.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_conditional_bindings_2"></a>6.1. Conditional Bindings</h3></div></div></div><p>Conditional bindings allow a binding between two nodes to be active
only if a <span class="emphasis"><em>condition</em></span> node evaluates to true. Conditional bindings are
declared by declaring a binding with the bind expression as the target
of the binding.</p><p><strong>Conditional Binding Declaration. </strong>
</p><pre class="screen">condition -&gt; (a -&gt; b)</pre><p>
</p><p>A conditional binding <code class="literal">a -&gt; b</code> is declared, which is conditioned on
the node <code class="literal">condition</code>. If <code class="literal">condition</code> evaluates to true, the binding <code class="literal">a
-&gt; b</code> is active and thus node <code class="literal">b</code> evaluates to the value of <code class="literal">a</code>. If,
however, <code class="literal">condition</code> evaluates to <span class="emphasis"><em>false</em></span>, <code class="literal">b</code> evaluates to a failure
value.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>A conditional binding declaration may follow the main binding
declaration, <code class="literal">a -&gt; b</code>, in the source code.</p></td></tr></table></div><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>When a conditional binding is declared, a node <code class="literal">a -&gt; b</code> is
created which may be used to reference the status of the binding,
i.e. is it active or inactive.</p></td></tr></table></div><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">-&gt;</code> operator has right associativity thus the parenthesis in
the previous example are optional, however were added for clarity.</p></td></tr></table></div><p><strong>Example: Simple Conditional Binding. </strong>
</p><pre class="screen">a &lt; 0 -&gt; (a -&gt; b)</pre><p>
</p><p>In this example <code class="literal">b</code> is only bound to <code class="literal">a</code> if <code class="literal">a</code> is less than <code class="literal">0</code>,
otherwise <code class="literal">b</code> evaluates to a failure value.</p><p><strong>Example: A <code class="literal">min</code> Meta-Node. </strong>
</p><pre class="screen">min(a, b) : {
    a &lt; b -&gt; (a -&gt; self @ ct)
    b -&gt; self @ ct
}</pre><p>
</p><p>This example combines conditional bindings and explicit contexts. If
<code class="literal">a</code> is less than <code class="literal">b</code>, <code class="literal">self</code> is bound to the value of <code class="literal">a</code> and thus the
<code class="literal">min</code> meta-node returns the value of <code class="literal">a</code>. Otherwise, <code class="literal">b &gt;= a</code>, <code class="literal">self</code>
is bound to the value of <code class="literal">b</code>, since the first binding resulted in a
failure value, and thus the value of <code class="literal">b</code> is returned from the
meta-node.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_simple_validation"></a>6.2. Simple Validation</h3></div></div></div><p>To fix the second issue, we need the <code class="literal">budget</code>, <code class="literal">food</code>, <code class="literal">electricity</code>
and <code class="literal">water</code> nodes to evaluate to failures not only if non-numeric data
is entered in the text fields but also if negative numbers are
entered.</p><p>We’ll create a simple <code class="literal">valid-amount</code> meta-node which converts its
argument to a real number and checks that the real value is greater
than or equal to <code class="literal">0</code>. For this we’ll use conditional bindings.</p><p><strong>Meta-Node <code class="literal">valid-amount</code>. </strong>
</p><pre class="screen">valid-amount(value) : {
    x &lt;- real(value)
    x &gt;= 0 -&gt; x -&gt; self
}</pre><p>
</p><p>The first declaration binds the local node <code class="literal">x</code> to the argument <code class="literal">value</code>
converted to a <code class="literal">real</code> number.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="literal">x</code> is a local node as it appears as the target of a binding.</p></td></tr></table></div><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">real</code> meta-node performs the same function as the <code class="literal">to-real</code>
meta-node.</p></td></tr></table></div><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="literal">&lt;-</code> is the same as <code class="literal">-&gt;</code> only with arguments reversed, that is
the target of the binding is on the left hand side and the source on
the right hand side.</p></td></tr></table></div><p>The second declaration conditionally binds <code class="literal">x</code> to the <code class="literal">self</code> node if
<code class="literal">x</code> is greater than or equal to <code class="literal">0</code> (<code class="literal">x &gt;= 0</code>). As a result the return
value of the meta-node is its argument converted to a real number, if
it is greater than <code class="literal">0</code>. If the real value is less than <code class="literal">0</code>, or the
argument cannot be converted to a real value, a failure is returned.</p><p>A simple way, to incorporate this in our application is to create new
nodes which are bound directly to the string values entered in the
text input fields. Let’s call them <code class="literal">in-budget</code>, <code class="literal">in-food</code>,
<code class="literal">in-electricity</code> and <code class="literal">in-water</code>. Change the HTML code, where the input
fields are created to the following:</p><pre class="programlisting">&lt;div&gt;
  &lt;label for="budget"&gt;Budget:&lt;/label&gt;
  &lt;div&gt;
    &lt;input id="budget" value="&lt;?@ in-budget ?&gt;"/&gt;
    &lt;?@ error-prompt(budget) ?&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;hr&gt;
&lt;div&gt;
  &lt;label for="food"&gt;Food:&lt;/label&gt;
  &lt;div&gt;
    &lt;input id="food" value="&lt;?@ in-food ?&gt;" /&gt;
    &lt;?@ error-prompt(food) ?&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div&gt;
  &lt;label for="electricity"&gt;Electricity:&lt;/label&gt;
  &lt;div&gt;
    &lt;input id="electricity" value="&lt;?@ in-electricity ?&gt;" /&gt;
    &lt;?@ error-prompt(electricity) ?&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div&gt;
  &lt;label for="water"&gt;Water:&lt;/label&gt;
  &lt;div&gt;
    &lt;input id="water" value="&lt;?@ in-water ?&gt;" /&gt;
    &lt;?@ error-prompt(water) ?&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre><p>Also make sure that the initial values are given to the <code class="literal">in-...</code> nodes
rather than the nodes which stored the parsed numeric values. Change
the section of the Tridash code tag, responsible for setting the
initial values, to the following:</p><pre class="screen"># Initial Values

0 -&gt; in-budget
0 -&gt; in-food
0 -&gt; in-water
0 -&gt; in-electricity</pre><p>Now we need to bind <code class="literal">valid-amount</code> instances of those nodes to the
<code class="literal">budget</code>, <code class="literal">food</code>, <code class="literal">electricity</code> and <code class="literal">water</code> nodes.</p><p>Add the following to the Tridash code tag:</p><pre class="screen"># Validation

valid-amount(in-budget) -&gt; budget
valid-amount(in-food) -&gt; food
valid-amount(in-electricity) -&gt; electricity
valid-amount(in-water) -&gt; water</pre><p>Additionally let’s change the error message to indicate that negative
numbers are invalid. Change the <code class="literal">error-prompt</code> meta-node to the
following:</p><pre class="screen">error-prompt(thing) : {
    error-message &lt;- "Please enter a valid number \u{2265} 0!"
    if (fails?(thing), error-message, "")
}</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="literal">\u{2265}</code> represents the unicode character with code 2265 which
is the character <code class="literal">≥</code>.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_let_8217_s_try_it_out_5"></a>Let’s try it out</h4></div></div></div><p>Build and run the application, and enter negative values in some of
the fields:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial6/snap1.png" align="middle" alt="Snapshot: -30 entered in Electricity. Error message displayed next to it." /></div></div><p>The error message was displayed next to the field where a negative
value was entered, in this case electricity. The total, status message
and meter were left unchanged.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_meta_node_instances_as_targets"></a>6.3. Meta-Node Instances as Targets</h3></div></div></div><p>Whilst we’ve fixed the second issue with our application, we had to
make a lot of changes to our code:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
New nodes had to be created to store the raw string input values.
</li><li class="listitem">
We had to change which nodes are given initial values.
</li><li class="listitem">
The <code class="literal">valid-amount</code> instances had to be explicitly bound to the nodes
   which store the parsed numeric values.
</li></ul></div><p>Most of the new code we’ve added is repetitive boilerplate, we’re
creating an instance of the <code class="literal">valid-amount</code> meta-node for each input
field’s value and binding it to the corresponding node storing the
parsed value. Recall that we didn’t have to do this when converting
the field values to real-numbers, we could simply write <code class="literal">to-real(...)</code>
in the inline node expressions, within the value attributes, and be
done with it. It was mentioned <code class="literal">to-real</code> was a special meta-node in
that an instance of it can also appear as the target of a binding,
whereas ordinarily that would trigger a compilation error. It turns
out we can also make the <code class="literal">valid-amount</code> node special by setting a
<code class="literal">target-node</code> attribute.</p><p>Node attributes are arbitrary key-value pairs associated with each
node, which control certain compilation properties. Attributes are set
using the special <code class="literal">:attribute</code> operator which has the following
syntax:</p><pre class="screen">:attribute(node, attribute, value)</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">node</code>
</span></dt><dd>
The node of which to set the attribute. Can be any node
  expression including a functor node.
</dd><dt><span class="term">
<code class="literal">attribute</code>
</span></dt><dd>
The attribute key. Interpreted as a literal symbol
  rather than a node expression.
</dd><dt><span class="term">
<code class="literal">value</code>
</span></dt><dd>
The value to set the attribute to. Like <code class="literal">attribute</code> this
  is interpreted as a literal rather than a node expression.
</dd></dl></div><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="tutorials/images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Attributes do not form part of a node’s runtime state thus
cannot be bound to the values of other nodes.</p></td></tr></table></div><p>The <code class="literal">target-node</code> attribute, when set on a meta-node <code class="literal">m</code>, stores a
meta-node which is used as the binding’s function, when an instance of
<code class="literal">m</code> appears as the target of a binding. When an instance of the
meta-node <code class="literal">m</code>, with the <code class="literal">target-node</code> attribute set, is processed, a
binding between the instance, as the source, and each argument node,
as the target, is established with the function of the binding being
the meta-node stored in the <code class="literal">target-node</code> attribute.</p><p><strong>Example: <code class="literal">to-real</code>. </strong>
</p><pre class="screen">:attribute(to-real, target-node, real)

# results in a binding equivalent to the following
# real(x) -&gt; y

x -&gt; to-real(y)</pre><p>
</p><p>In the example above, the <code class="literal">target-node</code> attribute of <code class="literal">to-real</code> is set
to the meta-node <code class="literal">real</code>. The binding declaration, in the last line,
results in the node <code class="literal">to-real(y)</code> being bound to <code class="literal">y</code>, with the function
<code class="literal">real</code> being the function of the binding. As a result <code class="literal">y</code> is bound to
the value of <code class="literal">x</code> converted to a <code class="literal">real</code> value.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="literal">to-real</code> performs the same function as <code class="literal">real</code>, however a
separate node is created in order to give it a different <code class="literal">target-node</code>
attribute. The behaviour of the <code class="literal">real</code> meta-node, when an instance of
it appears as the target of a binding, is to perform pattern matching
on the argument, <span class="emphasis"><em>pattern matching will be introduced in a later
tutorial</em></span>.</p></td></tr></table></div><p>To apply this to our application, we’ll give the <code class="literal">valid-amount</code>
meta-node a <code class="literal">target-node</code> attribute so that it can be used directly
inline, in the value attributes of the HTML input fields. We need the
<code class="literal">valid-amount</code> meta-node to perform the same function, when it appears
as a binding target thus we’ll simply set the <code class="literal">target-node</code> attribute
of <code class="literal">valid-amount</code> to itself.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>This section builds on the code from the previous tutorial, with
the definition of <code class="literal">valid-amount</code> added to it, and the modifications to
the <code class="literal">error-prompt</code> meta-node. It does not include the remaining
modifications made in <a class="xref" href="#_simple_validation" title="6.2. Simple Validation">Section 6.2, “Simple Validation”</a>.</p></td></tr></table></div><p>Add the following after the definition of <code class="literal">validate</code> in the Tridash code tag.</p><pre class="screen">:attribute(valid-amount, target-node, valid-amount)</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>When the <code class="literal">target-node</code> attribute is set, the meta-node is looked
up as the <code class="literal">:attribute</code> declaration is processed.</p></td></tr></table></div><p>As a result we can simply replace <code class="literal">to-real(...)</code> with <code class="literal">valid-amount(...)</code>
in the inline declarations, within the value attributes of the HTML
input elements. This will be equivalent to the code we wrote at the
end of <a class="xref" href="#_simple_validation" title="6.2. Simple Validation">Section 6.2, “Simple Validation”</a>.</p><p>Change the text input fields HTML code to the following:</p><pre class="programlisting">&lt;div&gt;
  &lt;label for="budget"&gt;Budget:&lt;/label&gt;
  &lt;div&gt;
    &lt;input id="budget" value="&lt;?@ valid-amount(budget) ?&gt;"/&gt;
    &lt;?@ error-prompt(budget) ?&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;hr&gt;
&lt;div&gt;
  &lt;label for="food"&gt;Food:&lt;/label&gt;
  &lt;div&gt;
    &lt;input id="food" value="&lt;?@ valid-amount(food) ?&gt;" /&gt;
    &lt;?@ error-prompt(food) ?&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div&gt;
  &lt;label for="electricity"&gt;Electricity:&lt;/label&gt;
  &lt;div&gt;
    &lt;input id="electricity" value="&lt;?@ valid-amount(electricity) ?&gt;" /&gt;
    &lt;?@ error-prompt(electricity) ?&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div&gt;
  &lt;label for="water"&gt;Water:&lt;/label&gt;
  &lt;div&gt;
    &lt;input id="water" value="&lt;?@ valid-amount(water) ?&gt;" /&gt;
    &lt;?@ error-prompt(water) ?&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre><p>That is all that is necessary to add the new validation logic to our
application. There is no need for creating new nodes, coming up with
new node names and changing which nodes are given initial values.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_summary_5"></a>6.4. Summary</h3></div></div></div><p>In this tutorial you learned how to create your own failure
values. This was used to add further input validation to the budgeting
application, thus fixing the second issue. Furthermore you learned how
to use <code class="literal">target-node</code> attributes to reduce the amount of binding
boilerplate code that needs to be written.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_outer_node_references"></a>7. Outer Node References</h2></div></div></div><p>This tutorial shows how nodes declared in an outer scope can be
referenced from inside a meta-node.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_referencing_non_local_nodes"></a>7.1. Referencing Non-Local Nodes</h3></div></div></div><p>Recall from <a class="xref" href="#tutorial4" title="4. Writing your own Functions">Section 4, “Writing your own Functions”</a> that node expressions, within the body of a
meta-node, primarily refer to local nodes. However if no local node is
found, the enclosing scope of the meta-node is searched. Local nodes
are only created when a node expression appears as the target of a
binding. Referencing a node with the same identifier as a node
declared at the global scope, when there is no local node with the
same identifier, references the global node.</p><p><strong>Example. </strong>
</p><pre class="screen">x                <a id="CO2-1"></a><span><img src="tutorials/images/icons/callouts/1.png" alt="1" border="0" /></span>

addx(y) : x + y  <a id="CO2-2"></a><span><img src="tutorials/images/icons/callouts/2.png" alt="2" border="0" /></span></pre><p>
</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-1"><span><img src="tutorials/images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Global node <code class="literal">x</code> declaration.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-2"><span><img src="tutorials/images/icons/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
References global node <code class="literal">x</code> as there is no local node with that identifier.
</p></td></tr></table></div><p>What actually happens behind the scenes, when an outer node is
referenced, is that an additional argument is added to the <code class="literal">addx</code>
meta-node and node <code class="literal">x</code> is implicitly added to the argument list of
each instance of <code class="literal">addx</code>. Thus the definition <code class="literal">addx</code> can be thought of
as the following:</p><pre class="screen">addx(y, x) : x + y</pre><p>and each instance <code class="literal">addx(node)</code> can be thought of as <code class="literal">addx(node, x)</code>.</p><p>The consequence of this is that the referenced outer-node, <code class="literal">x</code>, is
treated just like any other argument. This means that a binding is
established between <code class="literal">x</code> and all instances of the <code class="literal">addx</code>
meta-node. Changes in the value of <code class="literal">x</code> will trigger a re-computation
of the values of all instances of <code class="literal">addx</code>. This implicit argument is
also added to all meta-nodes which contain an instance of <code class="literal">addx</code> in
their body.</p><p>The following example demonstrates referencing an outer node from a
nested meta-node.</p><pre class="screen">add(x, y) : {
  addx(y) : x + y
  addx(y)
}</pre><p>In this example the outer node <code class="literal">x</code>, referenced from within the <code class="literal">addx</code>
meta-node is the node <code class="literal">x</code>, the first argument node, in the scope of
the body of the <code class="literal">add</code> meta-node.</p><div class="caution" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="tutorials/images/icons/caution.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>If no node is found, either local or in enclosing scope, a
compilation error is triggered.</p></td></tr></table></div><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip: .. Operator"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left"><code class="literal">..</code> Operator</th></tr><tr><td align="left" valign="top"><p>The <code class="literal">..(x)</code> operator can be used to explicitly reference a node <code class="literal">x</code>
from the enclosing scope. This is useful when there is a need to
reference a global node which has the same identifier as a local node.</p><p><strong>Example. </strong>
</p><pre class="screen">x                   <a id="CO3-1"></a><span><img src="tutorials/images/icons/callouts/1.png" alt="1" border="0" /></span>
add(x) : x + ..(x)  <a id="CO3-2"></a><span><img src="tutorials/images/icons/callouts/2.png" alt="2" border="0" /></span></pre><p>
</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-1"><span><img src="tutorials/images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Global node <code class="literal">x</code> declaration.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-2"><span><img src="tutorials/images/icons/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
<code class="literal">..(x)</code> references the global <code class="literal">x</code> node.
</p></td></tr></table></div></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_global_color_nodes"></a>7.2. Global Color Nodes</h3></div></div></div><p>So far we have a basic working budgeting application. However the
colors used to indicate <span class="emphasis"><em>within budget</em></span> and <span class="emphasis"><em>budget exceeded</em></span> are
hard-coded. While red and green are good choices in the general case,
the user may prefer different colors or would like to adjust the
saturation and luminance of the colors.</p><p>Before we begin let’s encapsulate colors in a meta-node, with each of
the components as subnodes.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_subnodes"></a>Subnodes</h4></div></div></div><p>We’ve briefly mentioned subnodes in <a class="xref" href="#tutorial1" title="1. Hello Node">Section 1, “Hello Node”</a>. A subnode is a node
which references a dictionary entry, of a particular key, out of a
<span class="emphasis"><em>parent</em></span> node containing the dictionary of values. These are referred
to as subnodes since they behave like individual nodes, and are
evaluated separately from their <span class="emphasis"><em>parent</em></span> nodes.</p><p>Subnodes are referenced with the <code class="literal">.</code> special operator. The parent node
expression is on the left-hand side with the key on the right-hand
side. The key is interpreted as a literal symbol rather than a node
expression.</p><p><strong>Subnode <code class="literal">.</code> Operator Syntax. </strong>
</p><pre class="screen">parent.key</pre><p>
</p><div class="horizontal"><table class="horizontal" cellpadding="4px" style="border: none;"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td style="" valign="top">
<p>
<code class="literal">parent</code>
</p>
</td><td style="" valign="top">
<p>
The parent <code class="literal">node</code>, which can be any node expression.
</p>
</td></tr><tr><td style="" valign="top">
<p>
<code class="literal">key</code>
</p>
</td><td style="" valign="top">
<p>
The entry key, which is interpreted as a literal symbol.
</p>
</td></tr></tbody></table></div><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">.</code> operator is lexically special in that spaces are not
required between its arguments.</p></td></tr></table></div><p>Meta-Nodes which return dictionary values can be created by binding to
subnodes of the <code class="literal">self</code> node.</p><p><strong>Example: Meta-Node Returning Dictionary. </strong>
</p><pre class="screen">Person(first, last) : {
    first -&gt; self.first  <a id="CO4-1"></a><span><img src="tutorials/images/icons/callouts/1.png" alt="1" border="0" /></span>
    last -&gt; self.last    <a id="CO4-2"></a><span><img src="tutorials/images/icons/callouts/2.png" alt="2" border="0" /></span>
}</pre><p>
</p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-1"><span><img src="tutorials/images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Binding subnode <code class="literal">first</code> of <code class="literal">self</code> to argument node <code class="literal">first</code>. Sets
the value of the entry with key <code class="literal">first</code> of the dictionary.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-2"><span><img src="tutorials/images/icons/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Binding subnode <code class="literal">last</code> of <code class="literal">self</code> to argument node <code class="literal">last</code>. Sets the
value of the entry with key <code class="literal">last</code> of the dictionary.
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_encapsulating_colors"></a>Encapsulating Colors</h4></div></div></div><p>Let’s create a <code class="literal">Color</code> meta-node that takes the hue, saturation and
luminance as arguments and creates a dictionary with three entries
<code class="literal">hue</code>, <code class="literal">saturation</code> and <code class="literal">luminance</code>. This encapsulates colors in a
single value.</p><pre class="screen">Color(h, s, l) : {
    h -&gt; self.hue
    s -&gt; self.saturation
    l -&gt; self.luminance
}</pre><p>Let’s create another meta-node <code class="literal">lerp-color</code> which simply linearly
interpolates all the components of two colors, using the <code class="literal">lerp</code>
meta-node we implemented in <a class="xref" href="#tutorial4" title="4. Writing your own Functions">Section 4, “Writing your own Functions”</a>.</p><pre class="screen">lerp-color(c1, c2, alpha) : {
    Color(
        lerp(c1.hue, c2.hue, alpha),
        lerp(c1.saturation, c2.saturation, alpha),
        lerp(c1.luminance, c2.luminance, alpha)
    )
}</pre><p>Finally let’s change the <code class="literal">make-hsl</code> function to take a single
argument, which is expected to be a dictionary of the color
components.</p><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="tutorials/images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>If a subnode of a <code class="literal">parent</code> node, which does not evaluate to
a dictionary, is referenced or the dictionary does not contain an
entry with the subnode key, the subnode evaluates to a failure.</p></td></tr></table></div><pre class="screen">make-hsl(c) :
    format("hsl(%s,%s%%,%s%%)", c.hue, c.saturation, c.luminance)</pre><p>To further clean up the code, the interpolation of the colors will be
performed inside a meta-node rather than having it littered all over
the global scope. We’ll create a meta-node <code class="literal">compute-color</code> which takes
as arguments the total expenses and budget and computes the
interpolated color. The two colors are not passed as arguments, rather
they are stored in the global meta-nodes <code class="literal">in-budget-color</code>, the
<span class="emphasis"><em>within budget</em></span> color, and <code class="literal">out-budget-color</code>, the <span class="emphasis"><em>budget exceeded</em></span>
color.</p><pre class="screen">compute-color(total, budget) : {
    clamp((total + 1) / (budget + 1), 0, 1) -&gt; scale
    make-hsl(lerp-color(in-budget-color, out-budget-color), scale)
}</pre><p>The global nodes are referenced directly from within the meta-node.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>This a rather contrived example since the two colors could have
easily been passed as arguments, and in-fact it would have resulted in
cleaner and more reusable code. However this example suffices in
demonstrating outer node references.</p></td></tr></table></div><p>Finally let’s give the <code class="literal">in-budget-color</code> and <code class="literal">out-budget-color</code> nodes
initial values:</p><pre class="screen"># Set initial value of in-budget-color to green
Color(120, 90, 45) -&gt; in-budget-color

# Set initial value of out-budget-color to red
Color(0, 90, 45) -&gt; out-budget-color</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The initial value declarations can be placed before or after the
<code class="literal">compute-color</code> meta-node definition. It makes no difference.</p></td></tr></table></div><p>The <code class="literal">in-budget-color</code> node was given an initial green color value
(Hue = 120) and the <code class="literal">out-budget-color</code> node was given an initial red
color value (Hue = 0).</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_let_8217_s_try_it_out_6"></a>Let’s try it out</h4></div></div></div><p>There is no change in the behavior of the application between this
tutorial and the previous tutorial however there is a change in the
structuring of the code. Try changing the two colors and play around
with the saturation and luminance values. <span class="emphasis"><em>Remember to recompile after
each change.</em></span></p><pre class="screen"># Set in-budget-color to blue
Color(240, 100, 50) -&gt; in-budget-color</pre><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial7/snap1.png" align="middle" alt="Snapshot: Within budget color changed to blue." /></div></div><p>This version of the application does not present any new features over
the previous version however presents a significant improvement in the
maintainability of the code. In this version, the location in the
code, in which the colors are defined is clearly visible. Changing the
colors is much easier than in the previous version where you would
have to modify this segment of code:</p><pre class="screen">make-hsl(
   lerp(120, 0, scale),
   90,
   45
) -&gt; color</pre><p>It isn’t clear which arguments of the <code class="literal">lerp</code> meta-node correspond to
the within budget color and the budget exceeded color. Someone who
isn’t familiar with the color interpolation logic might not know what
<code class="literal">lerp</code> is and may accidentally introduce a
bug. Furthermore in the previous version the <span class="emphasis"><em>within budget</em></span> and
<span class="emphasis"><em>budget exceeded</em></span> colors couldn’t have different values for the
saturation and luminance components.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_application_preferences_interface"></a>7.3. Application Preferences Interface</h3></div></div></div><p>Whilst it is easy to change the colors by modifying the code directly,
wouldn’t be nice if the colors can be changed directly from the
application itself. This may seem like a lot of work requiring an
infrastructural change to our application. Luckily with Tridash this
can be accomplished easily without modifying the existing code, <span class="emphasis"><em>only
new code is added</em></span>.</p><p>Let’s first design the UI. We’ll create three sliders for the <span class="emphasis"><em>hue</em></span>,
<span class="emphasis"><em>saturation</em></span> and <span class="emphasis"><em>luminance</em></span> components of both the “Within Budget”
and “Budget Exceeded” colors:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Add an <code class="literal">input</code> element with <code class="literal">type="range"</code> for each of the three
   components of the two colors. This will create a slider widget.
</li><li class="listitem">
For the <span class="emphasis"><em>hue</em></span> sliders set the attributes <code class="literal">min="0"</code> and
   <code class="literal">max="360"</code>, as hue values are angles in the range <code class="literal">[0, 360]</code>.
</li><li class="listitem">
For the <span class="emphasis"><em>saturation</em></span> and <span class="emphasis"><em>luminance</em></span> sliders set the attributes:
   <code class="literal">min="0"</code> and <code class="literal">max="100"</code>, as saturation and luminance values are
   percentages.
</li></ul></div><p>Now we need to bind the sliders to the color components. This can be
done by binding to the <code class="literal">value</code> attribute of the sliders using inline
declarations. For example, this will bind the <span class="emphasis"><em>hue</em></span> slider to the <span class="emphasis"><em>hue</em></span>
component of the "Within budget" color:</p><pre class="programlisting">&lt;input type="range" min="0" max="360" value="&lt;?@ to-int(in-budget-color.hue) ?&gt;"&gt;</pre><p>The value of the slider is bound to <code class="literal">to-int(in-budget-color.hue)</code> in
order to convert its value to an integer.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">to-int</code> meta-node is similar in functionality to the
<code class="literal">to-real</code> meta-node but converts its argument to an integer.</p></td></tr></table></div><p>This interface is enough to allow us to change the colors directly
from the application, however its missing a preview of the
colors. Let’s add another two elements and bind their background
colors to the colors.</p><p>Add the following two elements somewhere:</p><pre class="programlisting">&lt;div
  style="display: inline-block; width: 2em; height: 2em; vertical-align: middle"
  id="in-budget-preview"&gt;
&lt;/div&gt;</pre><pre class="programlisting">&lt;div
  style="display: inline-block; width: 2em; height: 2em; vertical-align: middle"
  id="out-budget-preview"&gt;
&lt;/div&gt;</pre><p>The <code class="literal">display: inline-block</code> style attribute simply causes the element
to be displayed as a fixed size block inline with text. <code class="literal">width</code> and
<code class="literal">height</code> set the size of the block and <code class="literal">vertical-align: middle</code>
centers the element vertically on the line of text.</p><p>Bindings to individual style attributes cannot be established inline,
and thus the elements are given ID’s in order to establish the
bindings explicitly:</p><p>Add the following to the Tridash code tag:</p><pre class="screen">make-hsl(in-budget-color) -&gt; self.in-budget-preview.style.backgroundColor
make-hsl(out-budget-color) -&gt; self.out-budget-preview.style.backgroundColor</pre><p>This simply binds the “Within Budget”
color to the <code class="literal">backgroundColor</code>
style attribute (which controls the background color) of the
<code class="literal">in-budget-preview</code> element, and likewise the “Budget Exceeded”
color is bound to the <code class="literal">backgroundColor</code> attribute of the
<code class="literal">out-budget-preview</code> element. The <code class="literal">make-hsl</code> meta-node is used to
convert the dictionary of components to a CSS HSL color string.</p><p>The following is the full Preferences UI code (excluding the explicit
binding declarations):</p><pre class="programlisting">&lt;details style="margin-top: 5px"&gt;
  &lt;summary&gt;Preferences&lt;/summary&gt;
  &lt;strong&gt;Within Budget Color:&lt;/strong&gt;
  &lt;div
    style="display: inline-block; width: 2em; height: 2em; vertical-align: middle"
    id="in-budget-preview"&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;label for="in-budget-hue"&gt;Hue:&lt;/label&gt;
    &lt;div&gt;
      &lt;input
        id="in-budget-hue"
        type="range" min="0" max="360"
        value="&lt;?@ to-int(in-budget-color.hue) ?&gt;" /&gt;
    &lt;/div&gt;

    &lt;label for="in-budget-saturation"&gt;Saturation:&lt;/label&gt;
    &lt;div&gt;
      &lt;input
        id="in-budget-saturation"
        type="range" min="0" max="100"
        value="&lt;?@ to-int(in-budget-color.saturation) ?&gt;" /&gt;
    &lt;/div&gt;
    &lt;label for="in-budget-luminance"&gt;Luminance:&lt;/label&gt;
    &lt;div&gt;
      &lt;input
        id="in-budget-luminance"
        type="range" min="0" max="100"
        value="&lt;?@ to-int(in-budget-color.luminance) ?&gt;" /&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;strong&gt;Budget Exceeded Color:&lt;/strong&gt;
  &lt;div
    style="display: inline-block; width: 2em; height: 2em; vertical-align: middle"
    id="out-budget-preview"&gt;&lt;/div&gt;
  &lt;div&gt;
    &lt;label for="out-budget-hue"&gt;Hue:&lt;/label&gt;
    &lt;div&gt;
      &lt;input
        id="out-budget-hue"
        type="range" min="0" max="360"
        value="&lt;?@ to-int(out-budget-color.hue) ?&gt;" /&gt;
    &lt;/div&gt;
    &lt;label for="out-budget-saturation"&gt;Saturation:&lt;/label&gt;
    &lt;div&gt;
      &lt;input
        id="out-budget-saturation"
        type="range" min="0" max="100"
        value="&lt;?@ to-int(out-budget-color.saturation) ?&gt;" /&gt;
    &lt;/div&gt;
    &lt;label for="out-budget-luminance"&gt;Luminance:&lt;/label&gt;
    &lt;div&gt;
      &lt;input
         id="out-budget-luminance"
         type="range" min="0" max="100"
         value="&lt;?@ to-int(out-budget-color.luminance) ?&gt;" /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/details&gt;</pre><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The <code class="literal">details</code> element simply allows the user to show and hide the
preferences by clicking on the triangle next to “Preferences”.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_let_8217_s_try_it_out_7"></a>Let’s try it out</h4></div></div></div><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial7/snap2.png" align="middle" alt="Initial Snapshot: Color preview boxes display colors and color component sliders set to values of color components." /></div></div><p>Now try changing some of the color components. Also try this while the
total sum is between 0 and the budget in order to demonstrate that the
color interpolation is performed after each change.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="tutorials//images/tutorial7/snap3.png" align="middle" alt="Snapshot: Color Within budget color changed to blue. Total and message color recomputed." /></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_urgent_attribute"></a>Urgent Attribute</h4></div></div></div><p>You have probably noticed a rather annoying aspect of this
interface. The colors are not updated while the sliders are being
dragged but only after they are released. This is analogous to the
expense input fields: the total is only updated after the enter key
has been pressed or keyboard focus leaves the field, rather than being
updated after each keystroke.</p><p>For the expense input fields this is the desired behaviour, however
for the sliders it is desirable that the colors are updated while they
are being dragged. For this to be achieved the <code class="literal">urgent</code> attribute of
the nodes, referencing the value attributes of the sliders, has to be
set to <span class="emphasis"><em>true</em></span> (<code class="literal">1</code>).</p><p>The <code class="literal">urgent</code> attribute of HTML nodes controls whether the node’s value
is updated after each change in the element or only after changes are
committed by the user.</p><p>To set the <code class="literal">urgent</code> attribute of the sliders, we have to give each
slider an ID (which has already been down) so that it can be
referenced from Tridash code. The following IDs have been given to the
slider <code class="literal">input</code> elements.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">in-budget-hue</code> — Within budget hue.
</li><li class="listitem">
<code class="literal">in-budget-saturation</code> — Within budget saturation.
</li><li class="listitem">
<code class="literal">in-budget-luminance</code> — Within budget luminance.
</li><li class="listitem">
<code class="literal">out-budget-hue</code> — Budget exceeded hue.
</li><li class="listitem">
<code class="literal">out-budget-saturation</code> — Budget exceeded saturation.
</li><li class="listitem">
<code class="literal">out-budget-luminance</code> — Budget exceeded luminance.
</li></ul></div><p>Add the following to the Tridash code tag:</p><pre class="screen">:attribute(self.in-budget-hue.value, urgent, 1)
:attribute(self.in-budget-saturation.value, urgent, 1)
:attribute(self.in-budget-luminance.value, urgent, 1)

:attribute(self.out-budget-hue.value, urgent, 1)
:attribute(self.out-budget-saturation.value, urgent, 1)
:attribute(self.out-budget-luminance.value, urgent, 1)</pre><p>Try it out, the colors will now update while the sliders are being
dragged.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_referencing_global_nodes"></a>7.4. Referencing Global Nodes</h3></div></div></div><p>A node defined in an enclosing scope of the meta-node can be
referenced by its identifier, or explicitly with the <code class="literal">..</code>
operator. However sometimes we would explicitly like to reference a
node that is defined at the global scope, not simply in an enclosing
scope of the meta-node. This can be achieved by <span class="emphasis"><em>using</em></span> the global
module in the meta-node.</p><p>You’ll learn about modules in the next tutorial but for now all you
need to know is that the module is set using a <code class="literal">:module(module-name)</code>
declaration. All node declarations following the <code class="literal">:module</code> declaration
will be declared inside the module <code class="literal">module-name</code>. The <code class="literal">:use(module)</code>
declaration allows nodes in <code class="literal">module</code> to be referenced from the module
in which the declaration occurs. Node <code class="literal">x</code> in module <code class="literal">module</code> can be
referenced, following the <code class="literal">:use</code> declaration, as a subnode of <code class="literal">module</code>
(<code class="literal">module.x</code>).</p><p>A global node can be referenced from within a meta-node with the
following:</p><pre class="screen">:module(mod)

# The node
x

meta-node1(x):
   meta-node2(y):
      :use(mod)

      # Reference global node x
      mod.x  <a id="CO5-1"></a><span><img src="tutorials/images/icons/callouts/1.png" alt="1" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO5-1"><span><img src="tutorials/images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
References the node <code class="literal">x</code> defined at the global scope, not the <code class="literal">x</code>
argument node to <code class="literal">meta-node1</code>.
</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_summary_6"></a>7.5. Summary</h3></div></div></div><p>In this tutorial you learned how to reference nodes declared outside a
meta-node from within the body of the meta-node. Changes in the values
of the referenced nodes result in a re-evaluation of all instance
nodes of the meta-node. In essence outer-node references can be
thought of as hidden arguments.</p><p>We used outer-node references to store our color preferences in global
nodes, which are referenced from within the <code class="literal">compute-color</code>
meta-node. <code class="literal">compute-color</code> is responsible for computing the
interpolated color. Further on you learned about how the <code class="literal">urgent</code>
attribute influences when changes in HTML nodes are propagated.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_modules_and_organization"></a>8. Modules and Organization</h2></div></div></div><p>Let’s face it, cramming the entire application’s code inside a single
HTML file is becoming unwieldy. Ideally the HTML file should only
contain the binding declarations which directly involve the HTML
elements in the file. The core application logic should be separated
from the presentation logic.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multiple_source_files"></a>8.1. Multiple Source Files</h3></div></div></div><p>We can of course split up the application into multiple source files,
with the extension <code class="literal">trd</code> for Tridash.</p><p>Let’s extract the utility meta-nodes in a file called: <code class="literal">util.trd</code></p><p><strong>util.trd. </strong>
</p><pre class="screen">:import(core)

# Utility Meta-nodes

lerp(a, b, alpha) : a + alpha * (b - a)

clamp(x, min, max) :
    case (
        x &lt; min : min,
        x &gt; max : max,
        x
    )


Color(h, s, l) : {
    h -&gt; self.hue
    s -&gt; self.saturation
    l -&gt; self.luminance
}

lerp-color(c1, c2, alpha) : {
    Color(
        lerp(c1.hue, c2.hue, alpha),
        lerp(c1.saturation, c2.saturation, alpha),
        lerp(c1.luminance, c2.luminance, alpha)
    )
}

make-hsl(c) :
    format("hsl(%s,%s%%,%s%%)", c.hue, c.saturation, c.luminance)</pre><p>
</p><p>Let’s also extract the application logic into another file called <code class="literal">app.trd</code>:</p><p><strong>app.trd. </strong>
</p><pre class="screen">### Application Logic

## Input Validation

valid-amount(thing) : {
    x &lt;- real(thing)
    x &gt;= 0 -&gt; x -&gt; self
}

:attribute(valid-amount, target-node, valid-amount)

## Error Handling

error-prompt(thing) : {
    error-message &lt;- "Please enter a valid number \u{2265} 0!"
    if (fails?(thing), error-message, "")
}

## Colour Interpolation

compute-color(total, budget) : {
    clamp((total + 1) / (budget + 1), 0, 1) -&gt; scale
    make-hsl(lerp-color(in-budget-color, out-budget-color, scale))
}

## Initial Values

0 -&gt; budget
0 -&gt; food
0 -&gt; water
0 -&gt; electricity

## Computing Total

food + electricity + water -&gt; total

make-hsl(
    case(
        total &lt; budget : in-budget-color,
        out-budget-color
    )
) -&gt; color


clamp((total + 1) / (budget + 1), 0, 1) -&gt; scale

compute-color(total, budget) -&gt; meter-color</pre><p>
</p><p>The only code left inside the <code class="literal">ui.html</code> file is the binding of the
colors to the various style properties of the elements, the setting of
the default colours and the <code class="literal">urgent</code> attribute declarations.</p><p>Now we need to add these sources to the build configuration file.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>If we are building using the command line directly, we’d simply
list <code class="literal">util.trd</code> and <code class="literal">app.trd</code> in the compile command.</p></td></tr></table></div><p><strong>build.yml. </strong>
</p><pre class="screen">sources:
  - util.trd
  - app.trd
  - path: ui.html
    node-name: ui

output:
  path: app.html
  type: html
  main-ui: ui</pre><p>
</p><p>We’ve added <code class="literal">util.trd</code> and <code class="literal">app.trd</code> to the <code class="literal">sources</code> list. Since
there are no source specific options we’ve simply listed the paths to
the files.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_modules_in_depth"></a>8.2. Modules In Depth</h3></div></div></div><p>Whilst this is a significant clean up, it would be even better if we
could group the nodes into different namespaces based on their
purpose, for example <span class="emphasis"><em>utility</em></span>, <span class="emphasis"><em>application logic</em></span> and <span class="emphasis"><em>ui</em></span>. This
would allow us to use only the nodes which we actually need, from the
<span class="emphasis"><em>utility</em></span> namespace, without having the rest of <span class="emphasis"><em>utility</em></span> nodes clash
(i.e. have the same identifiers) with the <span class="emphasis"><em>application logic</em></span>
nodes. Whilst in this application there are no clashes, keeping the
nodes in separate namespaces allows us to use the same <code class="literal">util.trd</code> file
in another application without the fear that some node is going to
clash with other nodes in the application.</p><p>Modules are means of separating nodes into different namespaces. A
module is a namespace in which nodes are contained. A node with
identifier <code class="literal">x</code> in module <code class="literal">mod1</code> is a distinct node from the node <code class="literal">x</code>
in <code class="literal">mod2</code>, even though the two nodes have the same identifiers.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>We’ve already made use of a builtin module, the <code class="literal">core</code> module,
which contains the <code class="literal">int</code>, <code class="literal">real</code>, <code class="literal">to-real</code> meta-nodes, as well as
the arithmetic and comparison operators.</p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_creating_modules"></a>Creating Modules</h4></div></div></div><p>Modules are created with the <code class="literal">:module</code> operator which has the
following syntax:</p><pre class="screen">:module(module-name)</pre><p>This indicates that all node references, in the declarations following
the <code class="literal">:module</code> declaration, will occur in the module with identifier
<code class="literal">module-name</code>. Remember that nodes are created the first time they are
referenced, thus if a node is referenced which is not in the module,
it is created and added to the module.</p><p><strong>Example. </strong>
</p><pre class="screen">:module(mod1)
x -&gt; node1

:module(mod2)
x -&gt; node2</pre><p>
</p><p>The first reference to the node <code class="literal">x</code> occurs in module <code class="literal">mod1</code> thus a
node <code class="literal">x</code> is added to <code class="literal">mod1</code>. The second referenced occurs in module
<code class="literal">mod2</code> thus the node is added to <code class="literal">mod2</code>. The two nodes <code class="literal">x</code> are
distinct even though they share the same identifier.</p><p>If no module is specified the node references occur in a nameless
<code class="literal">init</code> module. The current module is reset to the <code class="literal">init</code> module prior
to processing each source file.</p><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="tutorials/images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Module identifiers are distinct from node identifiers, thus
a node <code class="literal">mod</code> will not clash with a module <code class="literal">mod</code> unless the module is
added as a symbol to the module containing the node <code class="literal">mod</code>. <span class="emphasis"><em>More on
this in the next section</em></span>.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_using_modules"></a>Using Modules</h4></div></div></div><p>This is great but it is of little use if you can’t reference a node
that is declared in a different module from the current module.</p><p>The <code class="literal">:use</code> operator allows nodes in a module to be referenced as
subnodes of the module identifier.</p><pre class="screen">:use(mod1)</pre><p>This adds the symbol <code class="literal">mod1</code> to the module in which the declaration
occurs. Then you can reference a node <code class="literal">x</code> in <code class="literal">mod1</code> as a subnode of
<code class="literal">mod1</code>, <code class="literal">mod1.x</code>. In effect you can think of the <code class="literal">:use</code> operator as
adding the module as a node to the current module however the values
of modules cannot be referenced, and you cannot bind a module to a
node.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>This is also true for meta-nodes. To use a meta-node <code class="literal">f</code>
declared in <code class="literal">mod1</code>, simply reference it as a subnode of <code class="literal">mod1</code>:
<code class="literal">mod1.f(a, b)</code>.</p></td></tr></table></div><p>This greatly increases the functionality of modules however sometimes
it may become annoying to have to type out the full name of the module
over and over again, for each node. You can try keeping the module
names short however then you run the risk of module name
collisions. The <code class="literal">:alias</code> operator allows you to control the symbol
that is created in the current module, with which nodes in the module
can be referenced.</p><pre class="screen">:alias(mod1, m)</pre><p>This adds the symbol <code class="literal">m</code>, with which nodes in <code class="literal">mod1</code> can be
referenced. Nodes in <code class="literal">mod1</code> can then be referenced as subnodes of <code class="literal">m</code>.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Both <code class="literal">:use</code> and <code class="literal">:alias</code> will trigger a compilation error if the
symbol, with which the module is referenced, already names a node in
the current module.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_importing_nodes_from_other_modules"></a>Importing Nodes from Other Modules</h4></div></div></div><p>Sometimes you would like to explicitly add a node in another module to
the current module, so that you don’t have to reference it as a
subnode of the module. The <code class="literal">:import</code> operator allows you to do
this.</p><p>It has two forms:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
A short form taking only the module as an argument, in which case
   all nodes exported from the module are added to the current module.
</li><li class="listitem">
A long form in which the first argument is the module and the
   following arguments are the individual nodes to import from the
   module. Only the nodes listed are imported.
</li></ul></div><p><strong>Example. </strong>
</p><pre class="screen"># Short form: Import all nodes exported from mod1
:import(mod1)

# Long form: Only import nodes x, y, z
:import(mod1, x, y, z)</pre><p>
</p><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="tutorials/images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The short form only imports those nodes which are exported
from the module not all nodes.</p></td></tr></table></div><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The long form allows you to choose which nodes are imported into
the current module. You can list any node in the module, not just an
exported node.</p></td></tr></table></div><p><code class="literal">:import</code> also has a side-effect in that if an imported node, whether
imported by the long or short form, is registered as an infix
operator, it can be also be written in infix position in the current
module.</p><p><strong>Example. </strong>
</p><pre class="screen"># @ is a meta-node that is registered as an infix operator
:import(mod1, @)

# It can be also be placed in infix position in the current module
x @ y</pre><p>
</p><p>You cannot place a node in infix position if it is referenced as a
subnode of the module.</p><pre class="screen">:use(mod1)

# The following will not compile as you cannot place a subnode in
# infix position.

x mod1.@ y

# Instead you have to write it in prefix notation:
mod1.@(x, y)</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_exporting_nodes"></a>Exporting Nodes</h4></div></div></div><p>We mentioned that the short form of the <code class="literal">:import</code> operator imports all
nodes which are exported from the module. Nodes are exported from the
current module using the <code class="literal">:export</code> operator.</p><pre class="screen">:module(mod1)

# Exports nodes x, y and z from the current module
:export(x, y, z)</pre><p>Importing <code class="literal">mod1</code> by the short form, <code class="literal">:import(mod1)</code>, will import nodes
<code class="literal">x</code>, <code class="literal">y</code> and <code class="literal">z</code> (and other nodes listed in other <code class="literal">:export</code>
declarations) into the module.</p><p><code class="literal">:export</code> can take any number of arguments and multiple <code class="literal">:export</code>
declarations will result in the nodes listed in each declaration being
exported.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_literal_in_literal_operator"></a><code class="literal">:in</code> Operator</h4></div></div></div><p>The <code class="literal">:in</code> operator references a node in another module, for which a
symbol has not been created in the current module using <code class="literal">:use</code> or
<code class="literal">:alias</code>.</p><p>The operator has the following syntax:</p><pre class="screen">:in(module, node)</pre><p>where <code class="literal">module</code> is the name of the <code class="literal">module</code>, as declared by the
<code class="literal">:module</code> operator, and <code class="literal">node</code> is the node expression which is
processed in <code class="literal">module</code>.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_adding_modularity_to_our_application"></a>8.3. Adding Modularity to our Application</h3></div></div></div><p>Let’s group the utility meta-nodes in their own <code class="literal">util</code> module. Add the
following declaration to the top of the <code class="literal">util.trd</code> file:</p><pre class="screen">:module(util)
:import(core) <a id="CO6-1"></a><span><img src="tutorials/images/icons/callouts/1.png" alt="1" border="0" /></span></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO6-1"><span><img src="tutorials/images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
Imports all nodes from the <code class="literal">core</code> module into <code class="literal">util</code>. This
includes the arithmetic and comparison operators as well as the
special operators, <code class="literal">-&gt;</code>, <code class="literal">:</code>, <code class="literal">.</code>, which are originally from the
<code class="literal">builtin</code> module.
</p></td></tr></table></div><p>Add the following declaration near the bottom of the file to export
the meta-nodes from the module:</p><pre class="screen">:export(lerp, clamp, Color, lerp-color, make-hsl)</pre><p>Lets keep the main application logic in a <code class="literal">budget-app</code> module.</p><p>Add the following to the top of the <code class="literal">app.trd</code> file:</p><pre class="screen">:module(budget-app)

:import(core)
:import(util)</pre><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="tutorials/images/icons/important.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>We have to import both the <code class="literal">core</code> module and <code class="literal">util</code> module.</p></td></tr></table></div><p>It doesn’t make sense to keep the UI in a separate module from the
application logic, as the UI is designed specifically for this
application, thus we’ll add the HTML nodes to the <code class="literal">budget-app</code>
module. To do so we need to add <code class="literal">:module(budget-app)</code> to the top of
the Tridash code tag at the beginning of the <code class="literal">ui.html</code> file. There is
no need to import the <code class="literal">core</code> or <code class="literal">util</code> modules again, as they have
already been imported into the <code class="literal">budget-app</code> module, in the <code class="literal">app.trd</code>
file, provided this file appears before <code class="literal">ui.html</code> in the sources list.</p><p>This ensures that the HTML nodes processed in the file are added to
the <code class="literal">budget-app</code> module instead of the <code class="literal">init</code> module however the HTML
component node of the file, is still added to the <code class="literal">init</code>
module. Recall from <a class="xref" href="#tutorial1" title="1. Hello Node">Section 1, “Hello Node”</a>, that an HTML
component node is created for each HTML file processed, with the
identifier of the node given by the <code class="literal">node-name</code> source processing
option. The node is created in the <code class="literal">init</code> module. This does not pose a
problem, the application will compile at this point, however in the
interest of modularity let’s add the HTML component node to the
<code class="literal">budget-app</code> module.</p><p>In order for the HTML component node to be created in a module other
than <code class="literal">init</code>, the <code class="literal">node-name</code> option has to be of the following form
<code class="literal">module.name</code>, where <code class="literal">module</code> is the module in which the node should
be created and <code class="literal">name</code> is the name of the node to create. The same
syntax applies in the <code class="literal">main-ui</code> output option.</p><p>Change the <code class="literal">build.yml</code> file to the following:</p><p><strong>build.yml. </strong>
</p><pre class="screen">sources:
  - util.trd
  - app.trd
  - path: ui.html
    node-name: budget-app.ui

output:
  path: app.html
  type: html
  main-ui: budget-app.ui</pre><p>
</p><p>Build and run the application. You wont see any new features however
we’ve significantly improved the organization of the code.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_infix_operators"></a>8.4. Infix Operators</h3></div></div></div><p><span class="emphasis"><em>This section contains a detailed explanation of registering your own
infix operators. We will not be making any enhancements to the
budgeting application in this section.</em></span></p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_precedence_and_associativity_basics"></a>Precedence and Associativity Basics</h4></div></div></div><p>Each module has an operator table, which contains the identifiers of
all nodes which can be placed in infix position as well as their
precedence and associativity. The precedence is a number which
controls the priority in which operands are grouped with infix
operators, in an expression containing multiple different infix
operators. Higher numbers indicate greater precedence.</p><p>The multiplication <code class="literal">*</code> operator has a greater precedence (200), than
the addition <code class="literal">+</code> operator (100) thus arguments will be grouped with
the multiplication operator first and then the addition operator.</p><p>The following infix expression:</p><pre class="screen">x + y * z</pre><p>is parsed to the following expression in prefix notation:</p><pre class="screen">+(x, *(y, z))</pre><p>Notice that the <code class="literal">*</code> operator is grouped with the operands <code class="literal">x</code> and <code class="literal">y</code>
first, and then <code class="literal">x</code> and <code class="literal">*(y, z)</code> are grouped with the <code class="literal">+</code>
operator. This is due to <code class="literal">*</code> having a greater precedence than <code class="literal">+</code>.</p><p>To achieve the following grouping:</p><pre class="screen">*(+(x, y), z)</pre><p>enclose <code class="literal">x + y</code> in parenthesis:</p><pre class="screen">(x + y) * z</pre><p>Associativity controls the grouping of operands in an expression
containing multiple instances of the same infix operator. The <code class="literal">+</code>
operator has left associativity:</p><p>Thus the following infix expression:</p><pre class="screen">x + y + z</pre><p>is parsed to the following expression in prefix notation:</p><pre class="screen">+(+(x, y), z)</pre><p>i.e. it is equivalent to</p><pre class="screen">(x + y) + z</pre><p>If the <code class="literal">+</code> operator were to have right associativity, the expression
would be parsed to the following:</p><pre class="screen">+(x, +(y, z))</pre><p>Below is a table showing the precedence and associativity of some of
the builtin operators.</p><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="tutorials/images/icons/tip.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Visit the file in <code class="literal">&lt;prefix&gt;/share/tridash/modules/core/operators.trd</code> to see the full
list:</p></td></tr></table></div><div class="informaltable"><table class="informaltable" cellpadding="4px" style="border-collapse: collapse;border-top: 3px solid #527bbd; border-bottom: 3px solid #527bbd; border-left: 3px solid #527bbd; border-right: 3px solid #527bbd; "><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /></colgroup><thead><tr><th style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"> Operator </th><th style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"> Precedence </th><th style="border-bottom: 1px solid #527bbd; " align="left" valign="top"> Associativity</th></tr></thead><tbody><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">-&gt;</code></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"><p>10</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>right</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">or</code></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"><p>20</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>left</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">and</code></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"><p>25</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>left</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">+</code></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"><p>100</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>left</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">-</code></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"><p>100</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>left</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">*</code></p></td><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="right" valign="top"><p>200</p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>left</p></td></tr><tr><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p><code class="literal">/</code></p></td><td style="border-right: 1px solid #527bbd; " align="right" valign="top"><p>200</p></td><td style="" align="left" valign="top"><p>left</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_registering_your_own_infix_operators"></a>Registering your own infix operators</h4></div></div></div><p>Node identifiers can be registered as infix operators using a special
<code class="literal">:op</code> declaration.</p><pre class="screen">:op(id, precedence, [left | right])</pre><p>The first argument is the identifier. The second argument is the
operator precedence as a number and the final argument is the symbol
<code class="literal">left</code> or <code class="literal">right</code> for left or right associativity. If the third
argument is omitted it defaults to <code class="literal">left</code>.</p><p>This declaration adds an infix operator to the operator table of the
current module. In the declarations, following the <code class="literal">:op</code> declaration,
<code class="literal">id</code> can be placed in infix position.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="tutorials/images/icons/note.png" /></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="literal">id</code> can be any valid identifier, not just an identifier
consisting only of special symbols. However, as a result, a space is
required in between the operator and its operands.</p></td></tr></table></div><p>It is not checked whether <code class="literal">id</code> actually names an existing
node, however using it in infix position only makes sense if
<code class="literal">id</code> names a meta-node.</p><p>If the node with identifier <code class="literal">id</code> is imported into another module, its
entry in the operator table, of the module from which it is imported,
is copied into the operator table of the module into which it is
imported.</p><p>The precedence and associativity of existing operators can be changed,
using the <code class="literal">:op</code> operator however only the operator table of the
current module is changed even if the operator is an imported node.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_summary_7"></a>8.5. Summary</h3></div></div></div><p>In this tutorial you learned how to organize your code into multiple
source files and modules.</p><p>Summary of the module operators:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">:module</code>
</span></dt><dd>
Create a module. Remaining declarations in file are
    processed in the new module.
</dd><dt><span class="term">
<code class="literal">:use</code>
</span></dt><dd>
Add the module’s name as a symbol to the current
    module. Nodes in the module can be referenced as a subnode of the
    module’s name.
</dd><dt><span class="term">
<code class="literal">:alias</code>
</span></dt><dd>
Same as <code class="literal">:use</code> however a symbol, which is different from
    the module name, can be specified for referencing nodes in the
    module.
</dd><dt><span class="term">
<code class="literal">:import</code>
</span></dt><dd>
Import nodes from a module.
</dd><dt><span class="term">
<code class="literal">:export</code>
</span></dt><dd>
Add nodes to exported nodes of current module.
</dd><dt><span class="term">
<code class="literal">:in</code>
</span></dt><dd>
reference a node in another module for which there is no
    symbol in the current module.
</dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_what_8217_s_next"></a>9. What’s Next?</h2></div></div></div><p>These tutorials have covered most of the basic functionality of the
language. More tutorials will be added, which cover advanced
functionality such as:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Macro System
</li><li class="listitem">
Pattern Matching
</li><li class="listitem">
List Data Structure
</li><li class="listitem">
Foreign Function Interface
</li></ul></div><p>Tridash is still version 0.x software, and is far from complete. In
the next major release some of the new features which will be added
are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Map Data Structure
</li><li class="listitem">
State transitions via bindings
</li><li class="listitem">
Accumulator nodes
</li><li class="listitem">
Hierarchical Modules
</li></ul></div><p>In the meantime if you’d like to learn more about Tridash, you can
explore the manual.</p></div><div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.idm122299989760" class="footnote"><p><a href="#idm122299989760" class="simpara"><sup class="simpara">[1] </sup></a>The <code class="literal">@</code> macro expands to a functor
expression with the special <code class="literal">:context</code> operator</p></div></div></div></body></html>